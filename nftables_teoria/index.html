
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://raul-profesor.github.io/SAD/nftables_teoria/">
      
      
        <link rel="prev" href="../firewall/">
      
      
        <link rel="next" href="../nftables/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Teoría de firewalls 2 - Seguridad y alta disponibilidad</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M22%2012a10%2010%200%200%201-10%2010A10%2010%200%200%201%202%2012%2010%2010%200%200%201%2012%202a10%2010%200%200%201%2010%2010M6%2013h8l-3.5%203.5%201.42%201.42L17.84%2012l-5.92-5.92L10.5%207.5%2014%2011H6z%22/%3E%3C/svg%3E');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fundamentos-teoricos-avanzados-de-firewalls-en-linux-y-nftables" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href=".." title="Seguridad y alta disponibilidad" class="md-header__button md-logo" aria-label="Seguridad y alta disponibilidad" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Seguridad y alta disponibilidad
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Teoría de firewalls 2
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="blue"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Seguridad y alta disponibilidad" class="md-nav__button md-logo" aria-label="Seguridad y alta disponibilidad" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Seguridad y alta disponibilidad
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integritat, confidencialitat i disponibilitat
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integritat, confidencialitat i disponibilitat
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intconfdis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integritat amb AIDE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intconfdis2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Confidencialitat amb Veracrypt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intconfdis3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Disponibilitat de serveis amb Nmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Seguretat física
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Seguretat física
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SAI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SAI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Normativa
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Normativa
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normativa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RGPD, LOPDGDD y LSSI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Seguretat lògica
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Seguretat lògica
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../acl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Llistes de control d'accés (ACL)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Seguretat activa
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Seguretat activa
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../malware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exemple de ransomware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yara/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Regles Yara
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../outdated/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sistemes desactualitzats
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Spoofing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Spoofing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ARP_Spoofing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ARP Spoofing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    IDS/IPS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    IDS/IPS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../idps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitorización mediante sistemas detectores de intrusos (IDS) y sistemas de prevención de intrusos (IPS)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examen pràctic
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examen pràctic
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nop.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examen pràctic convocatòria extraordinària
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Seguretat perimetral
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Seguretat perimetral
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../perimetral/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Disseny del perímetre
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Firewall
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Firewall
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Teoría de firewalls
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Teoría de firewalls 2
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Teoría de firewalls 2
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-arquitectura-general-del-firewall-en-linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Arquitectura general del firewall en Linux
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-recorrido-completo-de-un-paquete-dentro-del-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Recorrido completo de un paquete dentro del sistema
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Recorrido completo de un paquete dentro del sistema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-trafico-entrante-destinado-al-propio-host" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Tráfico entrante destinado al propio host
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-trafico-que-atraviesa-el-sistema-modo-router" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Tráfico que atraviesa el sistema (modo router)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-trafico-generado-localmente" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Tráfico generado localmente
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-hook-definicion-tecnica-y-funcionamiento" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Hook: definición técnica y funcionamiento
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-tabla-y-cadena-estructura-jerarquica" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Tabla y cadena: estructura jerárquica
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-cadena-base" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Cadena base
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-cadena-regular" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Cadena regular
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-orden-de-evaluacion-de-reglas" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Orden de evaluación de reglas
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-politica-fundamento-del-modelo-de-seguridad" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Política: fundamento del modelo de seguridad
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-prioridad-orden-real-cuando-existen-multiples-cadenas" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Prioridad: orden real cuando existen múltiples cadenas
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-conntrack-firewall-con-estado" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Conntrack: firewall con estado
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-nat-transformacion-de-paquetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. NAT: transformación de paquetes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-modelo-mental-que-debe-interiorizar-el-alumno" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. Modelo mental que debe interiorizar el alumno
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-conclusion-estructural-y-resumen" class="md-nav__link">
    <span class="md-ellipsis">
      
        13. Conclusión estructural y resumen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-nftables" class="md-nav__link">
    <span class="md-ellipsis">
      
        14. Nftables
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14. Nftables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-reglas-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.1 Reglas (Rules):
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-cadenas-chains" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.2 Cadenas (Chains):
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-tablas-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.3 Tablas (Tables):
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-politicas-predeterminadas-default-policies" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.4 Políticas Predeterminadas (Default Policies):
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-implementacion-practica-con-nftables" class="md-nav__link">
    <span class="md-ellipsis">
      
        15 Implementación Práctica con nftables
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15 Implementación Práctica con nftables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pasos-basicos-para-usar-nftables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pasos Básicos para Usar nftables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#151-comprobar-si-nftables-esta-disponible" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1 Comprobar si nftables está disponible:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152-crear-una-tabla-de-filtrado" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.2 Crear una tabla de filtrado:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153-crear-una-cadena" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.3 Crear una cadena:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#154-anadir-reglas-de-filtrado" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.4 Añadir reglas de filtrado:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#155-ver-las-reglas-configuradas" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.5 Ver las reglas configuradas:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#156-guardar-las-reglas" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.6 Guardar las reglas:
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.6 Guardar las reglas:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-completo-de-configuracion-de-un-firewall-basico-con-nftables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ejemplo Completo de Configuración de un Firewall Básico con nftables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nftables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuración de nftables en un entorno de red en Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    VPN
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    VPN
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vpn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Servidor de VPN amb wireguard en un escenari muntat amb Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Proxy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Proxy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Servidor proxy Squid amb autenticació Radius amb Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proxy-traefik/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proxy inverso para Docker con Traefik
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proxy-caddy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proxy inverso con Caddy para contenedores Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="fundamentos-teoricos-avanzados-de-firewalls-en-linux-y-nftables">Fundamentos Teóricos Avanzados de Firewalls en Linux y nftables</h1>
<h2 id="1-arquitectura-general-del-firewall-en-linux">1. Arquitectura general del firewall en Linux</h2>
<p>En Linux, el firewall no es una aplicación externa que analiza tráfico desde espacio de usuario. Es un mecanismo integrado en el kernel que intercepta paquetes en puntos concretos del procesamiento del stack de red.</p>
<p>El componente central es Netfilter, un framework del kernel que introduce puntos de intervención dentro del flujo interno de paquetes. Esos puntos permiten registrar funciones que inspeccionan, modifican, aceptan o descartan tráfico.</p>
<p>La herramienta <code>nftables</code> no es el firewall en sí. Es la interfaz que permite definir reglas que el kernel almacenará y ejecutará dentro de Netfilter.</p>
<p>Arquitectura simplificada:</p>
<ul>
<li>Kernel Linux</li>
<li>Stack TCP/IP</li>
<li>Netfilter (hooks)</li>
<li>Conntrack (seguimiento de conexiones)</li>
<li>Espacio de usuario</li>
<li>Comando <code>nft</code></li>
</ul>
<p>Las reglas configuradas mediante <code>nft</code> se traducen en estructuras internas que el kernel evalúa para cada paquete que atraviesa el sistema.</p>
<p>Comprender esta separación entre espacio de usuario y kernel es esencial para no confundir herramienta con motor.</p>
<h2 id="2-recorrido-completo-de-un-paquete-dentro-del-sistema">2. Recorrido completo de un paquete dentro del sistema</h2>
<p>Para entender nftables desde cero es obligatorio entender qué ocurre cuando un paquete entra o sale del sistema.</p>
<p>Cuando un paquete llega por una interfaz de red:</p>
<ol>
<li>El driver de red lo recibe.</li>
<li>Se entrega al stack IP.</li>
<li>Se ejecutan funciones internas del kernel.</li>
<li>En puntos concretos, Netfilter intercepta el paquete.</li>
</ol>
<p>Dependiendo del destino, el recorrido cambia.</p>
<h3 id="21-trafico-entrante-destinado-al-propio-host">2.1 Tráfico entrante destinado al propio host</h3>
<pre class="mermaid"><code>flowchart TD
    A[Interfaz de red] --&gt; B[PREROUTING]
    B --&gt; C[Decisión de enrutamiento]
    C --&gt; D[INPUT]
    D --&gt; E[Proceso local]</code></pre>
<h3 id="22-trafico-que-atraviesa-el-sistema-modo-router">2.2 Tráfico que atraviesa el sistema (modo router)</h3>
<pre class="mermaid"><code>flowchart TD
    A[Interfaz de red] --&gt; B[PREROUTING]
    B --&gt; C[Decisión de enrutamiento]
    C --&gt; D[FORWARD]
    D --&gt; E[POSTROUTING]
    E --&gt; F[Interfaz de salida]</code></pre>
<h3 id="23-trafico-generado-localmente">2.3 Tráfico generado localmente</h3>
<pre class="mermaid"><code>flowchart TD
    A[Proceso local] --&gt; B[OUTPUT]
    B --&gt; C[POSTROUTING]
    C --&gt; D[Interfaz de salida]</code></pre>
<p>Estos puntos PREROUTING, INPUT, FORWARD, OUTPUT y POSTROUTING son los hooks.</p>
<h2 id="3-hook-definicion-tecnica-y-funcionamiento">3. Hook: definición técnica y funcionamiento</h2>
<p>Un hook es un punto fijo del código del kernel donde Netfilter permite registrar funciones que serán ejecutadas cuando un paquete alcance ese punto del flujo.</p>
<p>Los hooks están definidos en el kernel. No se crean dinámicamente.</p>
<p>Hooks principales:</p>
<ul>
<li>PREROUTING</li>
<li>INPUT</li>
<li>FORWARD</li>
<li>OUTPUT</li>
<li>POSTROUTING</li>
</ul>
<p>Cada hook representa un momento exacto en el ciclo de vida del paquete:</p>
<ul>
<li>PREROUTING ocurre antes de que el kernel decida a qué interfaz debe enviarse el paquete.</li>
<li>INPUT ocurre después de determinar que el destino es el propio sistema.</li>
<li>FORWARD ocurre cuando el sistema actúa como router.</li>
<li>OUTPUT ocurre para paquetes creados por procesos locales.</li>
<li>POSTROUTING ocurre justo antes de que el paquete abandone el sistema.</li>
</ul>
<p>Un hook no contiene reglas. Es solo un punto donde pueden asociarse cadenas.</p>
<h2 id="4-tabla-y-cadena-estructura-jerarquica">4. Tabla y cadena: estructura jerárquica</h2>
<p>En nftables, las reglas no cuelgan directamente del hook. Existe una jerarquía:</p>
<ul>
<li>Tabla</li>
<li>Cadena<ul>
<li>Reglas</li>
</ul>
</li>
</ul>
<p>Representación conceptual:</p>
<pre class="mermaid"><code>flowchart TD
    A[Tabla] --&gt; B[Cadena base]
    B --&gt; C[Regla 1]
    B --&gt; D[Regla 2]
    B --&gt; E[Regla N]</code></pre>
<p>La tabla es un contenedor lógico. Organiza reglas según familia (ip, ip6, inet) o propósito (filter, nat).</p>
<p>La cadena es el conjunto ordenado de reglas que se ejecuta cuando un paquete alcanza el hook al que está asociada.</p>
<h2 id="5-cadena-base">5. Cadena base</h2>
<p>Una cadena base está vinculada a:</p>
<ul>
<li>Un hook</li>
<li>Una prioridad</li>
<li>Una política por defecto</li>
</ul>
<p>Cuando el paquete llega al hook, el kernel ejecuta las cadenas asociadas a ese hook.</p>
<p>Si existen varias cadenas en el mismo hook, se ejecutan según su prioridad.</p>
<p>La cadena base es el punto real donde se toma la decisión de permitir o bloquear tráfico.</p>
<h2 id="6-cadena-regular">6. Cadena regular</h2>
<p>Una cadena regular no está asociada a ningún hook.</p>
<p>Se utiliza como bloque auxiliar que puede ser invocado mediante:</p>
<ul>
<li>jump</li>
<li>goto</li>
</ul>
<p>Conceptualmente, equivale a una función en programación estructurada.</p>
<p>Permite modularizar reglas complejas y evitar duplicación.</p>
<h2 id="7-orden-de-evaluacion-de-reglas">7. Orden de evaluación de reglas</h2>
<p>Dentro de una cadena, las reglas se evalúan secuencialmente.</p>
<p>Proceso interno simplificado:</p>
<ol>
<li>Se evalúa la primera regla.</li>
<li>Si la condición coincide y la acción es terminal (accept, drop), la evaluación se detiene.</li>
<li>Si no coincide, se continúa con la siguiente.</li>
<li>Si ninguna regla coincide:</li>
<li>En cadena base: se aplica la política.</li>
<li>En cadena regular: se retorna a la cadena llamadora.</li>
</ol>
<p>El orden es absolutamente determinista.</p>
<h2 id="8-politica-fundamento-del-modelo-de-seguridad">8. Política: fundamento del modelo de seguridad</h2>
<p>La política es la acción por defecto aplicada cuando ninguna regla coincide en una cadena base.</p>
<p>Valores habituales:</p>
<ul>
<li>accept</li>
<li>drop</li>
</ul>
<p>La política define la postura de seguridad del sistema.</p>
<p>Modelo permisivo:</p>
<ul>
<li>Política accept</li>
<li>Todo permitido salvo lo bloqueado explícitamente</li>
<li>Alto riesgo de omisiones</li>
</ul>
<p>Modelo restrictivo:</p>
<ul>
<li>Política drop</li>
<li>Todo bloqueado salvo lo permitido explícitamente</li>
<li>Modelo recomendado en producción</li>
</ul>
<p>Un firewall profesional se diseña siempre bajo el principio de mínimo privilegio.</p>
<h2 id="9-prioridad-orden-real-cuando-existen-multiples-cadenas">9. Prioridad: orden real cuando existen múltiples cadenas</h2>
<p>Un mismo hook puede tener varias cadenas base asociadas.</p>
<p>Cada cadena tiene una prioridad numérica.</p>
<p>El kernel ejecuta las cadenas en orden creciente de prioridad.</p>
<p>Ejemplo conceptual:</p>
<pre class="mermaid"><code>flowchart TD
    A[Hook PREROUTING] --&gt; B[Cadena prioridad -100]
    B --&gt; C[Cadena prioridad 0]
    C --&gt; D[Cadena prioridad 100]</code></pre>
<p>Esto permite separar:</p>
<ul>
<li>NAT (normalmente prioridad más baja)</li>
<li>Filtrado</li>
<li>Otras manipulaciones</li>
</ul>
<p>La prioridad es crucial para entender por qué ciertas transformaciones ocurren antes que otras.</p>
<h2 id="10-conntrack-firewall-con-estado">10. Conntrack: firewall con estado</h2>
<p>Sin seguimiento de conexiones, el firewall sería stateless.</p>
<p>Conntrack mantiene una tabla interna de conexiones activas.</p>
<p>Estados principales:</p>
<ul>
<li>NEW</li>
<li>ESTABLISHED</li>
<li>RELATED</li>
<li>INVALID</li>
</ul>
<p>Flujo conceptual de conntrack:</p>
<pre class="mermaid"><code>flowchart TD
    A[Paquete recibido] --&gt; B{¿Existe en tabla?}
    B -- Sí --&gt; C[Estado ESTABLISHED]
    B -- No --&gt; D[Crear nueva entrada]
    D --&gt; E[Estado NEW]</code></pre>
<p>Gracias a conntrack, el firewall puede:</p>
<ul>
<li>Permitir automáticamente respuestas de conexiones iniciadas desde dentro.</li>
<li>Bloquear paquetes inválidos.</li>
<li>Aplicar reglas distintas según el estado.</li>
</ul>
<p>Esto convierte al firewall en stateful.</p>
<h2 id="11-nat-transformacion-de-paquetes">11. NAT: transformación de paquetes</h2>
<p>NAT no decide si el paquete se acepta o no. Modifica direcciones.</p>
<p>Tipos:</p>
<ul>
<li>SNAT: modifica IP origen.</li>
<li>DNAT: modifica IP destino.</li>
<li>Masquerade: SNAT dinámico.</li>
</ul>
<p>Ubicación típica:</p>
<ul>
<li>DNAT en PREROUTING.</li>
<li>SNAT en POSTROUTING.</li>
</ul>
<p>Representación simplificada:</p>
<pre class="mermaid"><code>flowchart TD
    A[Paquete entrante] --&gt; B[PREROUTING DNAT]
    B --&gt; C[Routing]
    C --&gt; D[Filtrado INPUT/FORWARD]
    D --&gt; E[POSTROUTING SNAT]</code></pre>
<p>Es fundamental entender que el filtrado puede ocurrir después de que la dirección haya sido modificada.</p>
<h2 id="12-modelo-mental-que-debe-interiorizar-el-alumno">12. Modelo mental que debe interiorizar el alumno</h2>
<p>Antes de escribir reglas se deben poder responder con precisión técnica:</p>
<ul>
<li>¿El paquete entra o sale?</li>
<li>¿Está destinado al host o lo atraviesa?</li>
<li>¿En qué hook se interceptará?</li>
<li>¿Necesito filtrar o modificar direcciones?</li>
<li>¿Qué ocurre si ninguna regla coincide?</li>
<li>¿Estoy utilizando estado de conexión?</li>
<li>¿En qué orden se ejecutarán las cadenas si hay varias?</li>
</ul>
<p>Estas preguntas son clave para entender el funcionamiento interno del firewall.</p>
<h2 id="13-conclusion-estructural-y-resumen">13. Conclusión estructural y resumen</h2>
<p>Un firewall basado en nftables se compone de:</p>
<ul>
<li>Tablas como contenedores lógicos</li>
<li>Cadenas base asociadas a hooks</li>
<li>Reglas evaluadas secuencialmente</li>
<li>Política por defecto</li>
<li>Sistema de prioridades</li>
<li>Seguimiento de conexiones (conntrack)</li>
<li>Separación entre NAT y filtrado</li>
</ul>
<p>Dominar estos conceptos es imprescindible antes de realizar cualquier práctica de configuración.</p>
<h2 id="14-nftables">14. Nftables</h2>
<h3 id="141-reglas-rules">14.1 <strong>Reglas (Rules)</strong>:</h3>
<p>Las reglas de un firewall definen las condiciones bajo las cuales el tráfico es permitido o denegado. Las reglas son evaluadas en orden, y el tráfico se compara contra ellas para decidir si es permitido o no. Las reglas típicamente contienen:</p>
<ul>
<li>
<p>Dirección de origen y destino (dirección IP).</p>
</li>
<li>
<p>Puertos de origen y destino.</p>
</li>
<li>
<p>El protocolo utilizado (TCP, UDP, ICMP, etc.).</p>
</li>
<li>
<p>La acción (permitir o bloquear).</p>
</li>
</ul>
<h3 id="142-cadenas-chains">14.2 <strong>Cadenas (Chains)</strong>:</h3>
<p>Las cadenas son las secuencias de reglas que un firewall aplica al tráfico entrante y saliente. Una cadena define cómo se debe manejar el tráfico según su dirección (entrada, salida o tránsito) o su tipo. Por ejemplo:</p>
<ul>
<li>
<p><code>INPUT</code>: Controla el tráfico que entra al sistema.</p>
</li>
<li>
<p><code>OUTPUT</code>: Controla el tráfico que sale del sistema.</p>
</li>
<li>
<p><code>FORWARD</code>: Controla el tráfico que pasa a través del sistema, pero no está destinado al propio sistema.</p>
</li>
</ul>
<h3 id="143-tablas-tables">14.3 <strong>Tablas (Tables)</strong>:</h3>
<p>Las tablas son contenedores que agrupan las cadenas. En Linux, las tablas más comunes son:</p>
<ul>
<li>
<p><strong>filter</strong>: Para el filtrado de tráfico (reglas de firewall).</p>
</li>
<li>
<p><strong>nat</strong>: Para la manipulación de direcciones de red (como NAT y port forwarding).</p>
</li>
<li>
<p><strong>mangle</strong>: Para modificar los paquetes de red.</p>
</li>
<li>
<p><strong>raw</strong>: Para configuraciones de bajo nivel, como habilitar o deshabilitar la conexión de seguimiento de estado.</p>
</li>
</ul>
<h3 id="144-politicas-predeterminadas-default-policies">14.4 <strong>Políticas Predeterminadas (Default Policies)</strong>:</h3>
<p>Si un paquete no coincide con ninguna regla en una cadena, se aplica la política predeterminada de la cadena. Las políticas predeterminadas pueden ser de dos tipos:</p>
<ul>
<li>
<p><code>ACCEPT</code>: Permitir el tráfico.</p>
</li>
<li>
<p><code>DROP</code>: Bloquear el tráfico sin notificar.</p>
</li>
</ul>
<hr />
<h2 id="15-implementacion-practica-con-nftables">15 <strong>Implementación Práctica con nftables</strong></h2>
<p><strong>nftables</strong> es la herramienta moderna para gestionar firewalls en Linux. A partir del kernel 3.13, <strong>nftables</strong> reemplazó a <strong>iptables</strong>, <strong>ip6tables</strong>, <strong>arptables</strong> y <strong>ebtables</strong>. Su objetivo es unificar y simplificar la configuración de firewalls en sistemas Linux.</p>
<h3 id="pasos-basicos-para-usar-nftables"><strong>Pasos Básicos para Usar nftables</strong></h3>
<h3 id="151-comprobar-si-nftables-esta-disponible">15.1 <strong>Comprobar si nftables está disponible</strong>:</h3>
<p>Antes de empezar, asegúrate de que nftables esté instalado y habilitado. Para ver si está en uso, puedes usar el siguiente comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>list<span class="w"> </span>ruleset
</span></code></pre></div>
<p>Este comando te mostrará las reglas actuales que se están aplicando en el sistema.</p>
<h3 id="152-crear-una-tabla-de-filtrado">15.2 <strong>Crear una tabla de filtrado</strong>:</h3>
<p>Las tablas contienen las cadenas y reglas. Para crear una tabla de filtrado, usamos el siguiente comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>table<span class="w"> </span>ip<span class="w"> </span>filter
</span></code></pre></div>
<p>Esto crea una tabla llamada <code>filter</code> para IPv4. Si estás trabajando con IPv6, se usaría <code>ip6</code>.</p>
<h3 id="153-crear-una-cadena">15.3 <strong>Crear una cadena</strong>:</h3>
<p>Ahora, vamos a crear una cadena dentro de la tabla <code>filter</code> para controlar el tráfico de entrada:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>chain<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>filter<span class="w"> </span>hook<span class="w"> </span>input<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">}</span>
</span></code></pre></div>
<p>En este caso, estamos creando la cadena <code>input</code>, que se engancha al "hook" de entrada. La opción <code>priority 0</code> especifica la prioridad de la cadena.</p>
<h3 id="154-anadir-reglas-de-filtrado">15.4 <strong>Añadir reglas de filtrado</strong>:</h3>
<p>Ahora podemos agregar reglas para controlar el tráfico que entra al sistema. Por ejemplo:</p>
<ul>
<li>Permitir tráfico desde una IP específica:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>rule<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span>ip<span class="w"> </span>saddr<span class="w"> </span><span class="m">192</span>.168.1.1<span class="w"> </span>accept
</span></code></pre></div>
<ul>
<li>Bloquear tráfico desde una IP específica:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>rule<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span>ip<span class="w"> </span>saddr<span class="w"> </span><span class="m">10</span>.0.0.1<span class="w"> </span>drop
</span></code></pre></div>
<ul>
<li>Permitir tráfico HTTP y SSH:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>rule<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span>tcp<span class="w"> </span>dport<span class="w"> </span><span class="o">{</span><span class="m">22</span>,<span class="w"> </span><span class="m">80</span><span class="o">}</span><span class="w"> </span>accept
</span></code></pre></div>
<ul>
<li>Rechazar todo el tráfico entrante por defecto:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>rule<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span>drop
</span></code></pre></div>
<h3 id="155-ver-las-reglas-configuradas">15.5 <strong>Ver las reglas configuradas</strong>:</h3>
<p>Para revisar las reglas que has configurado, puedes utilizar el siguiente comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>list<span class="w"> </span>ruleset
</span></code></pre></div>
<p>Este comando te mostrará todas las tablas, cadenas y reglas configuradas en el sistema.</p>
<h3 id="156-guardar-las-reglas">15.6 <strong>Guardar las reglas</strong>:</h3>
<p>Para asegurarte de que las reglas se apliquen después de un reinicio, debes guardarlas en un archivo:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>list<span class="w"> </span>ruleset<span class="w"> </span>&gt;<span class="w"> </span>/etc/nftables.conf
</span></code></pre></div>
<p>Luego, para restaurarlas al reiniciar el sistema, puedes usar:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>-f<span class="w"> </span>/etc/nftables.conf
</span></code></pre></div>
<h4 id="ejemplo-completo-de-configuracion-de-un-firewall-basico-con-nftables"><strong>Ejemplo Completo de Configuración de un Firewall Básico con nftables</strong></h4>
<p>Imagina que quieres crear un firewall básico con las siguientes reglas:</p>
<ul>
<li>
<p>Permitir todo el tráfico desde la red interna (192.168.1.0/24).</p>
</li>
<li>
<p>Bloquear todo el tráfico desde la IP 10.0.0.1.</p>
</li>
<li>
<p>Permitir tráfico HTTP (puerto 80) y SSH (puerto 22).</p>
</li>
<li>
<p>Denegar todo el tráfico por defecto.</p>
</li>
</ul>
<p>Los comandos serían:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Esborrar regles anteriors</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>sudo<span class="w"> </span>nft<span class="w"> </span>flush<span class="w"> </span>ruleset
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="c1"># Crear la tabla de filtrado</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>table<span class="w"> </span>ip<span class="w"> </span>filter
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="c1"># Crear la cadena de entrada</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>chain<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>filter<span class="w"> </span>hook<span class="w"> </span>input<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span>policy<span class="w"> </span>drop<span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="c1"># Crear cadena per a permetre el pas de tràfic a través del firewall</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>chain<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>forward<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>filter<span class="w"> </span>hook<span class="w"> </span>forward<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span>policy<span class="w"> </span>drop<span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="c1"># Crear la cadena de entrada d&#39;eixida</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>chain<span class="w"> </span>inet<span class="w"> </span>my_table<span class="w"> </span>output<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span>filter<span class="w"> </span>hook<span class="w"> </span>output<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span>policy<span class="w"> </span>accept<span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="c1"># Permitir tráfico desde la red interna</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>rule<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span>ip<span class="w"> </span>saddr<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>accept
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="c1"># Bloquear tráfico desde la IP 10.0.0.1</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>rule<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span>ip<span class="w"> </span>saddr<span class="w"> </span><span class="m">10</span>.0.0.1<span class="w"> </span>drop
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="c1"># Permitir tráfico HTTP y SSH</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>sudo<span class="w"> </span>nft<span class="w"> </span>add<span class="w"> </span>rule<span class="w"> </span>ip<span class="w"> </span>filter<span class="w"> </span>input<span class="w"> </span>tcp<span class="w"> </span>dport<span class="w"> </span><span class="o">{</span><span class="m">22</span>,<span class="w"> </span><span class="m">80</span><span class="o">}</span><span class="w"> </span>accept
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="c1"># Ver las reglas configuradas</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>sudo<span class="w"> </span>nft<span class="w"> </span>list<span class="w"> </span>ruleset
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="c1"># Guardar las reglas</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>sudo<span class="w"> </span>nft<span class="w"> </span>list<span class="w"> </span>ruleset<span class="w"> </span>&gt;<span class="w"> </span>/etc/nftables.conf
</span></code></pre></div>
<p>Con estos pasos, habrás configurado un firewall básico usando <strong>nftables</strong> que protege tu sistema de accesos no deseados.</p>
<hr />









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.expand", "toc.integrate", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>