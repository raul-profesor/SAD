{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Col\u00b7lecci\u00f3 d'algunes pr\u00e0ctiques del m\u00f2dul de seguretat i alta disponibilitat (SAD), de 2n d'ASIX.</p> <p>Colecci\u00f3n de algunas pr\u00e1cticas y apuntes del m\u00f3dulo de seguridad y alta disponibilidad (SAD), de 2\u00ba de ASIR.</p>"},{"location":"ARP_Spoofing/","title":"ARP Spoofing","text":""},{"location":"ARP_Spoofing/#docker","title":"Docker","text":"<p>https://raul-profesor.github.io/DEAW/introduction/</p> <p>https://kinsta.com/es/base-de-conocimiento/que-es-docker/</p> <p>https://datascientest.com/es/docker-todo-que-saber</p> <p>https://www.ibm.com/topics/docker</p> <p>Tarea 0<p>Deb\u00e9is instalar Docker en Kali o Ubuntu. Pod\u00e9is ayudaros del material que consider\u00e9is, como por ejemplo este o cualquier otro.</p> </p>"},{"location":"ARP_Spoofing/#arp","title":"ARP","text":"<p>Cuando una m\u00e1quina necesita comunicarse con otra en una red, necesita conocer en primera instancia su IP para poder enviar el paquete a su destino, pero en capa 2 de OSI, utiliza direcciones MAC. El protocolo ARP entra en juego en este momento, dado que env\u00eda los mensajes pertinentes para averiguar la direcci\u00f3n MAC asociada a una IP concreta.</p> <p></p> <p>Cuando un dispositivo desea enviar paquetes a otro, lanza un mensaje broadcast ARP preguntando en la red qu\u00e9 disposito posee esa IP concreta y esperando una respuesta \u00fanicamente de ese dispositivo identific\u00e1ndose y, adem\u00e1s, enviando su MAC.</p> <p></p> <p>De esta forma, los dispositivos en la red van construyendo sus tablas ARP, donde cada entrada hace corresponder una IP con su MAC, de tal forma que si tuvieran que volver a enviar mensajes a esas m\u00e1quinas, ya no necesitan pasar por el proceso de averig\u00fcaci\u00f3n de direcciones MAC.</p> <p></p>"},{"location":"ARP_Spoofing/#arp-spoofing_1","title":"ARP Spoofing","text":"<p>Este ataque es de los conocidos como tipo Man in the Middle, llamados as\u00ed porque consisten en que un atacante o actor malicioso se interpone entre la comnicaci\u00f3n de dos v\u00edctimas, actuando de intermediario sin que ellas se den cuenta. Esto le permite interceptar toda la comunicaci\u00f3n, pudiendo espiarla o incluso modificarla, si as\u00ed lo desea.</p> <p>En el caso de un ARP Spoofing, el atacant env\u00eda falsos mensajes de respuesta ARP, indicando que su MAC se corresponde con otra IP, la de la v\u00edctima y as\u00ed recibir los mensajes que van destinados a ella.</p> <p></p>"},{"location":"ARP_Spoofing/#realizacion-de-la-practica","title":"Realizaci\u00f3n de la pr\u00e1ctica","text":"<p>Deb\u00e9is clonar el repositorio: https://github.com/raul-profesor/spoofing</p> <p>Esta pr\u00e1ctica est\u00e1 ubicada dentro de la carpeta <code>Lab1-ArpSpoofing</code>.</p> <p>Vamos a crear la siguiente infraestructura:</p> <p> </p> <p>Que consiste en:</p> <ul> <li>Dos contenedores v\u00edctimas</li> <li>Un atacante</li> <li>Un observador TcpDumper cuya \u00fanica funci\u00f3n es escuchar el tr\u00e1fico de la red</li> </ul> <p>Pasemos a construir las im\u00e1genes que m\u00e1s tarde dar\u00e1n lugar a los contenedores del atacante y del TcpDumper que vamos a ejecutar. Para este cometido no ten\u00e9is m\u00e1s que ejecutar el script <code>build.sh</code>. Los contenedores v\u00edctimas son simplemente im\u00e1genes de busybox sin modificar, directamente del \"registry\" de Docker.</p> <p>Atenci\u00f3n</p> <p>Si este <code>build.sh</code> no te funcion y te da alg\u00fan tipo de error puede pasar que hayas guardado el estado de la m\u00e1quina virtual en lugar de apagarla. Esto podr\u00eda llevar a una situaci\u00f3n donde la hora no est\u00e9 sincronizada y de problemas al comunicarse con los repositorios, reinicia tu m\u00e1quina virtual para que actualice la hora.</p> <p>Ahora ejecutaremos los 4 contenedores, cada uno en una pesta\u00f1a distinta del terminal:</p> <pre><code>docker run -it --rm --name box1 busybox\ndocker run -it --rm --name box2 busybox\ndocker run -it --rm --name arpspoofer arpspoofer\ndocker run -it --rm  --net=container:arpspoofer --name tcpdumper tcpdumper\n</code></pre> <p>Tarea 1</p> <ul> <li>Comprueba las IPs y las MAC de box1, box2 y arpspoofer con <code>ip a</code></li> <li>Comprueba la tabla ARP de box1 con <code>watch ip neigh</code></li> <li>Realiza un ping de box2 a box1 y mantenlo</li> <li>En el contenedor del <code>arpspoofer</code> comienza el spoofeo: <code>/usr/sbin/arpspoof -r -i eth0 -t x.x.x.x y.y.y.y</code> (IPs de box1 y 2)</li> </ul> <p>Tras los pasos anteriores deberias empezar a ver el tr\u00e1fico capturado por el contenedor TcpDumper.</p> <p>Tarea 2</p> <p>Adem\u00e1s del tcpdump del contenedor TcpDumper pon a capturar tr\u00e1fico con Wireshark en la interfaz <code>Docker0</code> de la m\u00e1quina anfitri\u00f3n. </p> <p>Si, como debe ser la situaci\u00f3n actual, no tienes entorno gr\u00e1fico en Rocky, haz la captura de tr\u00e1fico con Tcpdump.</p> <p>Tarea 3</p> <p>Describe detalladamente qu\u00e9 observas que est\u00e1 ocurriendo en la captura del contenedor <code>TcpDumper</code></p> <p>Tarea 4</p> <p>\u00bfC\u00f3mo podemos tener una pista de lo que est\u00e1 ocurriendo mirando s\u00f3lamente el <code>ping</code> que hemos lanzado al principio?</p> <p>Tarea 5</p> <p>En la captura de TCPDump, indica y explica detalladamente:</p> <ul> <li> <p>Mensajes ARP donde se ve claramente qu\u00e9 est\u00e1 ocurriendo y cu\u00e1l es el ataque, ind\u00edca expl\u00edcitamente los mensajes.</p> </li> <li> <p>Mensajes ICMP donde se ve la secuencia de los acontecimientos.</p> </li> </ul> <p>Tarea 6</p> <p>Transfi\u00e9rete la captura de tr\u00e1fico de la Tarea 2 a una m\u00e1quina donde cuentes con Wireshark. Ya vimos formas de realizar esta transferencia en la pr\u00e1ctica de Veracrypt.</p> <p>Abre esta captura con Wireshark, filtra por el protocolo ICMP y repite las explicaciones de la Tarea 5.</p> <p>Tarea 7<p>Realiza un diagrama en https://www.drawio.com/ donde expliques claramente de forma gr\u00e1fica el proceso que has llevado a acabo.</p> </p>"},{"location":"SAI/","title":"Elecci\u00f3 de SAI","text":""},{"location":"SAI/#exercici-guiat-triant-el-sai-adequat-per-a-sistemes-critics","title":"Exercici guiat: Triant el SAI adequat per a sistemes cr\u00edtics","text":""},{"location":"SAI/#objectiu","title":"Objectiu","text":"<p>Els estudiants avaluaran els requisits d'alimentaci\u00f3 i seleccionaran el SAI adequat per als sistemes cr\u00edtics en un escenari. Se'ls proporcionar\u00e0 consells per guiar-los a l'hora de triar els models de SAI correctes, calcular el temps d'execuci\u00f3 i considerar mesures de redund\u00e0ncia i ciberseguretat.</p>"},{"location":"SAI/#escenari","title":"Escenari","text":"<p>Sou l'administrador inform\u00e0tic d'una empresa mitjana amb diversos sistemes cr\u00edtics. A causa dels freq\u00fcents talls el\u00e8ctrics, se vos ha encarregat d'escollir un sistema SAI per mantenir aquests sistemes operatius durant el temps necessari.</p>"},{"location":"SAI/#sistemes-critics","title":"Sistemes cr\u00edtics","text":"Sistema Consum d'energ\u00eda (Watts) Nivell de prioritat Servidor base de dades 800 W High Servidor Web 600 W High Firewall 100 W Medium Network Switch 80 W Medium Workstation (x5) 200 W cadascuna Low CCTV System (Cameras &amp; NVR) 400 W Medium Backup NAS 300 W Low <p>Tasca</p> <p>El vostre objectiu \u00e9s triar els models de SAI adequats que puguin gestionar el consum d'energia i assegurar-vos que cada sistema tingui el temps d'execuci\u00f3 requerit. Tamb\u00e9 haur\u00edeu de considerar la redund\u00e0ncia per als sistemes d'alta prioritat i abordar els problemes de ciberseguretat pel que fa a la gesti\u00f3 d'SAI.</p>"},{"location":"SAI/#passos-i-consells","title":"Passos i consells","text":""},{"location":"SAI/#pas-1-calculeu-el-consum-total-denergia-del-sistema","title":"Pas 1:  Calculeu el consum total d'energia del sistema","text":"<p>Pista<p>El consum total d'energia \u00e9s la suma de la pot\u00e8ncia absorbida de tots els sistemes. Assegureu-vos d'incloure tots els sistemes al vostre c\u00e0lcul. El consum d'energia es d\u00f3na en watts.</p> </p>"},{"location":"SAI/#pas-2-converteix-el-consum-denergia-a-la-capacitat-del-sai-va-per-a-tot-el-sistema","title":"Pas 2: Converteix el consum d'energia a la capacitat del SAI (VA) per a tot el sistema","text":"<p>Pista<p>Els sistemes SAI solen estar classificats en Volt-Amps (VA). Per convertir la pot\u00e8ncia total en watts a VA, utilitzeu la f\u00f3rmula seg\u00fcent:</p> <p>$$  \\text{Capacitat del SAI (VA)} = \\frac{\\text{Pot\u00e8ncia total (watts)}}{\\text{Factor de pot\u00e8ncia}}  $$</p> <p>On el factor de pot\u00e8ncia \u00e9s generalment de 0,8 per a la majoria de les unitats SAI. Aquesta conversi\u00f3 \u00e9s necess\u00e0ria perqu\u00e8 els sistemes SAI tenen en compte la pot\u00e8ncia reactiva, per aix\u00f2 VA i watts difereixen.</p> </p> <p>Tasca</p> <p>Busca, troba i indica un SAI adequat que puga cobrir tota la pot\u00e8ncia del sistema.</p>"},{"location":"SAI/#pas-3-calculeu-el-temps-dexecucio-del-sai-per-a-tot-el-sistema","title":"Pas 3: Calculeu el temps d'execuci\u00f3 del SAI per a tot el sistema","text":"<p>Pista</p> <p>La majoria de fulls de dades del SAI proporcionen corbes o taules de temps d'execuci\u00f3 que mostren quant de temps el SAI pot suportar una c\u00e0rrega espec\u00edfica. Si coneixeu la c\u00e0rrega de pot\u00e8ncia en watts i la capacitat del SAI, utilitzeu aquests recursos per determinar quant de temps el SAI proporcionar\u00e0 energia de reserva.</p> <p>Tamb\u00e9 podeu utilitzar la f\u00f3rmula simplificada per aproximar el temps d'execuci\u00f3: $$ \\text{Temps d'execuci\u00f3 del SAI (minuts)} = \\frac{\\text{Capacitat del SAI (Wh)}}{\\text{C\u00e0rrega del sistema (Watts)}} $$</p>"},{"location":"SAI/#pas-4-dividiu-els-sistemes-per-prioritat","title":"Pas 4: Dividiu els sistemes per prioritat","text":"<p>No tots els sistemes necessiten el mateix temps de funcionament. Agrupeu els sistemes per nivell de prioritat per assignar millor els recursos del SAI. Els sistemes cr\u00edtics com el servidor de bases de dades i el servidor web haurien de tenir temps d'execuci\u00f3 m\u00e9s llargs i possiblement redund\u00e0ncia, mentre que els sistemes de prioritat m\u00e9s baixa poden tenir temps d'execuci\u00f3 m\u00e9s curts.</p> <ul> <li> <p>Sistemes d'alta prioritat (servidor de bases de dades, servidor web): necessiten entre 20 i 40 minuts de temps d'activitat.</p> </li> <li> <p>Sistemes de prioritat mitjana (tallafoc, commutador de xarxa, CCTV): necessiten entre 20 minuts i 30 minuts de funcionament.</p> </li> <li> <p>Sistemes de baixa prioritat (estacions de treball, NAS de c\u00f2pia de seguretat): nom\u00e9s necessiten 8 minuts per a un apagat segur.</p> </li> </ul>"},{"location":"SAI/#pas-5-seleccioneu-els-models-de-sai-adequats","title":"Pas 5: Seleccioneu els models de SAI adequats","text":"<p>Utilitzeu la taula seg\u00fcent per ajudar-vos a triar el SAI adequat per a cada grup de sistemes en funci\u00f3 dels seus requisits d'alimentaci\u00f3 i necessitats de temps d'execuci\u00f3. Penseu si necessiteu comprar diverses unitats SAI o una de m\u00e9s gran per cobrir tots els sistemes.</p> <p>Pista</p> <p>Busqueu les especificacions de cadasc\u00fan dels SAI i consulteu les gr\u00e0fiques de runtime per tal de completar la taula</p> Model SAI Capacitat (VA) Factor pot\u00e8ncia C\u00e0rrega m\u00e0xima (Watts) Temps d'execuci\u00f3 en c\u00e0rrega m\u00e0xima (Minuts) Temps d'execuci\u00f3 amb 50% de c\u00e0rrega (Minuts) Preu (\u20ac) APC SAI Smart UPS SRT 1500VA (SRT1500XLA) 1500 0.9 800\u20ac Eaton 5P 2200VA (9PX2200GRT-L) 2200 0.9091 1715\u20ac CyberPower 3000VA  (OL3000RTXL2U) 3000 0.9 2600\u20ac CyberPower 5000VA  (PR5000LCDRTXL5U) 5000 0.9 3800\u20ac"},{"location":"SAI/#pas-6-considereu-la-redundancia-i-la-ciberseguretat","title":"Pas 6: Considereu la redund\u00e0ncia i la ciberseguretat","text":"<p>Pista</p> <p>Per als sistemes d'alta prioritat (p. ex., servidor de bases de dades, servidor web), considereu la possibilitat d'implementar la redund\u00e0ncia utilitzant dues unitats SAI si fera falta. La redund\u00e0ncia garanteix que si falla un SAI, la segona unitat pot fer-se c\u00e0rrec, mantenint el sistema operatiu.</p> <p>A m\u00e9s, assegureu-vos que el SAI admet la supervisi\u00f3 remota (mitjan\u00e7ant SNMP o interf\u00edcies basades en web) perqu\u00e8 pugueu rebre alertes i controlar l'estat de la bateria. </p>"},{"location":"SAI/#preguntes-per-respondre-al-vostre-informe","title":"Preguntes per respondre al vostre informe:","text":"<ol> <li> <p>Consum total d'energia: quin \u00e9s el consum total d'energia de tots els sistemes?</p> <p>Pista</p> <p>Suma la pot\u00e8ncia (en watts) de tots els sistemes.</p> </li> <li> <p>Capacitat del SAI: Quina \u00e9s la capacitat total del SAI (en VA) necess\u00e0ria per a tots els sistemes?</p> <p>Consell</p> <p>Utilitzeu la f\u00f3rmula que se vos indica i un factor de pot\u00e8ncia de 0,8 per convertir watts a VA.</p> </li> <li> <p>Selecci\u00f3 de SAI: quins models de SAI heu triat i per qu\u00e8?</p> <p>Consell</p> <p>Tingueu en compte el temps d'execuci\u00f3, la c\u00e0rrega i el preu quan seleccioneu el SAI. Procureu economitzar al m\u00e0xim la vostra elecci\u00f3.</p> </li> <li> <p>Redund\u00e0ncia: heu incl\u00f2s alguna redund\u00e0ncia per a sistemes d'alta prioritat? Per qu\u00e8 o per qu\u00e8 no?</p> <p>Suggeriment</p> <p>La redund\u00e0ncia pot evitar temps d'inactivitat en cas d'avaria del SAI.</p> </li> <li> <p>Consideracions de ciberseguretat: quines mesures de seguretat prendr\u00e0s per garantir que la interf\u00edcie de gesti\u00f3 de l'SAI estigui segura?</p> <p>Pista</p> <p>Si tenim una eina de monitoritzaci\u00f3 del SAI a la que s'accedix mitjant\u00e7ant un acc\u00e9s web, qu\u00e8 far\u00edes per a tindre un acc\u00e9s segur?</p> </li> </ol>"},{"location":"SAI/#entrega-final","title":"Entrega final:","text":"<p>Un informe que inclou:</p> <ul> <li>C\u00e0lculs de pot\u00e8ncia i temps d'execuci\u00f3.</li> <li>Selecci\u00f3 i justificaci\u00f3 del model de SAI.</li> <li>Planificaci\u00f3 de redund\u00e0ncia per a sistemes d'alta prioritat.</li> <li>Mesures de ciberseguretat per assegurar la gesti\u00f3 de SAI.</li> <li>Cost total de la implementaci\u00f3 amb tots els SAI.</li> </ul>"},{"location":"SAI_sol/","title":"SAI sol","text":"<p>Certainly! Below is a similar exercise, but this time with hints to guide students on how to make decisions about UPS selection, power consumption, and cybersecurity considerations.</p>"},{"location":"SAI_sol/#guided-exercise-choosing-the-right-ups-for-critical-systems","title":"Guided Exercise: Choosing the Right UPS for Critical Systems","text":""},{"location":"SAI_sol/#objective","title":"Objective:","text":"<p>Students will assess power requirements and select the appropriate UPS for critical systems in a scenario. They will be provided with hints to guide them in choosing the correct UPS models, calculating runtime, and considering redundancy and cybersecurity measures.</p>"},{"location":"SAI_sol/#scenario","title":"Scenario:","text":"<p>You are the IT administrator for a mid-sized company with several critical systems. Due to frequent power outages, you\u2019ve been tasked with choosing a UPS system to keep these systems operational for the necessary amount of time.</p>"},{"location":"SAI_sol/#critical-systems","title":"Critical Systems:","text":"System Power Consumption (Watts) Priority Level Required Uptime Database Server 800 W High 30 minutes Web Server 600 W High 15 minutes Firewall 100 W Medium 15 minutes Network Switch 80 W Medium 15 minutes Workstation (x5) 200 W each Low 10 minutes CCTV System (Cameras &amp; NVR) 400 W Medium 1 hour Backup NAS 300 W Low 10 minutes"},{"location":"SAI_sol/#task","title":"Task:","text":"<p>Your goal is to choose the appropriate UPS model(s) that can handle the power consumption and ensure that each system has the required runtime. You should also consider redundancy for high-priority systems and address cybersecurity concerns regarding UPS management.</p>"},{"location":"SAI_sol/#steps-and-hints","title":"Steps and Hints:","text":""},{"location":"SAI_sol/#step-1-calculate-total-power-consumption","title":"Step 1: Calculate Total Power Consumption","text":"<p>Hint: The total power consumption is the sum of the power draw from all systems. Make sure to include all systems in your calculation. The power consumption is given in watts.</p> <p>\\$ \\text{Total Power Consumption (Watts)} = 800 \\, (\\text{DB Server}) + 600 \\, (\\text{Web Server}) + \\dots \\$</p>"},{"location":"SAI_sol/#step-2-convert-power-consumption-to-ups-capacity-va","title":"Step 2: Convert Power Consumption to UPS Capacity (VA)","text":"<p>Hint: UPS systems are typically rated in Volt-Amps (VA). To convert the total power in Watts to VA, use the following formula:</p> <p>[ \\text{UPS Capacity (VA)} = \\frac{\\text{Total Power (Watts)}}{\\text{Power Factor}} ]</p> <p>Where the Power Factor is generally 0.8 for most UPS units. This conversion is necessary because UPS systems account for reactive power, which is why VA and watts differ.</p> <p>For example, if you calculate the total power to be 3280 W, the VA requirement would be:</p> <p>[ \\text{UPS Capacity (VA)} = \\frac{3280}{0.8} = 4100 \\, \\text{VA} ]</p>"},{"location":"SAI_sol/#step-3-calculate-ups-runtime-for-each-system","title":"Step 3: Calculate UPS Runtime for Each System","text":"<p>Hint: Most UPS datasheets provide runtime curves or tables showing how long the UPS can support a specific load. If you know the power load in watts and the UPS capacity, use these resources to determine how long the UPS will provide backup power.</p> <p>For example, if a UPS can handle a 2400 W load and the runtime at full load is 9 minutes, and your system only uses 1200 W (50% of the capacity), the runtime will be longer\u2014around 27 minutes according to the data.</p> <p>You can also use the simplified formula to approximate runtime:</p> <p>[ \\text{UPS Runtime (minutes)} = \\frac{\\text{UPS Capacity (Wh)}}{\\text{System Load (Watts)}} ]</p>"},{"location":"SAI_sol/#step-4-divide-systems-by-priority","title":"Step 4: Divide Systems by Priority","text":"<p>Hint: Not all systems need the same uptime. Group systems by priority level to better allocate UPS resources. Critical systems like the Database Server and Web Server should have longer runtimes and possibly redundancy, while lower-priority systems can have shorter runtimes.</p> <ul> <li>High-Priority Systems (Database Server, Web Server): Need 15\u201330 minutes of uptime.</li> <li>Medium-Priority Systems (Firewall, Network Switch, CCTV): Need 15 minutes to 1 hour of uptime.</li> <li>Low-Priority Systems (Workstations, Backup NAS): Need only 10 minutes for safe shutdown.</li> </ul>"},{"location":"SAI_sol/#step-5-select-appropriate-ups-models","title":"Step 5: Select Appropriate UPS Models","text":"<p>Hint: Use the table below to help you choose the right UPS for each group of systems based on their power requirements and runtime needs. Consider whether you need to purchase multiple UPS units or a larger one to cover all systems.</p> UPS Model Capacity (VA) Power Factor Max Load (Watts) Runtime at Full Load (Minutes) Runtime at 50% Load (Minutes) Price APC Smart-UPS 1500VA 1500 0.8 1200 4 14 $500 Eaton 5P 2200VA 2200 0.9 1980 7 18 $900 CyberPower 3000VA 3000 0.8 2400 9 27 $1,200 <ul> <li>Hint 1: Start by checking if a single UPS can handle the entire power load. For example, if the total power is 3280 W, a 4100 VA UPS would be required.</li> <li>Hint 2: If no single UPS can provide the required runtime for all systems, split the load into multiple UPS systems, grouping by priority level.</li> <li>Hint 3: Look at runtime curves in datasheets to check how long each UPS will support the systems at full and partial loads.</li> </ul>"},{"location":"SAI_sol/#step-6-consider-redundancy-and-cybersecurity","title":"Step 6: Consider Redundancy and Cybersecurity","text":"<p>Hint: For high-priority systems (e.g., Database Server, Web Server), consider implementing redundancy by using two UPS units. Redundancy ensures that if one UPS fails, the second unit can take over, keeping the system operational.</p> <p>Also, ensure that the UPS supports remote monitoring (via SNMP or web-based interfaces) so you can receive alerts and monitor battery health. Make sure these management features are secured, including using strong passwords, disabling unnecessary services, and encrypting communication between the UPS and monitoring systems.</p>"},{"location":"SAI_sol/#questions-to-answer-in-your-report","title":"Questions to Answer in Your Report:","text":"<ol> <li>Total Power Consumption: What is the total power consumption for all systems?</li> <li> <p>Hint: Sum up the power (in watts) of all the systems.</p> </li> <li> <p>UPS Capacity: What is the total UPS capacity (in VA) required for all systems?</p> </li> <li> <p>Hint: Use the formula and a power factor of 0.8 to convert watts to VA.</p> </li> <li> <p>UPS Selection: Which UPS model(s) did you choose, and why?</p> </li> <li> <p>Hint: Consider runtime, load, and price when selecting the UPS.</p> </li> <li> <p>Redundancy: Did you include any redundancy for high-priority systems? Why or why not?</p> </li> <li> <p>Hint: Redundancy can prevent downtime in case of UPS failure.</p> </li> <li> <p>Cybersecurity Considerations: What security measures will you take to ensure the UPS management interface is secured?</p> </li> </ol>"},{"location":"SAI_sol/#solution-outline","title":"Solution Outline:","text":"<p>Here\u2019s how you would approach the solution based on the steps and hints provided:</p> <ol> <li>Total Power Consumption:</li> <li> <p>Add up the power consumption of all systems:    [    800 + 600 + 100 + 80 + 1000 + 400 + 300 = 3280 \\, \\text{W}    ]</p> </li> <li> <p>Convert to VA:</p> </li> <li> <p>Using a power factor of 0.8:    [    \\text{UPS Capacity (VA)} = \\frac{3280}{0.8} = 4100 \\, \\text{VA}    ]</p> </li> <li> <p>Select UPS Models:</p> </li> <li>You need a total of 4100 VA to support all systems.</li> <li>For high-priority systems (1400 W), use two CyberPower 3000VA units to ensure 30 minutes of uptime with redundancy.</li> <li>For medium-priority systems (580 W), use an Eaton 5P 2200VA unit, which provides more than 1 hour of runtime at 30% load.</li> <li> <p>For low-priority systems (1300 W), two APC Smart-UPS 1500VA units will handle the load and provide around 10\u201315 minutes of runtime.</p> </li> <li> <p>Redundancy:</p> </li> <li> <p>Redundancy is provided for high-priority systems by using two CyberPower 3000VA UPS units. If one fails, the other can continue to support the systems.</p> </li> <li> <p>Cybersecurity Considerations:</p> </li> <li>Ensure remote monitoring is enabled for the UPS, secure the management interfaces with strong passwords, and restrict network access to the UPS.</li> <li>Use encryption for communications (e.g., SNMPv3 or HTTPS) between the UPS and monitoring software.</li> </ol>"},{"location":"SAI_sol/#final-deliverable","title":"Final Deliverable:","text":"<ul> <li>A report that includes:   1.</li> </ul> <p>Esquema de la soluci\u00f3: A continuaci\u00f3 s'explica com s'aproximar\u00e0 a la soluci\u00f3 en funci\u00f3 dels passos i consells proporcionats:</p> <p>Consum total d'energia:</p> <p>Sumeu el consum d'energia de tots els sistemes: [ 800 + 600 + 100 + 80 + 1000 + 400 + 300 = 3280 , \\text{W} ] Convertir a VA:</p> <p>Utilitzant un factor de pot\u00e8ncia de 0,8: [ \\text{Capacitat del SAI (VA)} = \\frac{3280}{0,8} = 4100 , \\text{VA} ] Seleccioneu els models de SAI:</p> <p>Necessites un total de 4100 VA per donar suport a tots els sistemes. Per als sistemes d'alta prioritat (1400 W), utilitzeu dues unitats CyberPower 3000VA per garantir 30 minuts de temps d'activitat amb redund\u00e0ncia. Per als sistemes de prioritat mitjana (580 W), utilitzeu una unitat Eaton 5P 2200VA, que proporciona m\u00e9s d'1 hora de temps d'execuci\u00f3 amb una c\u00e0rrega del 30%. Per als sistemes de baixa prioritat (1300 W), dues unitats APC Smart-UPS 1500VA manejaran la c\u00e0rrega i proporcionaran uns 10-15 minuts de temps d'execuci\u00f3. Redund\u00e0ncia:</p> <p>La redund\u00e0ncia es proporciona per als sistemes d'alta prioritat mitjan\u00e7ant l'\u00fas de dues unitats UPS CyberPower 3000VA. Si un falla, l'altre pot continuar donant suport als sistemes. Consideracions de ciberseguretat:</p> <p>Assegureu-vos que la supervisi\u00f3 remota estigui habilitat per al SAI, assegureu les interf\u00edcies de gesti\u00f3 amb contrasenyes fortes i restringiu l'acc\u00e9s a la xarxa al SAI. Utilitzeu l'encriptaci\u00f3 per a les comunicacions (p. ex., SNMPv3 o HTTPS) entre el SAI i el programari de supervisi\u00f3.</p>"},{"location":"acl/","title":"Configuraci\u00f3n de ACLs en Linux y Windows","text":""},{"location":"acl/#context","title":"Context:","text":"<p>Ets un administrador de sistemes en una petita empresa que gestiona fitxers cr\u00edtics de diversos departaments. Necessites assegurar-te que els permisos sobre certs directoris i fitxers estiguin configurats correctament, atorgant o denegant acc\u00e9s segons sigui necessari. Per aix\u00f2 utilitzar\u00e0s ACLs a Linux i Windows per donar un control m\u00e9s granular sobre els permisos.</p> <p>Objectiu: Configurar ACLs per garantir que nom\u00e9s certs usuaris i grups tinguin els permisos adequats sobre fitxers i directoris a Linux i Windows.</p>"},{"location":"acl/#part-1-configuracio-dacl-a-linux","title":"Part 1: Configuraci\u00f3 d'ACL a Linux","text":""},{"location":"acl/#escenari","title":"Escenari","text":"<p>En un servidor Linux (Rocky p.ex.), tens una carpeta anomenada <code>/data/projectes</code> que cont\u00e9 fitxers de diferents projectes. Els empleats dels departaments de Vendes i Desenvolupament necessiten accedir als arxius de diferents maneres.</p> <ul> <li>Usuaris del departament de Vendes (vendes1, vendes2) necessiten tenir nom\u00e9s permisos de lectura sobre el directori <code>/data/projectes</code>.</li> <li>Usuaris del departament de Desenvolupament (dev1, dev2) necessiten tenir permisos de lectura i escriptura.</li> <li>L'usuari admin ha de tenir tots els permisos (lectura, escriptura, execuci\u00f3).</li> </ul>"},{"location":"acl/#tasques","title":"Tasques","text":""},{"location":"acl/#configuracio-inicial","title":"Configuraci\u00f3 inicial","text":"<p>Verificaci\u00f3 d'ACLs</p> <p>Rocky Linux utilitza com a sistema d'arxius XFS, que soporta l'\u00fas d'ACL per defecte. Encara i aix\u00f2, comproveu que es aix\u00ed fent \u00fas del comandament: <code>cat /boot/config* | grep _ACL</code></p> <p>En la exidida del comandament anterior haurieu de vore algo paregut a:</p> <pre><code>CONFIG_EXT4_FS_POSIX_ACL=y\nCONFIG_XFS_POSIX_ACL=y\n</code></pre> <ul> <li>Crea la carpeta <code>/data/projectes</code></li> <li>Fes que el propietari de la carpeta siga root i el grup root</li> <li>Els permisos b\u00e0sics inicials de la carpeta han de ser 770 (rwxrwx---)</li> <li>Crea en el sistema els usuaris que farem servir: admin, vendes1, vendes2, dev1 i dev2</li> <li>A m\u00e9s, haur\u00e0s de crear un grup que es cride devs i ficar els usuaris dev1 i dev2 dins</li> </ul>"},{"location":"acl/#configuracio-de-les-acl","title":"Configuraci\u00f3 de les ACL","text":"<p>Sobre la carpeta anterior, afegir ACL als usuaris del departament de Vendes:</p> <ul> <li>Els usuaris vendes1 i vendes2 han de tenir nom\u00e9s permisos de escriptura </li> </ul> <p>Afegeix ACL als usuaris del departament de Desenvolupament</p> <ul> <li>Els grup devs han de tenir permisos de lectura</li> </ul> <p>Atorgar permisos complets a l'usuari admin:</p> <ul> <li>L'usuari admin ha de tenir tots els permisos (lectura, escriptura i execuci\u00f3)</li> </ul> <p>Atenci\u00f3</p> <p>Recorda que sense les ACL per defecte, els fitxers creats no heretaran els permisos configurats.</p> <p>Verificar les ACLs configurades amb el comandament i les captures de pantalla adequades.</p>"},{"location":"acl/#proves","title":"Proves","text":"<ul> <li>Crea un arxiu amb un dels usuaris de vendes i prova a llegir-lo. Pots fer-lo? Per qu\u00e8?</li> <li>Prova de llegir l'arxiu amb l'altre usuari de vendes. Pots fer-lo? Per qu\u00e8?</li> <li>Prova de modificar l'arxiu amb eixe segon usuari. Has tingut \u00e8xit? Per qu\u00e8?</li> <li>Prova de modificar l'arxiu amb un dels usuaris del grup devs</li> <li>Mostra el contingut del arxiu amb eixe usuari del grup devs</li> <li>Prova de crear un arxiu nou amb eixe usuari</li> <li>Verifiqueu que l'usuari admin tingui control total creant un nou arxiu, mostrant el contingut dels ja existents i modificant-los tots.</li> </ul>"},{"location":"acl/#part-2-configuracio-dacls-a-windows","title":"Part 2: Configuraci\u00f3 d'ACLs a Windows","text":""},{"location":"acl/#escenari_1","title":"Escenari","text":"<p>En un servidor Windows, hi ha una carpeta anomenada <code>C:\\Projectes</code> amb fitxers sensibles de l'empresa. Diferents usuaris necessiten diferents nivells d'acc\u00e9s.</p>"},{"location":"acl/#configuracio-inicial_1","title":"Configuraci\u00f3 inicial","text":"<ul> <li>Crear la carpeta <code>C:\\Projectes</code></li> <li>Crear els usuaris marketing1, marketing2, it1, it2 i admin</li> <li>Crea un grup amb el nom it i fica dins als usuaris it1 i it2</li> </ul>"},{"location":"acl/#tasques_1","title":"Tasques","text":"<ul> <li>Usuaris de l'equip de m\u00e0rqueting (marketing1, marketing2) necessiten tenir permisos de nom\u00e9s lectura sobre la carpeta.</li> <li>Usuaris de l'equip d'IT (it1, it2) necessiten tenir permisos de lectura i de escriptura.</li> <li>L'administrador (administrador) ha de tenir control total sobre la carpeta.</li> </ul>"},{"location":"acl/#verificar-permisos-de-seguretat-avancats","title":"Verificar permisos de seguretat avan\u00e7ats","text":"<ul> <li>Feu clic al bot\u00f3 Opcions avan\u00e7ades a la pestanya Seguretat per revisar els permisos heretats i les entrades ACL detallades.</li> <li>Assegureu-vos que els permisos aplicats als usuaris no s'heretin d'altres carpetes si no \u00e9s necessari.</li> </ul>"},{"location":"acl/#proves_1","title":"Proves:","text":"<ul> <li>Verifica que els usuaris de M\u00e0rqueting no puguin modificar fitxers a C:\\Projectes, per\u00f2 puguin llegir-los.</li> <li>Verifica que els usuaris de M\u00e0rqueting no puguin crear arxius o directoris.</li> <li>Verifica que els usuaris d'IT puguin llegir i modificar fitxers.</li> <li>Intenta crear amb un usuari del grup it un arxiu dins del directori amb el bot\u00f3 dret. Detalla qu\u00e8 observes.</li> <li>Intenta crear amb un usuari del grup it un arxiu dins del directori des del mateix bloc de notes. Detalla qu\u00e8 observes.</li> <li>Verifiqueu que l'administrador t\u00e9 control total sobre la carpeta.</li> </ul>"},{"location":"acl/#preguntes-per-a-la-reflexio","title":"Preguntes per a la reflexi\u00f3","text":"<p>Pregunta 1</p> <p>Quins avantatges ofereix la configuraci\u00f3 d'ACL en comptes d'utilitzar nom\u00e9s els permisos tradicionals (rwx a Linux o NTFS a Windows)?</p> <p>Pregunta 2</p> <p>Quins problemes podrien sorgir si un sistema no tingu\u00e9s suport per a ACL?</p> <p>Pregunta 3</p> <p>Com canviaria la configuraci\u00f3 d'ACL si els permisos d'acc\u00e9s canviessin din\u00e0micament?</p>"},{"location":"acl_sol/","title":"Acl sol","text":"<p>Parte 1: Configuraci\u00f3n de ACLs en Linux Soluciones t\u00e9cnicas:</p> <pre><code>Instalaci\u00f3n y verificaci\u00f3n de ACLs: Comando para instalar el soporte de ACLs (si no est\u00e1 instalado):\n\nbash\n</code></pre> <p>sudo apt-get install acl</p> <p>Verificaci\u00f3n de que la partici\u00f3n tenga soporte ACL:</p> <p>bash</p> <p>mount | grep acl</p> <p>Si no est\u00e1 habilitado, debes a\u00f1adir la opci\u00f3n acl en el archivo /etc/fstab para la partici\u00f3n correspondiente y volver a montar la partici\u00f3n.</p> <p>Configuraci\u00f3n de permisos iniciales del directorio: Crear la carpeta y establecer permisos:</p> <p>bash</p> <p>sudo mkdir -p /data/proyectos sudo chown root:root /data/proyectos sudo chmod 770 /data/proyectos</p> <p>ACLs para los usuarios del departamento de Ventas (solo lectura): Se asignan permisos de solo lectura a ventas1 y ventas2:</p> <p>bash</p> <p>sudo setfacl -m u:ventas1:r /data/proyectos sudo setfacl -m u:ventas2:r /data/proyectos</p> <p>ACLs para los usuarios del departamento de Desarrollo (lectura y escritura): Se otorgan permisos de lectura y escritura a dev1 y dev2:</p> <p>bash</p> <p>sudo setfacl -m u:dev1:rw /data/proyectos sudo setfacl -m u:dev2:rw /data/proyectos</p> <p>ACLs para el administrador (todos los permisos): El usuario admin recibe control total sobre el directorio:</p> <p>bash</p> <p>sudo setfacl -m u:admin:rwx /data/proyectos</p> <p>Verificaci\u00f3n de las ACLs configuradas: Para ver las ACLs actuales del directorio:</p> <p>bash</p> <p>getfacl /data/proyectos</p> <p>Salida esperada:</p> <p>text</p> <pre><code># file: data/proyectos\n# owner: root\n# group: root\nuser::rwx\nuser:ventas1:r--\nuser:ventas2:r--\nuser:dev1:rw-\nuser:dev2:rw-\nuser:admin:rwx\ngroup::---\nmask::rwx\nother::---\n</code></pre> <p>Pruebas:</p> <pre><code>Ventas (ventas1 y ventas2) deber\u00edan poder leer archivos en /data/proyectos pero no modificarlos.\nDesarrollo (dev1 y dev2) deber\u00edan poder leer y escribir archivos en /data/proyectos.\nAdmin (admin) deber\u00eda tener todos los permisos sobre los archivos y el directorio.\n</code></pre> <p>Parte 2: Configuraci\u00f3n de ACLs en Windows Soluciones t\u00e9cnicas:</p> <pre><code>Crear la carpeta C:\\Proyectos: Si la carpeta no existe, simplemente cr\u00e9ala mediante el explorador de archivos o usando el comando:\n\ncmd\n\nmkdir C:\\Proyectos\n\nPermisos para los usuarios de Marketing (solo lectura): En la pesta\u00f1a de Seguridad:\n    Selecciona Editar.\n    A\u00f1ade marketing1 y marketing2.\n    Otorga permisos de solo lectura (Lectura y ejecuci\u00f3n, Mostrar carpeta, Lectura).\n\nPermisos para los usuarios de IT (lectura y modificaci\u00f3n):\n    A\u00f1ade it1 y it2.\n    Ot\u00f3rgales permisos de lectura y modificaci\u00f3n (Lectura y ejecuci\u00f3n, Mostrar carpeta, Lectura, Modificar).\n\nControl total para el Administrador:\n    Aseg\u00farate de que el usuario Administrator tenga control total sobre la carpeta.\n\nVerificaci\u00f3n de permisos avanzados: Revisa las opciones avanzadas en la pesta\u00f1a de Seguridad para confirmar que los permisos no sean heredados incorrectamente y que las ACLs sean correctas.\n</code></pre> <p>Pruebas:</p> <pre><code>Marketing (marketing1 y marketing2) solo deben poder leer los archivos en C:\\Proyectos, pero no modificarlos.\nIT (it1 y it2) deben poder leer y modificar los archivos.\nAdministrador debe tener control total sobre la carpeta y su contenido.\n</code></pre> <p>Preguntas para Reflexi\u00f3n:</p> <pre><code>\u00bfQu\u00e9 ventajas ofrece la configuraci\u00f3n de ACLs en lugar de usar solo los permisos tradicionales (rwx en Linux o NTFS en Windows)?\n    Las ACLs ofrecen un control m\u00e1s granular sobre los permisos de archivos y directorios. En lugar de limitarse a los tres grupos (propietario, grupo, otros) en Linux o los permisos b\u00e1sicos en Windows, con ACLs puedes asignar permisos espec\u00edficos a cualquier usuario o grupo, adaptando mejor los accesos a las necesidades reales de seguridad y operaci\u00f3n.\n    ACLs permiten excepciones a las reglas generales de permisos, lo que es \u00fatil en situaciones complejas donde se requiere una mayor flexibilidad.\n\n\u00bfQu\u00e9 problemas podr\u00edan surgir si un sistema no tuviera soporte para ACLs?\n    Sin ACLs, las empresas se ven limitadas a los permisos tradicionales, lo que puede ser insuficiente en entornos donde diferentes usuarios necesitan acceder a los mismos archivos con diferentes permisos. Esto podr\u00eda llevar a riesgos de seguridad (demasiados permisos otorgados) o ineficiencia (la necesidad de crear muchas estructuras de directorios o usuarios adicionales).\n    Tambi\u00e9n se complica la administraci\u00f3n, ya que se pierde la capacidad de definir excepciones espec\u00edficas para usuarios o grupos.\n\n\u00bfC\u00f3mo cambiar\u00eda la configuraci\u00f3n de ACLs si los permisos de acceso cambiaran din\u00e1micamente?\n    Si los permisos cambian frecuentemente, se deber\u00eda considerar la creaci\u00f3n de grupos din\u00e1micos basados en roles, en lugar de gestionar cada usuario individualmente en las ACLs. Esto facilita el mantenimiento y permite un manejo m\u00e1s eficiente de los cambios.\n    Adem\u00e1s, podr\u00eda ser necesario implementar herramientas automatizadas o pol\u00edticas que ajusten din\u00e1micamente las ACLs seg\u00fan las necesidades de acceso (por ejemplo, scripts de automatizaci\u00f3n o herramientas de gesti\u00f3n centralizada como Active Directory en Windows o Ansible en Linux).\n</code></pre> <p>Este ejercicio completo, con soluciones, cubre tanto la parte t\u00e9cnica como la reflexi\u00f3n te\u00f3rica, permitiendo que tus estudiantes aprendan los fundamentos y las ventajas del uso de ACLs en sistemas operativos comunes.</p>"},{"location":"examen_practic_1a/","title":"Examen practic 1a","text":""},{"location":"examen_practic_1a/#examen-practic-del-primer-trimestre-ra1-i-ra2","title":"Examen pr\u00e0ctic del primer trimestre (RA1 i RA2)","text":"<p>En primer lloc, baixem la imatge Docker que utilitzarem per a l'examen:</p> <pre><code>docker pull br3baj3/examen_practic_1er:latest\n</code></pre> <p>I una vegada fet aix\u00f2, executem el contenidor amb el nom examen_container, en background i mapejant el port 8888 de la nostra pr\u00f2pia m\u00e0quina al 2222 del contenidor. Despr\u00e9s comprovarem que el contenidor est\u00e0 corrent sense problemes:</p> <pre><code>docker run --name examen_container -d -p 8888:2222 br3baj3/examen_practic_1er:latest\ndocker ps\n</code></pre>"},{"location":"examen_practic_1a/#historia-de-dos-ciutats","title":"Hist\u00f2ria de dos ciutats","text":"<p>Per a esta pr\u00e0ctica/examen, assumirem primer el paper d'un atacant/ciberdelincuent i desp\u0155es el de l'administrador de sistemes que vol solucionar el problema.</p>"},{"location":"examen_practic_1a/#atacant","title":"Atacant","text":"<p>Suposem que el atacant ha aconseguit unes credencials d'alguna forma no molt \u00e9tica i les fa servir.</p> <p>Haurem d'esperar 1 \u00f3 2 minuts per a que finalitze la provisi\u00f3 del contenidor. Passat este temps podrem conectar-nos per SSH: </p> <pre><code>ssh examen_practic@localhost -p8888\n</code></pre> <p>Info</p> <ul> <li> <p>usuari: examen_practic</p> </li> <li> <p>contrasenya: examensad</p> </li> </ul> <p>En primer lloc, l'atacant vol facilitar-se la vida a l'hora de fer servir las credencials i conectar-se a la m\u00e0quina d'una forma m\u00e9s c\u00f2moda.</p> <p>Tasca 1 - Conexi\u00f3 SSH amb claus</p> <p>Crea un parell de claus de 2048 bits amb l'algorisme RSA i copia-les al server per a conectarte mitjan\u00e7ant clau p\u00fablica. Comprova que funciona correctament.</p> <p>Despr\u00e9s d'una intensa auditoria, el ciberdelincuent ha descobert que la m\u00e0quina t\u00e9 una vulnerabilitat del paquet pkexec molt cr\u00edtica anomenada Pwnkit que permet a un usuari escalar privilegis i convertir-se en root.</p> <p>Tasca 2 - Explotaci\u00f3 de la vulnerabilitat</p> <p>Busca un exploit en python per a pwnkit i fes-lo servir a la m\u00e0quina per a convertir-te en root. Despr\u00e9s d'executar-lo introdueix el comandament <code>id</code> com a prova.</p> <p>El ciberdelincuent, aprofitant els seus poders de root, vol cobrir les seues empremtes i per tant, procurar\u00e0 esborrar dels logs les l\u00ednies que facin refer\u00e8ncia al login amb claus (el login original estava amb usuari/contrasenya i una altra cosa al\u00e7ar\u00eda sospites). Per a fer aix\u00f2 utilitzar\u00e0 l'eina vi i no nano.</p> <p>Consell</p> <p>Una vegada aconseguida una shell de root pots obtenir una shell m\u00e9s amigable amb el comadament  <code>/bin/bash</code></p> <p>Tasca 3 - Ocultaci\u00f3 d'evid\u00e8ncies</p> <p>Busca entre els arxius del directori a on s'ubiquen tots els logs del sistema totes les l\u00ednies que facin refer\u00e8ncia a l'usuari examen_practic. Entre eixes l\u00ednies hi haur\u00e0 algunes que facin refer\u00e8ncia al login ssh amb clau p\u00fablica, que tamb\u00e9 pots filtrar si vols.</p> <p>Ara, amb l'eina vi obri l'arxiu d'on hagis d'esborrar les l\u00ednies i esborra nom\u00e9s les que mostren un login amb clau p\u00fablica.</p> <p>Consells</p> <p>Vi \u00e9s una eina un poc especial, alguns consells per a fer-lo servir:</p> <ul> <li>Per pasar al mode d'inserci\u00f3 de text heu de pr\u00e9mer primer la tecla i<ul> <li>En este mode podeu escriure i esborar</li> </ul> </li> <li>Despr\u00e9s d'escriure lo desitjat, heu d'eixir del mode d'inserci\u00f3 prement la tecla ESC</li> <li>Fora del mode d'inserci\u00f3 de text podeu buscar paraules escrivint /terme_a_buscar (important la barra)<ul> <li>Per a buscar la seg\u00fcent coincid\u00e8ncia, premeu n</li> </ul> </li> <li>Per a esborrar una l\u00ednea sencera d'una vegada, fora del mode d'inserci\u00f3 de text, vos coloqueu en la l\u00ednia y premeu dd</li> <li>Per a guardar i eixir, eixiu del mode d'inserci\u00f3 de text (tecla ESC) i escriviu :wq (important els dos punts)</li> </ul> <p>Despr\u00e9s d'esborrar les pistes que el delaten, l'atacant decidix que utilitzar aquest usuari es perill\u00f3s pel risc que t\u00e9 de que el pugen descobrir. Es per aix\u00f2 que ha decidit fer servir un altre usuari. Consultant l'arxiu <code>/etc/passwd</code>ha vist que el mes indicat \u00e9s un anomenat altre_usuari.</p> <p>Tasca 4 - Desxifrat de contrasenya</p> <ol> <li>Treu la l\u00ednia que et fa falta de l'arxiu <code>/etc/shadow</code> </li> <li>En la teua m\u00e0quina fes servir <code>johntheripper</code>per a desxifrar la contrasenya. Utilitza el diccionari que trobar\u00e0s en Aules.</li> <li>Comprova que, efectivament, pots conectar-te per SSH amb el nou usuari</li> </ol> <p>Una vegada l'atacant ha fet login amb el nou usuari pren vol procedir a exfiltrar certa informaci\u00f3 en un arxiu de text. L'atacant ha decidit aprofitar-se de que la m\u00e0quina t\u00e9 instal\u00b7lada la utilitat rsync.</p> <p>Tasca 5 - Exfiltraci\u00f3 amb rsync</p> <p>Fes servir rsync per a enviar l'arxiu dades_interessants.txt a la teua m\u00e0quina amfitriona. Recorda que has de poder conectar-te per SSH a la teua m\u00e0quina amfitri\u00f3.</p> <p>L'arxiu ha de contindre dos dades:</p> <ul> <li>Hash SHA256 de la contrasenya de l'usuari</li> <li>Hash SHA256 de l'exida del comandament <code>date</code></li> </ul> <p>Atenci\u00f3!</p> <p>Recorda que rsync ha d'estar instal\u00b7lat tant en la m\u00e0quina origen com en la de dest\u00ed.</p>"},{"location":"examen_practic_1a/#administrador-de-sistemes","title":"Administrador de sistemes","text":"<p>Despr\u00e9s d'una \u00e0rdua tasca d'investigaci\u00f3, el administrador de sistemes ha descobert quina es la vulnerabilitat que ha fet servir l'atacant i ha de procedir a solucionar-la.</p> <p>L'administrador t\u00e9 un usuari propi:</p> <p>Info</p> <ul> <li> <p>usuari: ubuntu</p> </li> <li> <p>contrasenya: iessevero</p> </li> </ul> <p>Tasca 6 - Mitigaci\u00f3</p> <ol> <li>Busca informaci\u00f3 de com mitigar la vulnerabilitat i posa-lo en pr\u00e0ctica.</li> <li>Busca informaci\u00f3 sobre com solucionar-lo i indica el comandament que ser\u00eda necessari introdu\u00efr per a fer-lo.</li> <li>Comprova que l'exploit ja no funciona</li> </ol> <p>Atenci\u00f3!</p> <p>La tasca es considera correcta amb la mitigaci\u00f3 i la indicaci\u00f3 de com solucionar-lo. En cas de que vulgues fer-lo m\u00e9s real, pots fet l'actualitzaci\u00f3 necess\u00e0ria per\u00f2 pot trigar molt de temps. Tens dos opcions, o deixar indicat el comandament o executar-lo i deixar-lo funcionar mentres continues amb l'examen.</p> <p>Per a augmentar un poc la seguretat, l'administrador decideix aplicar una nova pol\u00edtica de contrasenyes. Concretament aplicar\u00e0 els seg\u00fcents par\u00e0metres:</p> <ul> <li>Al ficar el nou password, si no compleix la pol\u00edtica, nom\u00e9s deixar\u00e0 3 intents abans de tornar un error</li> <li>La longitud m\u00ednima del password ha de ser 12 car\u00e0cters</li> <li>Nom\u00e9s deixa que la contrasenya continga el mateix car\u00e1cter consecutiu 3 vegades</li> <li>El password ha de contindre al menys 2 lletres may\u00fascules</li> <li>Al menys una lletra min\u00fascula \u00e9s necess\u00e0ria</li> <li>Ha de contindre com a m\u00ednim 2 d\u00edgits</li> <li>La pol\u00edtica ha d'aplicar-se tamb\u00e9 a l'usuari root</li> </ul> <p>En quant a la vida \u00fatil de la contrasenya:</p> <ul> <li>La contrasenya caducar\u00e0 als 6 mesos</li> <li>No fa falta esperar cap temps o d\u00eda per a canviar la contrasenya</li> <li>Avisar\u00e0 l'usuari de que la contrasenya caduca als 5 mesos</li> </ul> <p>Per a comprovar la pol\u00edtica, des-de l'usuari ubuntu per a canviar la contrasenya de l'usuari examen_practic pels seg\u00fcents valors:</p> <ol> <li>aBC24</li> <li>AAAAbecedari24</li> <li>Contrasenya.forta.2024</li> <li>CONTRASENYA.FORTA.2024</li> <li>HoAproveSegur1</li> <li>examenSAD2024</li> </ol> <p>Tasca 7 - Pol\u00edtica de contrasenyes</p> <ul> <li>Configura la pol\u00edtica demanada</li> <li>Mostra com cada 3 intents infructuosos, et dona un error.</li> <li>Mostra en els logs on es puguen vore els intents i l'\u00e9xit final, utilitzant el comandament: <code>sudo journalctl | grep passwd</code></li> </ul> <p>Per \u00faltim, l'administrador configurar\u00e0 que cada 3 intents erronis de login per SSH a la m\u00e0quina, eixe compte quedar\u00e0 bloquejat un temps abans de poder tornar a fer login.</p> <p>Tasca 8 - Bloqueig de comptes amb logins erronis</p> <ul> <li>Un amic de l'admin li ha parlat de la eina tally2 per a poder configurar estos bloquejos ja que est\u00e0 utilitzant una versi\u00f3 molt antiga d'Ubuntu</li> <li>Per tal de provar primer i no bloquejar usuaris a tutiplen, ha decidit configurar que als 3 intents de login erronis, es bloqueje el compte durant 15 segons</li> <li>Per a demostrar que est\u00e0 funcionant, mostra la part del log  <code>/var/log/auth</code>on es puga vore, una cosa a continuaci\u00f3 d'una altra, com tally bloqueja el compte i 15 i no deixa fer login per\u00f2 15 segons m\u00e9s tard s\u00ed que deixa. Indica cadascuna de les accions en la captura de pantalla.</li> </ul>"},{"location":"examen_practic_extraordinaria/","title":"Examen pr\u00e0ctic convocat\u00f2ria extraordin\u00e0ria","text":""},{"location":"examen_practic_extraordinaria/#primer-exercici","title":"Primer exercici","text":"<p>En primer lloc, baixem la imatge Docker que utilitzarem per a l'examen:</p> <pre><code>docker pull br3baj3/examen_practic_1er:latest\n</code></pre> <p>I una vegada fet aix\u00f2, executem el contenidor amb el nom examen_container, en background i mapejant el port 8888 de la nostra pr\u00f2pia m\u00e0quina al 2222 del contenidor. Despr\u00e9s comprovarem que el contenidor est\u00e0 corrent sense problemes:</p> <pre><code>docker run --name examen_container -d -p 8888:2222 br3baj3/examen_practic_1er:latest\ndocker ps\n</code></pre>"},{"location":"examen_practic_extraordinaria/#historia-de-dos-ciutats","title":"Hist\u00f2ria de dos ciutats","text":"<p>Per a esta pr\u00e0ctica/examen, assumirem primer el paper d'un atacant/ciberdelincuent i desp\u0155es el de l'administrador de sistemes que vol solucionar el problema.</p>"},{"location":"examen_practic_extraordinaria/#atacant","title":"Atacant","text":"<p>Suposem que el atacant ha aconseguit unes credencials d'alguna forma no molt \u00e9tica i les fa servir.</p> <p>Haurem d'esperar 1 \u00f3 2 minuts per a que finalitze la provisi\u00f3 del contenidor. Passat este temps podrem conectar-nos per SSH: </p> <pre><code>ssh examen_practic@localhost -p8888\n</code></pre> <p>Info</p> <ul> <li> <p>usuari: examen_practic</p> </li> <li> <p>contrasenya: examensad</p> </li> </ul> <p>En primer lloc, l'atacant vol facilitar-se la vida a l'hora de fer servir las credencials i conectar-se a la m\u00e0quina d'una forma m\u00e9s c\u00f2moda.</p> <p>Tasca 1 - Conexi\u00f3 SSH amb claus</p> <p>Crea un parell de claus de 2048 bits amb l'algorisme RSA i copia-les al server per a conectarte mitjan\u00e7ant clau p\u00fablica. Comprova que funciona correctament.</p> <p>Despr\u00e9s d'una intensa auditoria, el ciberdelincuent ha descobert que la m\u00e0quina t\u00e9 una vulnerabilitat del paquet pkexec molt cr\u00edtica anomenada Pwnkit que permet a un usuari escalar privilegis i convertir-se en root.</p> <p>Tasca 2 - Explotaci\u00f3 de la vulnerabilitat</p> <p>Busca un exploit en python per a pwnkit i fes-lo servir a la m\u00e0quina per a convertir-te en root. Despr\u00e9s d'executar-lo introdueix el comandament <code>id</code> com a prova.</p> <p>El ciberdelincuent, aprofitant els seus poders de root, vol cobrir les seues empremtes i per tant, procurar\u00e0 esborrar dels logs les l\u00ednies que facin refer\u00e8ncia al login amb claus (el login original estava amb usuari/contrasenya i una altra cosa al\u00e7ar\u00eda sospites). Per a fer aix\u00f2 utilitzar\u00e0 l'eina vi i no nano.</p> <p>Consell</p> <p>Una vegada aconseguida una shell de root pots obtenir una shell m\u00e9s amigable amb el comadament  <code>/bin/bash</code></p> <p>Tasca 3 - Ocultaci\u00f3 d'evid\u00e8ncies</p> <p>Busca entre els arxius del directori a on s'ubiquen tots els logs del sistema totes les l\u00ednies que facin refer\u00e8ncia a l'usuari examen_practic. Entre eixes l\u00ednies hi haur\u00e0 algunes que facin refer\u00e8ncia al login ssh amb clau p\u00fablica, que tamb\u00e9 pots filtrar si vols.</p> <p>Ara, amb l'eina vi obri l'arxiu d'on hagis d'esborrar les l\u00ednies i esborra nom\u00e9s les que mostren un login amb clau p\u00fablica.</p> <p>Consells</p> <p>Vi \u00e9s una eina un poc especial, alguns consells per a fer-lo servir:</p> <ul> <li>Per pasar al mode d'inserci\u00f3 de text heu de pr\u00e9mer primer la tecla i<ul> <li>En este mode podeu escriure i esborar</li> </ul> </li> <li>Despr\u00e9s d'escriure lo desitjat, heu d'eixir del mode d'inserci\u00f3 prement la tecla ESC</li> <li>Fora del mode d'inserci\u00f3 de text podeu buscar paraules escrivint /terme_a_buscar (important la barra)<ul> <li>Per a buscar la seg\u00fcent coincid\u00e8ncia, premeu n</li> </ul> </li> <li>Per a esborrar una l\u00ednea sencera d'una vegada, fora del mode d'inserci\u00f3 de text, vos coloqueu en la l\u00ednia y premeu dd</li> <li>Per a guardar i eixir, eixiu del mode d'inserci\u00f3 de text (tecla ESC) i escriviu :wq (important els dos punts)</li> </ul> <p>Despr\u00e9s d'esborrar les pistes que el delaten, l'atacant decidix que utilitzar aquest usuari es perill\u00f3s pel risc que t\u00e9 de que el pugen descobrir. Es per aix\u00f2 que ha decidit fer servir un altre usuari. Consultant l'arxiu <code>/etc/passwd</code>ha vist que el mes indicat \u00e9s un anomenat altre_usuari.</p> <p>Tasca 4 - Desxifrat de contrasenya</p> <ol> <li>Treu la l\u00ednia que et fa falta de l'arxiu <code>/etc/shadow</code> </li> <li>Instal\u00b7la johntheripper dins del contenidor i fes-lo servir per a desxifrar la contrasenya<ul> <li>Com a usuari root pots fer <code>apt install john</code></li> </ul> </li> <li>Comprova que, efectivament, pots conectar-te per SSH amb el nou usuari</li> </ol>"},{"location":"examen_practic_extraordinaria/#administrador-de-sistemes","title":"Administrador de sistemes","text":"<p>Despr\u00e9s d'una \u00e0rdua tasca d'investigaci\u00f3, el administrador de sistemes ha descobert quina es la vulnerabilitat que ha fet servir l'atacant i ha de procedir a solucionar-la.</p> <p>L'administrador t\u00e9 un usuari propi:</p> <p>Info</p> <ul> <li> <p>usuari: ubuntu</p> </li> <li> <p>contrasenya: iessevero</p> </li> </ul> <p>Tasca 5 - Mitigaci\u00f3</p> <ol> <li>Busca informaci\u00f3 de com mitigar la vulnerabilitat i posa-lo en pr\u00e0ctica.</li> <li>Busca informaci\u00f3 sobre com solucionar-lo i indica el comandament que ser\u00eda necessari introdu\u00efr per a fer-lo.</li> <li>Comprova que l'exploit ja no funciona</li> </ol> <p>Atenci\u00f3!</p> <p>La tasca es considera correcta amb la mitigaci\u00f3 i la indicaci\u00f3 de com solucionar-lo. En cas de que vulgues fer-lo m\u00e9s real, pots fet l'actualitzaci\u00f3 necess\u00e0ria per\u00f2 pot trigar molt de temps. Tens dos opcions, o deixar indicat el comandament o executar-lo i deixar-lo funcionar mentres continues amb l'examen.</p> <p>Per a augmentar un poc la seguretat, l'administrador decideix aplicar una nova pol\u00edtica de contrasenyes. Concretament aplicar\u00e0 els seg\u00fcents par\u00e0metres:</p> <ul> <li>Al ficar el nou password, si no compleix la pol\u00edtica, nom\u00e9s deixar\u00e0 3 intents abans de tornar un error</li> <li>La longitud m\u00ednima del password ha de ser 12 car\u00e0cters</li> <li>Nom\u00e9s deixa que la contrasenya continga el mateix car\u00e1cter consecutiu 3 vegades</li> <li>El password ha de contindre al menys 2 lletres may\u00fascules</li> <li>Al menys una lletra min\u00fascula \u00e9s necess\u00e0ria</li> <li>Ha de contindre com a m\u00ednim 2 d\u00edgits</li> <li>La pol\u00edtica ha d'aplicar-se tamb\u00e9 a l'usuari root</li> </ul> <p>En quant a la vida \u00fatil de la contrasenya:</p> <ul> <li>La contrasenya caducar\u00e0 als 6 mesos</li> <li>No fa falta esperar cap temps o d\u00eda per a canviar la contrasenya</li> <li>Avisar\u00e0 l'usuari de que la contrasenya caduca als 5 mesos</li> </ul> <p>Per a comprovar la pol\u00edtica, des-de l'usuari ubuntu per a canviar la contrasenya de l'usuari examen_practic pels seg\u00fcents valors:</p> <ol> <li>aBC24</li> <li>AAAAbecedari24</li> <li>Contrasenya.forta.2024</li> <li>CONTRASENYA.FORTA.2024</li> <li>HoAproveSegur1</li> <li>examenSAD2024</li> </ol> <p>Tasca 6 - Pol\u00edtica de contrasenyes</p> <ul> <li>Configura la pol\u00edtica demanada</li> <li>Mostra com cada 3 intents infructuosos, et dona un error.</li> <li>Mostra en els logs on es puguen vore els intents i l'\u00e9xit final, utilitzant el comandament: <code>sudo journalctl | grep passwd</code></li> </ul>"},{"location":"examen_practic_extraordinaria/#segon-exercici","title":"Segon exercici","text":"<p>Donat el seg\u00fcent escenari:</p> <p></p> <ol> <li>El client pot fer <code>curl</code> al webserver</li> <li>El client pot fer consultes DNS al servidor DNS amb <code>nslookup domini dnsserver</code> o per ip <code>nslookup domini $IP_DNS_SERVER</code></li> <li>El client pot fer ping a tots els servidors</li> <li>Podr\u00e0s conectar-te a la VPN</li> </ol> <p>Si conectes a la VPN (<code>wg-quick up wg0</code>), podr\u00e0s vore que:</p> <ol> <li>Continues podent fer consultes DNS al servidor DNS</li> <li>No pots fer <code>curl</code> al webserver</li> </ol> <p>Desconecta't de la VPN (<code>wg-quick down wg0</code>)</p> <p>Ara, dins del contenidor del firewall, aplica l'arxiu de regles que trobar\u00e0s en <code>/usr/local/bin</code>.</p> <ol> <li>Ara podr\u00e0s fer ping als servidors</li> <li>Per\u00f2 no podr\u00e0s fer consultes DNS al servidor DNS per\u00f2 s\u00ed <code>curl</code> al webserver</li> <li>No podr\u00e0s conectar-te a la VPN</li> </ol> <p>Tasca</p> <p>Afegix les regles necess\u00e0ries a l'arxiu de regles de nftables per tal de que:</p> <ul> <li>Pugues conectar-te a la VPN</li> <li>Una vegada conectat a la VPN, pugues fer curl al webserver</li> <li>Una vegada conectat a la VPN, pugues fer consultes DNS al servidor DNS</li> <li>Col\u00b7loca contadors en totes les regles</li> </ul> <p>Atenci\u00f3!</p> <ul> <li>Recorda que \u00e9s possible que hagis de fer canvis en la configuraci\u00f3 de la VPN tamb\u00e9</li> <li>Pots regenerar la configuraci\u00f3 amb <code>docker compose up -d wireguard</code></li> <li>Recorda copiar-la al <code>client1</code></li> <li>Fes les comprovacions oportunes i mostra totes les regles amb contadors &gt; 0</li> </ul> <p>Tip</p> <ul> <li>Per facilitat, fixa't si pots canviar els arxius que necessites des d'el teu ordinador fent servir els volums de Docker.</li> <li>Per a conectar-te als contenidors: <code>docker exec -it nom /bin/bash</code></li> <li>Els contenidors tenen <code>tcpdump</code> instal\u00b7lat per a fer comprovacions</li> </ul>"},{"location":"firewall/","title":"Teor\u00eda de firewalls","text":""},{"location":"firewall/#firewalls","title":"Firewalls","text":""},{"location":"firewall/#que-es-un-firewall","title":"\u00bfQu\u00e9 es un Firewall?","text":"<p>Un firewall (cortafuegos en espa\u00f1ol) es un dispositivo o software que se utiliza para controlar y monitorear el tr\u00e1fico de red que entra y sale de un sistema o red, de acuerdo con un conjunto de reglas predefinidas. Los firewalls son una de las principales herramientas de seguridad utilizadas en redes y sistemas inform\u00e1ticos para protegerlos de accesos no autorizados, ataques maliciosos y otros riesgos de seguridad.</p> <p></p> <p>El objetivo principal de un firewall es separar las redes internas (seguras) de las externas (potencialmente inseguras), como Internet. Esto se logra filtrando el tr\u00e1fico de red que atraviesa el sistema, de manera que solo se permita el tr\u00e1fico autorizado, y se bloquee el tr\u00e1fico no deseado.</p>"},{"location":"firewall/#tipos-de-firewalls","title":"Tipos de Firewalls","text":"<p>Existen varios tipos de firewalls, cada uno con un enfoque diferente para proteger las redes.</p> <p></p> <ol> <li>Firewalls de Filtrado de Paquetes (Packet Filtering Firewalls)</li> </ol> <p>Los firewalls de filtrado de paquetes son la forma m\u00e1s b\u00e1sica. Funcionan a nivel de la capa de red (Capa 3 del modelo OSI), y se centran en inspeccionar los encabezados de los paquetes de red. Deciden si un paquete debe ser permitido o bloqueado bas\u00e1ndose en reglas predefinidas como:</p> <ul> <li> <p>Direcci\u00f3n IP de origen o destino.</p> </li> <li> <p>Puerto de origen o destino.</p> </li> <li> <p>Protocolo (TCP, UDP, ICMP).</p> </li> <li> <p>Estado de la conexi\u00f3n (en algunos casos).</p> </li> </ul> <p>Ventajas:</p> <ul> <li> <p>R\u00e1pidos y eficientes en t\u00e9rminos de rendimiento.</p> </li> <li> <p>Simples de implementar.</p> </li> </ul> <p>Desventajas:</p> <ul> <li> <p>No son capaces de inspeccionar el contenido del paquete ni de mantener el estado de las conexiones.</p> </li> <li> <p>Firewalls de Inspecci\u00f3n de Estado (Stateful Firewalls)</p> </li> </ul> <p>A diferencia de los firewalls de filtrado de paquetes, los firewalls de inspecci\u00f3n de estado mantienen el estado de las conexiones. Esto significa que no solo inspeccionan los paquetes de red, sino que tambi\u00e9n conocen el contexto de las conexiones que est\u00e1n permitiendo o bloqueando. Por ejemplo, un firewall stateful puede verificar si un paquete de respuesta corresponde a una solicitud previamente enviada desde dentro de la red.</p> <p>Ventajas:</p> <ul> <li> <p>Son m\u00e1s seguros que los firewalls de filtrado de paquetes porque pueden rastrear el estado de las conexiones.</p> </li> <li> <p>Pueden tomar decisiones m\u00e1s inteligentes basadas en el estado de la conexi\u00f3n.</p> </li> </ul> <p>Desventajas:</p> <ul> <li> <p>Mayor consumo de recursos, ya que necesita mantener informaci\u00f3n sobre el estado de cada conexi\u00f3n.</p> </li> <li> <p>Puede ser m\u00e1s complejo de configurar.</p> </li> <li> <p>Firewalls de Inspecci\u00f3n Profunda de Paquetes (Deep Packet Inspection - DPI)</p> </li> </ul> <p>Estos firewalls son mucho m\u00e1s avanzados y se encargan de inspeccionar tanto los encabezados como el contenido de los paquetes. Permiten detectar ciertos tipos de tr\u00e1fico o patrones espec\u00edficos, como aplicaciones maliciosas, malware, o intentos de intrusi\u00f3n. Son capaces de filtrar el tr\u00e1fico a un nivel m\u00e1s detallado, lo que proporciona un control m\u00e1s preciso sobre qu\u00e9 tr\u00e1fico es permitido y qu\u00e9 tr\u00e1fico es bloqueado.</p> <p>Ventajas:</p> <ul> <li> <p>Proporcionan una capa de seguridad adicional, permitiendo la detecci\u00f3n de amenazas complejas.</p> </li> <li> <p>Pueden bloquear tr\u00e1fico de aplicaciones no deseadas o maliciosas (como malware, virus, etc.).</p> </li> </ul> <p>Desventajas:</p> <ul> <li> <p>Requieren m\u00e1s recursos de procesamiento y pueden afectar el rendimiento.</p> </li> <li> <p>Son m\u00e1s complejos de configurar y gestionar.</p> </li> <li> <p>Firewalls de Aplicaci\u00f3n (Application Firewalls)</p> </li> </ul> <p>Los firewalls de aplicaci\u00f3n se centran en proteger aplicaciones espec\u00edficas, como servidores web o bases de datos, de ataques que explotan vulnerabilidades a nivel de la aplicaci\u00f3n (por ejemplo, ataques como SQL injection, XSS, etc.). Estos firewalls operan en la capa 7 del modelo OSI (capa de aplicaci\u00f3n).</p> <p>Ventajas:</p> <ul> <li> <p>Protegen aplicaciones espec\u00edficas de amenazas que otros firewalls no pueden detectar.</p> </li> <li> <p>Pueden ofrecer una mayor granularidad en el control del tr\u00e1fico.</p> </li> </ul> <p>Desventajas:</p> <ul> <li> <p>Necesitan ser configurados espec\u00edficamente para cada aplicaci\u00f3n.</p> </li> <li> <p>Pueden ser m\u00e1s dif\u00edciles de implementar y mantener.</p> </li> </ul>"},{"location":"firewall/#nftables-vs-iptables","title":"Nftables vs Iptables","text":"<p>Nftables \u00e9s el reempla\u00e7ament modern de iptables a Linux, introdu\u00eft per abordar diverses limitacions d'iptables alhora que ofereix una funcionalitat i un rendiment millorats.</p>"},{"location":"firewall/#estat-actual","title":"Estat actual:","text":"<ul> <li>Tot i que iptables no est\u00e0 completament obsolet, nftables ha estat el marc de filtratge de paquets predeterminat a la majoria de distribucions principals de Linux des del 2018 (per exemple, Debian 10+, Ubuntu 20.04+ i CentOS 8+).</li> <li>La capa de compatibilitat (<code>iptables-nft</code>) permet als usuaris gestionar les regles d'iptables existents al backend de nftables, suavitzant la transici\u00f3.</li> </ul> <p>Tot i que iptables encara \u00e9s funcional i s'utilitza \u00e0mpliament, cada cop s'est\u00e0 eliminant gradualment a favor de nftables. Ac\u00ed teniu una visi\u00f3 general de per qu\u00e8 nftables es considera el successor:</p>"},{"location":"firewall/#1-per-que-iptables-esta-en-desus","title":"1. Per qu\u00e8 iptables est\u00e0 en des\u00fas:","text":"<ul> <li> <p>Complexitat i manteniment:  iptables utilitza eines separades per gestionar diferents tipus de paquets (per exemple, <code>iptables</code>, <code>ip6tables</code>, <code>ebtables</code>). Aix\u00f2 crea redund\u00e0ncia i complica la gesti\u00f3 de regles.</p> </li> <li> <p>Problemes de rendiment:  iptables t\u00e9 un mecanisme de concordan\u00e7a de regles lineal, \u00e9s a dir, cada paquet ha de travessar totes les regles de manera seq\u00fcencial, cosa que pot provocar inefici\u00e8ncies en grans conjunts de regles.</p> </li> <li> <p>Manca de flexibilitat:  Les regles d'iptables s\u00f3n est\u00e0tiques i la implementaci\u00f3 de casos d'\u00fas m\u00e9s complexos (per exemple, actualitzacions din\u00e0miques de regles o filtratge avan\u00e7at) \u00e9s complicat.</p> </li> <li> <p>Sense marc unificat:  Com que t\u00e9 m\u00faltiples eines per a IPv4, IPv6 i Ethernet, no t\u00e9 una interf\u00edcie unificada, cosa que la fa menys eficient per gestionar entorns de xarxa moderns i heterogenis.</p> </li> </ul>"},{"location":"firewall/#2-avantatges-de-nftables","title":"2. Avantatges de nftables:","text":"<ul> <li> <p>Marc unificat:  nftables utilitza una \u00fanica utilitat (<code>nft</code>) per gestionar el filtratge d'IPv4, IPv6 i Ethernet, racionalitzant la gesti\u00f3.</p> </li> <li> <p>Rendiment millorat:  nftables utilitza una representaci\u00f3 interna de regles m\u00e9s eficient, amb estructures de dades com taules hash i intervals per a una concordan\u00e7a m\u00e9s r\u00e0pida.</p> </li> <li> <p> Sintaxi m\u00e9s senzilla:  La sintaxi de la regla nftables \u00e9s m\u00e9s compacta i m\u00e9s f\u00e0cil d'entendre que iptables.</p> </li> <li> <p>Actualitzacions de regles din\u00e0miques:  Les regles es poden actualitzar din\u00e0micament sense esborrar ni interrompre els conjunts de regles existents.</p> </li> <li> <p>Compatibilitat enrere:  Les regles d'iptables es poden traduir a nftables mitjan\u00e7ant la capa de compatibilitat <code>iptables-nft</code>.</p> </li> <li> <p>Extensibilitat:  nftables est\u00e0 dissenyat per donar suport a funcions futures, com ara la classificaci\u00f3 de paquets ampliada i accions avan\u00e7ades, fent-lo m\u00e9s a prova de futur.</p> </li> </ul>"},{"location":"firewall/#recomanacio","title":"Recomanaci\u00f3:","text":"<p>Si esteu comen\u00e7ant un projecte nou o revisant una configuraci\u00f3 de tallafocs existent, considereu canviar a nftables per les seves funcions modernes i per al futur. Eines com firewalld a Linux tamb\u00e9 es construeixen ara sobre nftables, emfatitzant encara m\u00e9s la seva adopci\u00f3.</p>"},{"location":"firewall/#conceptos-clave-en-el-funcionamiento-de-un-firewall","title":"Conceptos Clave en el Funcionamiento de un Firewall","text":"<ol> <li>Reglas (Rules):</li> </ol> <p>Las reglas de un firewall definen las condiciones bajo las cuales el tr\u00e1fico es permitido o denegado. Las reglas son evaluadas en orden, y el tr\u00e1fico se compara contra ellas para decidir si es permitido o no. Las reglas t\u00edpicamente contienen:</p> <ul> <li> <p>Direcci\u00f3n de origen y destino (direcci\u00f3n IP).</p> </li> <li> <p>Puertos de origen y destino.</p> </li> <li> <p>El protocolo utilizado (TCP, UDP, ICMP, etc.).</p> </li> <li> <p>La acci\u00f3n (permitir o bloquear).</p> </li> <li> <p>Cadenas (Chains):</p> </li> </ul> <p>Las cadenas son las secuencias de reglas que un firewall aplica al tr\u00e1fico entrante y saliente. Una cadena define c\u00f3mo se debe manejar el tr\u00e1fico seg\u00fan su direcci\u00f3n (entrada, salida o tr\u00e1nsito) o su tipo. Por ejemplo:</p> <ul> <li> <p><code>INPUT</code>: Controla el tr\u00e1fico que entra al sistema.</p> </li> <li> <p><code>OUTPUT</code>: Controla el tr\u00e1fico que sale del sistema.</p> </li> <li> <p><code>FORWARD</code>: Controla el tr\u00e1fico que pasa a trav\u00e9s del sistema, pero no est\u00e1 destinado al propio sistema.</p> </li> <li> <p>Tablas (Tables):</p> </li> </ul> <p>Las tablas son contenedores que agrupan las cadenas. En Linux, las tablas m\u00e1s comunes son:</p> <ul> <li> <p>filter: Para el filtrado de tr\u00e1fico (reglas de firewall).</p> </li> <li> <p>nat: Para la manipulaci\u00f3n de direcciones de red (como NAT y port forwarding).</p> </li> <li> <p>mangle: Para modificar los paquetes de red.</p> </li> <li> <p>raw: Para configuraciones de bajo nivel, como habilitar o deshabilitar la conexi\u00f3n de seguimiento de estado.</p> </li> <li> <p>Pol\u00edticas Predeterminadas (Default Policies):</p> </li> </ul> <p>Si un paquete no coincide con ninguna regla en una cadena, se aplica la pol\u00edtica predeterminada de la cadena. Las pol\u00edticas predeterminadas pueden ser de dos tipos:</p> <ul> <li> <p><code>ACCEPT</code>: Permitir el tr\u00e1fico.</p> </li> <li> <p><code>DROP</code>: Bloquear el tr\u00e1fico sin notificar.</p> </li> </ul>"},{"location":"firewall/#implementacion-practica-con-nftables","title":"Implementaci\u00f3n Pr\u00e1ctica con nftables","text":"<p>nftables es la herramienta moderna para gestionar firewalls en Linux. A partir del kernel 3.13, nftables reemplaz\u00f3 a iptables, ip6tables, arptables y ebtables. Su objetivo es unificar y simplificar la configuraci\u00f3n de firewalls en sistemas Linux.</p>"},{"location":"firewall/#pasos-basicos-para-usar-nftables","title":"Pasos B\u00e1sicos para Usar nftables","text":"<ol> <li>Comprobar si nftables est\u00e1 disponible:</li> </ol> <p>Antes de empezar, aseg\u00farate de que nftables est\u00e9 instalado y habilitado. Para ver si est\u00e1 en uso, puedes usar el siguiente comando:</p> <pre><code>sudo nft list ruleset\n</code></pre> <p>Este comando te mostrar\u00e1 las reglas actuales que se est\u00e1n aplicando en el sistema.</p> <ol> <li>Crear una tabla de filtrado:</li> </ol> <p>Las tablas contienen las cadenas y reglas. Para crear una tabla de filtrado, usamos el siguiente comando:</p> <pre><code>sudo nft add table ip filter\n</code></pre> <p>Esto crea una tabla llamada <code>filter</code> para IPv4. Si est\u00e1s trabajando con IPv6, se usar\u00eda <code>ip6</code>.</p> <ol> <li>Crear una cadena:</li> </ol> <p>Ahora, vamos a crear una cadena dentro de la tabla <code>filter</code> para controlar el tr\u00e1fico de entrada:</p> <pre><code>sudo nft add chain ip filter input { type filter hook input priority 0 \\; }\n</code></pre> <p>En este caso, estamos creando la cadena <code>input</code>, que se engancha al \"hook\" de entrada. La opci\u00f3n <code>priority 0</code> especifica la prioridad de la cadena.</p> <ol> <li>A\u00f1adir reglas de filtrado:</li> </ol> <p>Ahora podemos agregar reglas para controlar el tr\u00e1fico que entra al sistema. Por ejemplo:</p> <ul> <li>Permitir tr\u00e1fico desde una IP espec\u00edfica:</li> </ul> <pre><code>sudo nft add rule ip filter input ip saddr 192.168.1.1 accept\n</code></pre> <ul> <li>Bloquear tr\u00e1fico desde una IP espec\u00edfica:</li> </ul> <pre><code>sudo nft add rule ip filter input ip saddr 10.0.0.1 drop\n</code></pre> <ul> <li>Permitir tr\u00e1fico HTTP y SSH:</li> </ul> <pre><code>sudo nft add rule ip filter input tcp dport {22, 80} accept\n</code></pre> <ul> <li>Rechazar todo el tr\u00e1fico entrante por defecto:</li> </ul> <pre><code>sudo nft add rule ip filter input drop\n</code></pre> <ol> <li>Ver las reglas configuradas:</li> </ol> <p>Para revisar las reglas que has configurado, puedes utilizar el siguiente comando:</p> <pre><code>sudo nft list ruleset\n</code></pre> <p>Este comando te mostrar\u00e1 todas las tablas, cadenas y reglas configuradas en el sistema.</p> <ol> <li>Guardar las reglas:</li> </ol> <p>Para asegurarte de que las reglas se apliquen despu\u00e9s de un reinicio, debes guardarlas en un archivo:</p> <pre><code>sudo nft list ruleset &gt; /etc/nftables.conf\n</code></pre> <p>Luego, para restaurarlas al reiniciar el sistema, puedes usar:</p> <pre><code>sudo nft -f /etc/nftables.conf\n</code></pre>"},{"location":"firewall/#ejemplo-completo-de-configuracion-de-un-firewall-basico-con-nftables","title":"Ejemplo Completo de Configuraci\u00f3n de un Firewall B\u00e1sico con nftables","text":"<p>Imagina que quieres crear un firewall b\u00e1sico con las siguientes reglas:</p> <ul> <li> <p>Permitir todo el tr\u00e1fico desde la red interna (192.168.1.0/24).</p> </li> <li> <p>Bloquear todo el tr\u00e1fico desde la IP 10.0.0.1.</p> </li> <li> <p>Permitir tr\u00e1fico HTTP (puerto 80) y SSH (puerto 22).</p> </li> <li> <p>Denegar todo el tr\u00e1fico por defecto.</p> </li> </ul> <p>Los comandos ser\u00edan:</p> <pre><code># Esborrar regles anteriors\nsudo nft flush ruleset\n\n# Crear la tabla de filtrado\nsudo nft add table ip filter\n\n# Crear la cadena de entrada\nsudo nft add chain ip filter input { type filter hook input priority 0 \\; policy drop \\; }\n# Crear cadena per a permetre el pas de tr\u00e0fic a trav\u00e9s del firewall\nsudo nft add chain ip filter forward { type filter hook forward priority 0 \\; policy drop \\; }\n# Crear la cadena de entrada d'eixida\nsudo nft add chain inet my_table output { type filter hook output priority 0 \\; policy accept \\; }\n# Permitir tr\u00e1fico desde la red interna\nsudo nft add rule ip filter input ip saddr 192.168.1.0/24 accept\n\n# Bloquear tr\u00e1fico desde la IP 10.0.0.1\nsudo nft add rule ip filter input ip saddr 10.0.0.1 drop\n\n# Permitir tr\u00e1fico HTTP y SSH\nsudo nft add rule ip filter input tcp dport {22, 80} accept\n\n# Ver las reglas configuradas\nsudo nft list ruleset\n\n# Guardar las reglas\nsudo nft list ruleset &gt; /etc/nftables.conf\n</code></pre> <p>Con estos pasos, habr\u00e1s configurado un firewall b\u00e1sico usando nftables que protege tu sistema de accesos no deseados.</p>"},{"location":"fw-ics/","title":"Administraci\u00f3 de regles d'iptables en un entorn industrial","text":""},{"location":"fw-ics/#introduccio","title":"Introducci\u00f3","text":"<p>Atenci\u00f3!</p> <p>Heu de fer servir el laboratori de Labtrainer <code>iptables-ics</code></p> <p>Este laboratori simula l'\u00fas de Iptables per a limitar l'acc\u00e9s a la xarxa d'un component PLC en un entorn indistrial o de tecnolog\u00eda operativa.</p> <p>L'escenari concret s'il\u00b7lustra en la seg\u00fcent imatge:</p> <p></p> <p>Quan la configuraci\u00f3 \u00e9s correcta:</p> <ul> <li>El client 1 nom\u00e9s pot accedir al PLC via SSH i HTTP (port 8080)</li> <li>El client 2 nom\u00e9s pot accedir al PLC mitjan\u00e7ant MODBUS TCP i HTTP (ports 80 i 8080)</li> </ul>"},{"location":"fw-ics/#realitzacio-del-laboratori","title":"Realitzaci\u00f3 del laboratori","text":"<p>Inicieu el laboratori com ja sabeu</p> <pre><code>labtainer iptables-ics\n</code></pre> <p>I espereu a que vos retorne els terminals corresponents.</p> <ul> <li> <p>Wireshark est\u00e0 instal\u00b7lat en el contenidor que fa de firewall, utilitzeu-lo per a vore el tr\u00e0fic que atravesa el firewall i per a depurar les vostres regles (interfaz <code>etho</code>)</p> <p><pre><code>wireshark &amp;\n</code></pre> + Tant en el client 1 com en el 2 per a explorar el serveis oferits pel PLC, podeu fer servir: <pre><code>./mbtcp-simple.py\n</code></pre> El que iniciar\u00e0 un client MODBUS senzill. Observa amb Wireshark el tr\u00e0fic que es genera, notant quin port TCP com a dest\u00ed utilitza el client quan es conecta amb el PLC.</p> </li> <li> <p>Inicia Firefox en cada client:     <pre><code>firefox &amp;\n</code></pre>   I accedeix a:</p> <pre><code>http://plc:8080\n\nhttp://plc:80\n</code></pre> </li> <li> <p>Per \u00faltim, accedeix per ssh des dels clients al PLC (no fa falta establir la conexi\u00f3, nom\u00e9s comprobar que n'hi ha acc\u00e9s):</p> <pre><code>ssh plc\n</code></pre> </li> </ul> <p>Tasca</p> <p>Fent \u00fas de Iptables instal\u00b7lat en el contenidor que fa de firewall, escriu unes regles per a que:</p> <ol> <li>El client 1 nom\u00e9s puga accedir al PLC per SSH i HTTP (port 8080 \u00fanicament)</li> <li>El client 2 nom\u00e9s tinga acc\u00e9s mitjan\u00e7ant MODBUS TCP i HTTP (ports 80 i 8080)</li> <li>No se permeteix cap altre t\u00e0fic dels clients al PLC</li> <li>Inclou una regla que puga logar totes les accions</li> </ol> <p>Tip</p> <p>Podeu agafar com a referencia el script d'exemple que teniu al firewall <code>example_fw.sh</code></p> <p>Fixeu-vos que en este script les IP poden ser diferents de les que vosaltres necessiteu. </p> <p>L'\u00faltima l\u00ednea del script loguea els missagte a: <code>/var/log/iptables.log</code>. Si incloeu esta directiva en la vostra configuraci\u00f3, podeu observar quan iptables fa drop dels paquets pertinents.</p> <p>Tasca</p> <p>Fent \u00fas del comando <code>tail -f /var/log/iptables.log</code>, mostra que es fa drop de paquets que no han d'estar permesos per Iptables.</p> <p>Mostra-lo igualment a Wireshark.</p>"},{"location":"idps/","title":"Monitorizaci\u00f3n mediante sistemas detectores de intrusos (IDS) y sistemas de prevenci\u00f3n de intrusos (IPS)","text":""},{"location":"idps/#introduccion","title":"Introducci\u00f3n","text":"<p>En esta secci\u00f3n vamos a hacer una revisi\u00f3n de los IDS, los IPS y, de refil\u00f3n, de los SIEM.  Se trata de tres herramientas que, aunque parecidas, contribuyen de forma diferente a la protecci\u00f3n de nuestras redes y sistemas. Estamos hablando de unas herramientas de monitorizaci\u00f3n puesto que examinan el tr\u00e1fico que entra y/o sale de nuestra red en b\u00fasqueda de comportamientos sospechosos.</p> <p></p>"},{"location":"idps/#ids","title":"IDS","text":"<p>Son sistemas que monitorizan el tr\u00e1fico entrante y lo cotejan con una base de datos actualizada de firmas de ataque conocidas. Ante cualquier actividad sospechosa, emiten una alerta a los administradores del sistema quienes han de tomar las medidas oportunas. Estos accesos pueden ser ataques espor\u00e1dicos realizados por usuarios malintencionados o repetidos cada cierto tiempo, lanzados con herramientas autom\u00e1ticas. Estos sistemas s\u00f3lo detectan los accesos sospechosos emitiendo alertas anticipatorias de posibles intrusiones, pero no tratan de mitigar la intrusi\u00f3n. Su actuaci\u00f3n es reactiva.</p>"},{"location":"idps/#como-funcionan-los-ids","title":"\u00bfC\u00f3mo funcionan los IDS?","text":"<p>Podemos distinguir dos tipos de IDS:</p> <ol> <li>NIDS (Network-based intrusion detections systems): Monitorizan el tr\u00e1fico de dos formas; o bien configur\u00e1ndolo para que todo el tr\u00e1fico de la red pase a trav\u00e9s de \u00e9l o haciendo un port mirroring.</li> <li>HIDS (Host-based intrusion detections systems): Se configura un sistema para comprobar actividad sospechosa o an\u00f3mala en un host concreto en lugar de en toda la red. Esto limita en gran medida los dipositivos que se monitorizan pero permite detectar con mayor detalle amenazas en ese host.</li> </ol> <p>T\u00edpicamente se utilizan tres metodolog\u00edas para detectar incidentes:</p> <ul> <li> <p>Basada en firmas: compara las firmas con los eventos observados para identificar posibles incidentes. Se trata del m\u00e9todo de detecci\u00f3n m\u00e1s sencillo, ya que compara \u00fanicamente la unidad de actividad actual (como por ejemplo un paquete o una entrada de log) contra una lista de firmas mediante operaciones de comparaci\u00f3n de cadenas.      Estas firmas permiten al IDS distinguir entre el uso normal del PC y el uso fraudulento, y/o entre el tr\u00e1fico normal de la red y el tr\u00e1fico que puede ser resultado de un ataque o intento del mismo y sonpatrones de ataque preconfigurados y predeterminados.</p> <p></p> </li> <li> <p>Detecci\u00f3n basada en anomal\u00edas: compara las definiciones de lo que se considera una actividad normal con los eventos observados para identificar desviaciones significativas. Este m\u00e9todo de detecci\u00f3n puede ser muy eficaz para detectar amenazas desconocidas hasta ahora.</p> <p></p> </li> <li> <p>An\u00e1lisis de protocolos de estado: utiliza informaci\u00f3n sobre las conexiones entre hosts y la compara con las entradas de una tabla de estado. La tabla de estado mantiene un registro de la conexi\u00f3n entre las computadoras que incluye: direcci\u00f3n IP de origen y puerto, direcci\u00f3n IP de destino y puerto, y los protocolos que se utilizan.      Este m\u00e9todo busca cambios repentinos o bruscos en la actividad de la red. Otras funciones incluyen a veces el seguimiento del estado del protocolo, los an\u00e1lisis din\u00e1micos del protocolo de aplicaci\u00f3n y el reensamblaje de paquetes IP, lo que evita que fragmentos de paquetes IP lleguen a la red interna.</p> <p>Entre las ventajas del an\u00e1lisis de protocolo de estado est\u00e1n:</p> <ul> <li>Identifica secuencias inesperadas de comandos.</li> <li>A\u00f1ade caracter\u00edsticas de estado al an\u00e1lisis regular de protocolos.</li> <li>Comprueba la racionalidad de los umbrales de los comandos individuales.</li> </ul> <p>Entre las desventajas est\u00e1n:</p> <ul> <li>Uso intensivo de recursos, sobrecarga de recursos elevada.</li> <li>No puede detectar ataques que no violen las caracter\u00edsticas de comportamiento del protocolo generalmente aceptado.</li> <li>Presenta conflictos entre el modelo de protocolo utilizado por el sistema y c\u00f3mo se implementa realmente el protocolo.</li> </ul> </li> </ul>"},{"location":"idps/#ips","title":"IPS","text":"<p>IPS (Intrusion Prevention System) o sistema de prevenci\u00f3n de intrusiones: es un software que se utiliza para proteger a los sistemas de ataques e intrusiones. Como su nombre indica, su actuaci\u00f3n es de car\u00e1cter preventivo. </p> <p>Estos sistemas llevan a cabo un an\u00e1lisis en tiempo real de las conexiones y los protocolos para determinar si se est\u00e1 produciendo o se va a producir un incidente, identificando ataques seg\u00fan patrones, anomal\u00edas o comportamientos sospechosos y permitiendo el control de acceso a la red, implementando pol\u00edticas que se basan en el contenido del tr\u00e1fico monitorizado, es decir, el IPS adem\u00e1s de lanzar alarmas, puede descartar paquetes y desconectar conexiones.</p> <p></p> <p>Muchos proveedores ofrecen productos mixtos, llam\u00e1ndolos IPS/IDS, integr\u00e1ndose frecuentemente con cortafuegos y UTM (en ingl\u00e9s Unified Threat Management o Gesti\u00f3n Unificada de Amenazas) que controlan el acceso en funci\u00f3n de reglas sobre protocolos y sobre el destino u origen del tr\u00e1fico.</p> <p></p>"},{"location":"idps/#limitaciones-de-de-los-idsips","title":"Limitaciones de de los IDS/IPS","text":"<p>No todo es bonito con estos sistemas, algunos de sus handicaps m\u00e1s importantes son:</p> <ul> <li>Un IDS s\u00f3lo detectar\u00e1 lo que est\u00e9 configurado para detectar. Es decir, est\u00e1n limitados \u00fanicamente a detectar ataques ya conocidos. </li> <li>Son completamente dependientes de las reglas que escribamos o les carguemos y esto lleva inevitablemente a los falsos positivos. Una regla configurada para detectar un ataque tambi\u00e9n puede generar una alerta ante tr\u00e1fico leg\u00edtimo si \u00e9sta no ha sido configurada con sumo cuidado o si el ataque usa un patr\u00f3n com\u00fan de tr\u00e1fico.</li> <li>Capacidades limitadas ante tr\u00e1fico cifrado.</li> <li>Su visibilidad est\u00e1 limitada en funci\u00f3n de d\u00f3nde se coloquen en la red.</li> </ul>"},{"location":"idps/#siem","title":"SIEM","text":"<p>SIEM (Security Information and Event Management) o sistema de gesti\u00f3n de eventos e informaci\u00f3n de seguridad: es una soluci\u00f3n h\u00edbrida centralizada que engloba la gesti\u00f3n de informaci\u00f3n de seguridad (Security Information Management) y la gesti\u00f3n de eventos (Security Event Manager). </p> <p>La tecnolog\u00eda SIEM proporciona un an\u00e1lisis en tiempo real de las alertas de seguridad generadas por los distintos dispositivos hardware y software de la red. Recoge los registros de actividad (logs) de los distintos sistemas, los relaciona y detecta eventos de seguridad, es decir, actividades sospechosas o inesperadas que pueden suponer el inicio de un incidente, descartando los resultados an\u00f3malos, tambi\u00e9n conocidos como falsos positivos y generando respuestas acordes en base a los informes y evaluaciones que registra, es decir, es una herramienta en la que se centraliza la informaci\u00f3n y se integra con otras herramientas de detecci\u00f3n de amenazas.</p> <p></p>"},{"location":"idps/#suricata","title":"Suricata","text":"<p>Suricata es un sistema de detecci\u00f3n de c\u00f3digo abierto que puede actuar tanto como IDS como IPS. Su desarrollo corresponde a Open Information Security Foundation (OSIF). Utiliza un set de reglas y firmas que permite detectar y prevenir amenazas. Puede correr en Windows, Mac, Unix y Linux.</p> <p></p>"},{"location":"idps/#suricata-vs-snort","title":"Suricata vs Snort","text":"<p>Snort es el otro gran actor conocido en el juego de los IDS. Tambi\u00e9n de c\u00f3digo abierto, aunque posee dos sets de reglas principales: las community edition y las de suscriptor. Estas \u00faltimas son de pago y est\u00e1n desarrolladas, probadas y aprobadas por el grupo de seguridad de Cisco, Talos. </p> <p></p> <p>En esencia, Suricata permite acciones por defecto (principalmente relacionadas con la funcionalidad de IPS), que Snort no. No obstante, con una serie de modificaciones es posible hacer que la funcionalidad de Snort pueda ser casi igual, sino igual, a la de Suricata. A\u00fan con todo esto y siempre sin tener en cuenta preferencias personales, podemos destacar algunas ventajas de Suricata:</p> <ul> <li>Trabaja con multithreading. Esto representa una gran ventaja puesto que a d\u00eda de hoy es normal analizar grandes cantidades de tr\u00e1fico que requieren un gran procesado, por lo que sin duda este punto marca una gran diferencia.</li> <li>Es multitenancy. Esto quiere decir que podemos tener diferentes conjuntos de reglas aplic\u00e1ndose al mismo tiempo y asignar cada una de ellas a una VLAN diferente, por ejemplo.</li> <li>Se podr\u00eda decir que el logging de Suricata es de mejor calidad y que permite extraer mayor informaci\u00f3n del tr\u00e1fico que lo atraviesa.</li> <li>Permite utilizar directamente, sin modificaci\u00f3n alguna, las reglas de Snort.</li> </ul> <p>Como todo, siempre hay desventajas o inconvenientes, quiz\u00e1s incluso aplicable a cualquier IDS/IPS:</p> <ul> <li>La configuraci\u00f3n es ardua y dif\u00edcil. Tunearlo hasta que sea realmente \u00fatil puede llegar a ser un aut\u00e9ntico calvario que haga replantearse la utilidad vs esfuerzo.</li> <li>Una de las causas del punto anterior ser\u00eda la gran cantidad de falsos positivos debido a reglas, en ocasiones, demasiado gen\u00e9ricas. Las reglas de pago de Snort por ejemplo mejoran esto en gran medida.</li> <li>Las empresas que se lo pueden permitir econ\u00f3micamente suelen desestimar Suricata en favor de soluciones comerciales como los NGFW (Next Generation Firewalls) o plataformas como las de Fortinet o IBM.</li> <li>Hoy en d\u00eda gran cantidad del tr\u00e1fico va cifrado y el SSL Stripping puede convertirse en un gran problema, ya sea por condiciones de confidencialidad, como por la gran cantidad de recursos que supone de hardware, de adminstraci\u00f3n de endpoints o errores de certificados en los firewalls.</li> </ul>"},{"location":"idps/#demo-y-ejercicios","title":"Demo y ejercicios","text":"<p>Info</p> <p>Para este ejercicio he utilizado una m\u00e1quina virtual Debian 11 Bullseye con la interfaz en modo puente, instalando Suricata desde los repositorios. Si bien Suricata puede instalarse en cualquier distribuci\u00f3n, es posible que necesit\u00e9is algunos pasos adicionales o algo diferentes si utiliz\u00e1is otra.</p> <p>Atenci\u00f3n</p> <p>Todos los comandos de esta demo han sido ejecutados con el usuario root o, en su defecto, usando <code>sudo</code>.</p> <p>En este ejercicio deber\u00e9is llevar a cabo las siguientes acciones:</p> <ol> <li> <p>Instalar Suricata     Hay varias opciones para instalar:</p> <ul> <li>Desde el repositorio de paquetes de la distribuci\u00f3n Linux en concreto</li> <li>Desde un repositorio personal (PPA)</li> <li>Compilando el c\u00f3digo fuente</li> </ul> <p>Yo os recomiendo la primera opci\u00f3n, que siempre es la m\u00e1s sencilla.</p> </li> <li> <p>Configurarlo como IDS</p> <ul> <li>El archivo de configuraci\u00f3n a modificar est\u00e1 en <code>/etc/suricata/suricata.yaml</code></li> <li> <p>Comprobad el nombre de la interfaz de vuestra m\u00e1quina:</p> <p></p> </li> <li> <p>Tras ello, en el archivo de configuraci\u00f3n anterior, colocadlo donde corresponde en la secci\u00f3n <code>af.packet</code> del mismo:   </p> <p></p> </li> <li> <p>Para permitir que Suricata permita una recarga en vivo de las reglas, es decir, que se puedan a\u00f1adir, eliminar y editar las reglas sin la necesidad de reiniciar el proceso de Suricata:    </p> <p></p> <p>Y con este comando le diremos a Suricata que recargue todas las reglas sin reiniciar el proceso:</p> <pre><code>kill -usr2 $(pidof suricata)\n</code></pre> </li> <li> <p>Actualizamos las reglas de Suricata:</p> <pre><code>suricata-update -o /etc/suricata/rules\n</code></pre> </li> <li> <p>Y para validar la configuraci\u00f3n (tardar\u00e1 un poco):     </p> </li> <li> <p>Se inicia el servicio y se comprueba que est\u00e1 activo (tardar\u00e1 un par de minutos en cargar y parsear las reglas):     <pre><code>systemctl start suricata.service\nsystemctl start suricata.service\n</code></pre> </p> </li> </ul> </li> <li> <p>Comprobar que muestra las alertas que detecta de acuerdo a sus reglas</p> <ul> <li> <p>Probaremos la siguiente regla (explicaci\u00f3n del formato de las reglas/firmas):</p> <p></p> <p>Que generar\u00e1 una alarma cuando un posible intruso use el comando <code>id</code> y \u00e9ste responda con root. </p> <p>Para comprobarlo, accederemos a un site que simule este comportamiento ejecutando lo el siguiente comando:</p> <pre><code>curl http://testmynids.org/uid/index.html\n</code></pre> </li> <li> <p>Y examinamos los logs en busca de la alerta, utilizando su identificador:</p> <p></p> <p>Suricata tambi\u00e9n loguea eventos en <code>/var/log/suricata/eve.log</code> usando un formato JSON. La documentaci\u00f3n de Suricata recomienda usar la utilidad <code>jq</code> para leer y filtrar las entradas de este archivo. As\u00ed pues, lo instalamos:</p> <pre><code>apt install jq\n</code></pre> <p>Y buscamos la alerta correspondiente:</p> <pre><code>jq 'select(.alert .signature_id==2100498)' /var/log/suricata/eve.json\n</code></pre> </li> </ul> <p>Tarea</p> <p>Documenta adecuadamente todo este proceso con las capturas de pantalla y las explicaciones pertinentes que demuestren la realizaci\u00f3n y comprobaci\u00f3n del mismo.</p> </li> <li> <p>Configurar Suricata como IPS y comprobar su funcionamiento</p> <p>En este caso vamos a ver como trabajar en capa 3 con el modo inline de Suricata usando <code>iptables</code>. Para ello, necesitamos instalar una dependencia:</p> <pre><code>apt-get -y install libnetfilter-queue-dev\n</code></pre> <p>Ahora haremos que Suricata corra en modo NFQ, o lo que es lo mismo, le decimos que acepte los paquetes que le reenv\u00ede <code>iptables</code> sin que el firewall siga aplicando sus reglas al paquete (es posible que tarde varios minutos):</p> <p><pre><code>suricata -c /etc/suricata/suricata.yaml -q 0\n</code></pre> De la misma forma, debemos decirle al firewall que reenv\u00ede todos los paquete que entran y salen de nuestra m\u00e1quina a Suricata:</p> <pre><code>sudo iptables -I INPUT -j NFQUEUE\nsudo iptables -I OUTPUT -j NFQUEUE\n</code></pre> <p>Podemos ver las reglas activas del firewall con:</p> <pre><code>iptables -vnL\n</code></pre> <p>Por defecto Suricata corre en modo IDS as\u00ed que para activar el IPS haremos:</p> <p><pre><code>systemctl edit suricata.service\n</code></pre> Y a\u00f1adimos las l\u00edneas resaltadas:</p> <pre><code>### Editing /etc/systemd/system/suricata.service.d/override.conf\n### Anything between here and the comment below will become the new contents of the file\n[Service]\nExecStart= \nExecStart=/usr/bin/suricata -c /etc/suricata/suricata.yaml --pidfile /run/suricata.pid -q 0 -vvv\nType=simple\n### Lines below this comment will be discarded\n. . .\n</code></pre> <p>Donde <code>ExecStart=</code> borra el comando por defecto que systemd utiliza para iniciar un servicio. La siguiente l\u00ednea define el nuevo comando a utilizar y <code>Type=simple</code> se asegura de que systemd pueda manejar el proceso de Suricata como cualquier otro servicio cuando est\u00e1 corriendo en modo IPS.</p> <p>Guardamos y reiniciamos systemd para que detecte la nueva configuraci\u00f3n del servicio de Suricata:</p> <pre><code>systemctl daemon-reload\n</code></pre> <p>Reiniciamos Suricata y comprobamos su estado:</p> <pre><code>sudo systemctl restart suricata.service\nsudo systemctl status suricata.service\n</code></pre> <p>Tarea</p> <p>Modifica la regla que hemos comprobado anteriormente para que en lugar de generar una alerta (alert), descarte (drop) los paquetes que hagan match con esa regla.</p> </li> <li> <p>Escribir una regla para el IPS y comprobar que funciona</p> <p>Para este cometido vamos otra vez al archivo de configuraci\u00f3n <code>suricata.yaml</code> y le vamos a indicar que tenga en cuenta un nuevo fichero de reglas/firmas que crearemos m\u00e1s tarde con nuestra regla concreta:</p> <p></p> <p>Tarea</p> <p>A partir de la documentaci\u00f3n proporcionada o de otra que pod\u00e1is encontrar por Internet, escribid una regla de Suricata para que cuando se produzca una conexi\u00f3n desde cualquier IP origen a cualquier IP destino y puerto 8000, el tr\u00e1fico sea bloqueado por <code>iptables</code>.  Ponedle SID 9000001 por ejemplo, para que no haya conflicto con otra regla ya existente. Para comprobarla, en la m\u00e1quina donde est\u00e1 Suricata:</p> <pre><code>nc -nvlp 8000\n</code></pre> <p>Y en la m\u00e1quina anfitriona:</p> <p><pre><code>nc IP_Maq_Virtual 8000\n</code></pre> </p> <p>Nota</p> <p>Recordad el comando para recargar las reglas (puede tardar un rato): <pre><code>kill -USR2 $(pidof suricata)\n</code></pre> Si no os funciona, de acuerdo con la documentaci\u00f3n, probad:</p> <pre><code>suricatasc -c ruleset-reload-nonblocking\n</code></pre> </li> </ol>"},{"location":"idps/#per-a-rocky-linux","title":"Per a Rocky Linux","text":""},{"location":"idps/#ids_1","title":"IDS","text":"<p>Molts m'heu fet saber que no vos ha funcionat la pr\u00e0ctica amb Ubuntu tampoc. En aquest cas, aprofitarem la m\u00e0quina virtual de Rocky Linux, on jo mateix he comprovat que funciona correctament.</p> <p>En primer lloc, per a la instal\u00b7laci\u00f3 i posterior configuraci\u00f3 de Rocky Linux com a IDS, podem seguir el seg\u00fcent tutorial i no les instruccions anteriors, que eren nom\u00e9s per a Debian:</p> <p>How To Install Suricata on Rocky Linux 8</p> <p>On s'explica perfectament com instalar i configurar Suricata, aix\u00ed com la manera de fer la mateixa comprovaci\u00f3 de la regla de Suricata.</p> <p>Si teniu qualsevol problema, comproveu que:</p> <ul> <li>El firewall est\u00e0 desactivat, sin\u00f2 desactiveu-lo: <code>systemctl status firewalld</code></li> <li>Que a l'arxiu de configuraci\u00f3 <code>/etc/suricata/suricata.yml</code> heu canviat en tots els llocs on apareix el nom de la interfaz, per el nom de la vostra</li> <li>Que a l'arxiu <code>/etc/sysconfig/suricata</code> no apareix cap nom d'interfaz que no siga el vostre</li> </ul> <p>Una vegada feta esta part, pasarem a la seg\u00fcent, configurar Suricata com a IPS.</p>"},{"location":"idps/#ips_1","title":"IPS","text":"<p>En aquest cas, ja sabeu que a m\u00e9s d'inspeccionar el tr\u00e0fic, haurem de tallar-lo en cas de trobar activitat sospitosa. </p> <p>Question</p> <p>\u00bfQui pot tallar el tr\u00e0fic de la xarxa? </p> <p>Efectivament, el firewall. Suricata haur\u00e0 de treballar amb el firewall per a fer d'IPS.</p> <p>Podeu seguir qualsevol tutorial, sempre sent conscients de qu\u00e8 esteu fent per favor. Jo vos recomane este: How To Configure Suricata as an Intrusion Prevention System (IPS) on Rocky Linux 8</p> <p>Si llegiu amb atenci\u00f3 el tutorial, \u00e9s en el pas 3 concretament a \u00f3n comen\u00e7a a configurar-se Suricata per a intercontectar-se amb el firewall, aix\u00ed doncs, podeu obviar el passos anteriors.</p> <p>Despr\u00e9s, seguint amb el passos del tutorial, podeu comprobar amb la regla de l'apartat anterior, si canviant el <code>alert</code> per un <code>drop</code> es talla el tr\u00e0fic (haur\u00e0 de donar timeout i haura de vore-se en els logs).</p> <p>Una vegada comprovat que l'IPS funciona, haureu d'escriure ara s\u00ed, una regla pr\u00f2pia a l'arxiu <code>local.rules</code>, tal i com s'explicava en el punt 5 de la pr\u00e1ctica de Debian:</p> <p></p>"},{"location":"idps/#referencias","title":"Referencias","text":"<p>\u00bfQu\u00e9 son y para qu\u00e9 sirven los SIEM, IDS e IPS?</p> <p>Suricata vs snort </p> <p>How to install Suricata in Debian 11</p> <p>How To Install Suricata on Debian 11/Debian 10</p> <p>Suricta User Guide</p>"},{"location":"intconfdis/","title":"Integritat amb AIDE","text":""},{"location":"intconfdis/#tecniques-de-monitoritzacio-de-la-integritat-del-sistema-amb-aide","title":"T\u00e9cniques de monitoritzaci\u00f3 de la integritat del sistema amb AIDE","text":"<p><code>AIDE (Advanced Intrusion Detection Environment)</code> \u00e9s una eina de seguretat que s'utilitza per a detectar canvis en la integritat dels fitxers i directoris d'un sistema. </p> <p>Funciona creant una base de dades d'atributs de fitxers, com ara permisos de fitxers, propietat, mida i sumes de comprovaci\u00f3, i despr\u00e9s compara peri\u00f2dicament l'estat actual del sistema amb aquest baseline. Si es produeix algun canvi no autoritzat o inesperat, AIDE pot avisar l'administrador del sistema.</p> <p></p>"},{"location":"intconfdis/#caracteristiques-principals-daide","title":"Caracter\u00edstiques principals d'AIDE:","text":"<ul> <li> <p>Comprovaci\u00f3 d'integritat dels fitxers: supervisa els canvis als fitxers i directoris importants del sistema.</p> </li> <li> <p>Algoritmes hash: admet diverses funcions hash criptogr\u00e0fiques com MD5, SHA1 i altres per garantir la integritat del fitxer.</p> </li> <li> <p>Regles configurables: permet la configuraci\u00f3 detallada de quins fitxers o directoris s'han de supervisar i quins tipus de canvis cal detectar (p. ex., modificacions, supressi\u00f3 o canvis de permisos).</p> </li> <li> <p>Alertes: pot notificar a l'administrador quan es detecten canvis, ajudant a respondre r\u00e0pidament a possibles intrusions o alteracions del sistema.</p> </li> </ul>"},{"location":"intconfdis/#casos-dus-tipics","title":"Casos d'\u00fas t\u00edpics:","text":"<ul> <li> <p>Detecci\u00f3 d'intrusions: per detectar modificacions no autoritzades causades per activitat maliciosa, programari malici\u00f3s o bretxes de seguretat.</p> </li> <li> <p>Auditoria de compliment: garanteix que els fitxers sensibles no s'alterin, cosa que \u00e9s crucial per a les ind\u00fastries amb requisits de compliment estrictes (p. ex., HIPAA, PCI-DSS).</p> </li> <li> <p>Hardening del sistema: ajuda a mantenir la postura de seguretat alertant de qualsevol desviaci\u00f3 de la configuraci\u00f3 prevista.</p> </li> </ul>"},{"location":"intconfdis/#com-funciona-aide","title":"Com funciona AIDE","text":"<ul> <li>Inicialitza la base de dades: despr\u00e9s de la instal\u00b7laci\u00f3, AIDE crea una base de dades que registra l'estat inicial dels fitxers i directoris que voleu supervisar.</li> </ul> <p>Aix\u00f2 crea un fitxer de base de dades (normalment emmagatzemat a <code>/var/lib/aide/aide.db</code> o una ubicaci\u00f3 personalitzada).</p> <p>Compara l'estat actual: peri\u00f2dicament, executeu AIDE per comparar l'estat actual del sistema amb la l\u00ednia de base registrada.</p> <p>AIDE informar\u00e0 de qualsevol discrep\u00e0ncia.</p> <p>Actualitzar la base de dades: despr\u00e9s de validar els canvis (com ara despr\u00e9s de les actualitzacions del sistema), \u00e9s possible que vulgueu actualitzar la base de dades AIDE per reflectir la nova l\u00ednia de base.</p> <p>AIDE s'utilitza habitualment en entorns Linux i Unix com a part d'una estrat\u00e8gia de control i refor\u00e7 de la seguretat</p> <p>Atenci\u00f3</p> <p>Per tal de treballar amb m\u00e9s facilitat, vos recomane conectar-vos per SSH a la m\u00e0quina virtual de tal forma que, entre altres coses, podreu pegar text en el vostre terminal sense problema:</p> <pre><code>ssh vostre_usuari@ip_rocky\n</code></pre>"},{"location":"intconfdis/#utilitzant-aide-per-a-detectar-problemes-de-seguretat-mitjantcant-la-integritat-de-fitxers","title":"Utilitzant AIDE per a detectar problemes de seguretat mitjant\u00e7ant la integritat de fitxers","text":"<ol> <li> <p>Una vegada hem instal\u00b7lat correctament Rocky Linux i si no ho hem fet en la mateixa instal\u00b7laci\u00f3, crearem un usuari a m\u00e9s del de root. Si no te'n recordes, busca documentaci\u00f3 de com fer-lo.</p> </li> <li> <p>Aquest usuari ha d'estar ficat en el fitxer sudoers per tal de poder fer servir el comand sudo</p> </li> <li> <p>Si no ho vau fer tampoc en la instal\u00b7laci\u00f3, activeu el repositori epel per a Rocky Linux: <code>sudo dnf -y install epel-release</code></p> </li> <li> <p>Feu un <code>sudo yum update</code> i despr\u00e9s instal\u00b7leu aide</p> </li> <li> <p>Dins del vostre home, crear una carpeta amb el nom <code>scripts</code> i dins crear un arxiu buit amb el nomb <code>miscript.sh</code> </p> </li> <li> <p>Una vegada instal\u00b7lat, haureu de modificar l'arxiu de configuraci\u00f3 per a incluir un group amb el nom FIPSR a on es comproven els seg\u00fcents atributs per als arxius:</p> <ul> <li>Permisos dels arxius  </li> <li>N\u00famero inode (cada arxiu ha de tindre un n\u00famero d'inode que no ha de canviar)</li> <li>N\u00famero de links apuntant a l'arxiu</li> <li>Usuari propietari de l'arxiu</li> <li>Grup propietari de l'arxiu</li> <li>Tamany de l'arxiu</li> <li>Hora de modificaci\u00f3 de l'arxiu</li> <li>Comprovar integritat de l'arxiu amb hashes md5 i sha256</li> </ul> </li> <li> <p>Afegeix tamb\u00e9 a l'arxiu de configuraci\u00f3 les seg\u00fcents l\u00ednies: <pre><code>/etc/.*\\.conf$ FIPSR\n/var/log/.*\\.log$ FIPSR\n/home/.*\\.sh$ FIPSR\n</code></pre></p> </li> <li> <p>Inicialitzar la base de dades d'aide</p> </li> <li> <p>Substituir l'arxiu de base de dades antic per el nou</p> </li> <li> <p>Canviar els permisos de l'arxiu de logs del sistema <code>/var/log/messages</code> (perm\u00edsos del tipus 777)</p> </li> <li> <p>Incloure el text \"Entrada maliciosa\" al final de l'arxiu <code>/etc/ssh/sshd_config</code></p> </li> <li> <p>Elimina l'arxiu <code>miscript.sh</code></p> </li> <li> <p>Fer un check amb aide i en la exida, identificar les 3 modificacions que heu fet abans i que detecta aide (indiqueu en quina l\u00ednea vos informa de les modificacions i quin atribut dels configurats abans ha fet servir)</p> </li> <li> <p>Desf\u00e9s els 3 canvis que has fet i torna el sistema a la seua situaci\u00f3 inicial. Despr\u00e9s fes un check amb aide i explica que veus.</p> </li> <li> <p>Fes <code>sudo yum update &amp;&amp; sudo yum upgrade</code>i identifica els canvis detectats per\u00f2 que s\u00ed son leg\u00edtims</p> </li> <li> <p>Actualitza la base de dades i substitueix l'arxiu antic pel nou d'aide per tal de que accepte el nou estat del sistema i fes un nou check, \u00bfqu\u00e9 veus en la eixida?</p> </li> </ol>"},{"location":"intconfdis/#referencies","title":"Refer\u00e8ncies","text":"<p>https://jumpcloud.com/blog/how-to-create-sudo-users-on-rocky-linux</p> <p>https://documentation.suse.com/sles/15-SP5/html/SLES-all/cha-aide.html</p> <p>https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/security_guide/sec-using-aide</p>"},{"location":"intconfdis2/","title":"Confidencialitat amb Veracrypt","text":""},{"location":"intconfdis2/#confidencialitat-mitjantcant-xifrat-darxius-amb-veracrypt","title":"Confidencialitat mitjant\u00e7ant xifrat d'arxius amb Veracrypt","text":""},{"location":"intconfdis2/#que-es-veracrypt","title":"Qu\u00e8 \u00e9s Veracrypt?","text":"<p>VeraCrypt \u00e9s un software de xifratge de codi obert que s'utilitza per protegir dades sensibles mitjan\u00e7ant la creaci\u00f3 de volums xifrats (discs virtuals) o xifrant particions o unitats senceres. </p> <p>Proporciona una forta protecci\u00f3 per a les dades mitjan\u00e7ant algorismes de xifratge est\u00e0ndard del sector i es pot utilitzar en diversos sistemes operatius, inclosos Linux, Windows i macOS.</p> <p></p>"},{"location":"intconfdis2/#caracteristiques-clau-de-veracrypt","title":"Caracter\u00edstiques clau de VeraCrypt:","text":"<ol> <li> <p>Volums xifrats (discs virtuals): VeraCrypt permet crear un disc virtual xifrat dins d'un fitxer. Aleshores, aquest fitxer es pot muntar com si fos un disc real, la qual cosa permet emmagatzemar fitxers de manera segura. Quan el volum no est\u00e0 muntat, les dades s\u00f3n inaccessibles i apareixen com a dades aleat\u00f2ries.</p> </li> <li> <p>Partici\u00f3/xifratge de la unitat: Podeu xifrar una partici\u00f3 sencera o una unitat externa (com ara unitats USB) de manera que tot el que s'emmagatzema a la partici\u00f3 es xifra autom\u00e0ticament.</p> </li> <li> <p>Xifrat de la unitat del sistema: VeraCrypt ofereix la possibilitat de xifrar tota la unitat del sistema (incl\u00f2s el sistema operatiu), proporcionant un xifratge de disc complet (FDE). Aix\u00f2 garanteix que no es pugui accedir a cap informaci\u00f3 del disc sense la clau de desxifrat, fins i tot si alg\u00fa accedeix f\u00edsicament al disc.</p> </li> <li> <p>Volums ocults i sistemes operatius: VeraCrypt admet la creaci\u00f3 de volums ocults i sistemes operatius ocults. Aquesta caracter\u00edstica s'utilitza per a una negaci\u00f3 plausible, permetent als usuaris tenir un sistema operatiu o un volum \"se\u00f1\u00ed\" mentre mantenen amagat el real.</p> </li> <li> <p>Algorismes de xifratge forts: VeraCrypt utilitza diversos algorismes de xifratge potents com ara AES (Advanced Encryption Standard), Snake i Twofish, sols o combinats (en cascada).</p> </li> <li> <p>Multiplataforma: VeraCrypt est\u00e0 disponible per a Linux, Windows i macOS, el que significa que els contenidors xifrats creats en una plataforma es poden obrir en una altra sempre que s'instal\u00b7li el programari adequat.</p> </li> <li> <p>Protecci\u00f3 basada en contrasenyes i fitxers de claus: VeraCrypt admet tant el xifratge basat en contrasenyes com l'\u00fas de fitxers de claus per a m\u00e9s seguretat. Un fitxer de claus \u00e9s un fitxer (com una imatge o un document aleatori) que s'ha de presentar juntament amb la contrasenya per desbloquejar el volum xifrat.</p> </li> <li> <p>Autenticaci\u00f3 d'arrencada: Si tota la unitat del sistema est\u00e0 xifrada, VeraCrypt proporciona un mecanisme d'autenticaci\u00f3 pr\u00e8via a l'arrencada, que requereix que introdu\u00efu la contrasenya de desxifrat abans que el sistema operatiu es pugui carregar.</p> </li> </ol>"},{"location":"intconfdis2/#com-funciona-veracrypt","title":"Com funciona VeraCrypt:","text":"<ol> <li> <p>Proc\u00e9s de xifratge: quan creeu un volum xifrat, VeraCrypt utilitza l'algoritme de xifratge seleccionat per xifrar totes les dades que s'emmagatzemaran al volum. El proc\u00e9s es fa de manera transparent, el que significa que podeu interactuar amb els fitxers normalment un cop muntat el volum, per\u00f2 les dades del disc estan xifrades.</p> </li> <li> <p>Montatge/Desmuntatge:</p> </li> <li>Munteu un volum xifrat proporcionant la contrasenya i/o el fitxer de claus correctes, moment en qu\u00e8 actua com una unitat de disc normal on podeu copiar, moure i accedir a fitxers.</li> <li> <p>Quan h\u00e0giu acabat, podeu desmuntar el volum i les dades seran inaccessibles tret que es tornin a muntar amb les credencials correctes.</p> </li> <li> <p>Algoritmes de xifratge: VeraCrypt utilitza una combinaci\u00f3 dels algorismes de xifratge seg\u00fcents, amb l'opci\u00f3 de posar-los en cascada per a m\u00e9s seguretat:</p> <ul> <li>AES (est\u00e0ndard de xifratge avan\u00e7at)</li> <li>Serp</li> <li>Twofish</li> <li>Cam\u00e8lia (disponible en versions m\u00e9s noves)</li> </ul> </li> </ol>"},{"location":"intconfdis2/#casos-dus","title":"Casos d'\u00fas:","text":"<ul> <li> <p>Seguretat de dades: s'utilitza \u00e0mpliament per protegir dades sensibles, com ara documents personals, registres financers i altra informaci\u00f3 que ha de romandre privada.</p> </li> <li> <p>Encriptaci\u00f3 port\u00e0til: en xifrar unitats USB o emmagatzematge extern, els usuaris poden portar dades segures i port\u00e0tils.</p> </li> <li> <p>Encriptaci\u00f3 de disc per a la privadesa: xifrar el sistema o les unitats de dades garanteix que la informaci\u00f3 sensible romangui protegida en cas de robatori o acc\u00e9s no autoritzat.</p> </li> </ul>"},{"location":"intconfdis2/#veracrypt-contra-truecrypt","title":"VeraCrypt contra TrueCrypt:","text":"<p>VeraCrypt \u00e9s un successor de TrueCrypt, una eina de xifratge popular que es va suspendre el 2014. VeraCrypt aborda diverses vulnerabilitats de seguretat que hi havia a TrueCrypt i t\u00e9 funcions millorades per a un millor xifratge i rendiment.</p>"},{"location":"intconfdis2/#resum","title":"Resum:","text":"<p>VeraCrypt \u00e9s una potent eina per xifrar dades sensibles, que ofereix una varietat de m\u00e8todes de xifratge, des de volums simples basats en fitxers fins a xifratge complet del sistema, proporcionant un alt nivell de seguretat i privadesa per als usuaris en m\u00faltiples plataformes.</p> <p>Atenci\u00f3</p> <p>Per tal de treballar amb m\u00e9s facilitat, vos recomane conectar-vos per SSH a la m\u00e0quina virtual de tal forma que, entre altres coses, podreu pegar text en el vostre terminal sense problema:</p> <pre><code>ssh vostre_usuari@ip_rocky\n</code></pre>"},{"location":"intconfdis2/#utilitzant-veracrypt-per-a-la-privadesa-cross-platform-linux-windows","title":"Utilitzant Veracrypt per a la privadesa cross platform (Linux - Windows)","text":""},{"location":"intconfdis2/#pas-1-installacio-de-veracrypt","title":"Pas 1: Instal\u00b7laci\u00f3 de VeraCrypt","text":"<p>En primer lloc, haureu d'instalar Veracrypt per\u00f2 per a ser utilitzat en mode l\u00ednia de comandos, en lloc de amb interficie gr\u00e0fica (GUI):</p> <pre><code>$ sudo yum install fuse wget tar bzip2\n\n$ wget https://launchpad.net/veracrypt/trunk/1.26.14/+download/veracrypt-1.26.14-setup.tar.bz2\n\n$ sudo dnf install gcc make wxBase wxGTK3-devel fuse-devel\n\n$ tar -xvjf veracrypt-1.26.14-setup.tar.bz2\n\n$ sudo ./veracrypt-1.26.14-setup-console-x64 (opci\u00f3 1)\n$ veracrypt --version\n</code></pre>"},{"location":"intconfdis2/#pas-2-crear-volum-de-veracrypt-contenidor-xifrat","title":"Pas 2: Crear volum de VeraCrypt (contenidor xifrat)","text":"<ol> <li> <p>Crear un contenidor buit de Veracrypt:</p> <p><code>$ veracrypt --text --create /ruta/carpeta/arxiu_xifrat</code></p> </li> <li> <p>A les opcions interactives que vos anir\u00e0 demanant heu d'utilitzar les seg\u00fcents dades:</p> <ul> <li>Volume type: normal</li> <li>Tamany: 100M</li> <li>Xifrat: AES</li> <li>Hash: SHA-512</li> <li>Filesystem: FAT</li> <li>Password</li> <li>PIM (2n factor autenticaci\u00f3)</li> <li>Keyfile path: buit</li> </ul> </li> </ol>"},{"location":"intconfdis2/#pas-3-muntar-el-volum-de-veracrypt","title":"Pas 3: Muntar el volum de VeraCrypt","text":"<ol> <li> <p>Heu de crear la carpeta: <code>/mnt/veracrypt1</code></p> </li> <li> <p>Despr\u00e9s es necessari muntar el arxiu xifrat que heu creat previament  com a una unitat del sistema <pre><code>$ sudo mkdir /mnt/veracrypt1 $ sudo veracrypt --text /ruta/al/arxiu /mnt/veracrypt1 </code></pre></p> </li> <li> <p>Creeu 3 fitxers de text amb qualsevol contingut de text i despr\u00e9s copieu-los a la unitat que heu muntat en el pas anterior.</p> </li> <li> <p>Desmunteu la unitat <pre><code>$ sudo veracrypt --dismount /mnt/veracrypt1 </code></pre></p> </li> <li>Ara els continguts de la carpeta estan xifrats i emmagatzemast dins en l'arxiu <code>arxiu_xifrat</code></li> </ol>"},{"location":"intconfdis2/#pas-4-transferir-el-arxiu-xifrat-a-windows","title":"Pas 4: Transferir el arxiu xifrat a Windows","text":"<p>Aquest pas ho podeu realitzar mitjan\u00e7ant una unitat usb (pendrive), utilitzant el comand <code>scp</code>, muntant un server web amb python3 en Rocky Linux i accedint des del navegador web de Windows...</p> <p>Per exemple,</p> <p>En Rocky Linux, en el directory a on tenim el contenidor buit creat abans:</p> <p><pre><code>$ python3 -m http.server\n</code></pre> I des de Windows, amb el navegador web haureu d'accedir a <code>http://IP_Rocky:8000</code> i descarregar l'arxiu.</p> <p>Comprovar que l'arxiu est\u00e0 xifrat al s\u00edmbol del sistema de Windows:</p> <pre><code>&gt; type arxiu\n</code></pre> <p>Atenci\u00f3!</p> <p>\u00c9s possible que no pugau accedir des del navegador web a Rocky i aix\u00f2 es degut al firewall que bloqueja les connexions. La soluci\u00f3 passa per dir-li al firewall del nostre Linux que permeta la connexi\u00f3 al port 8000.</p> <p>Obrim el port:</p> <pre><code>sudo firewall-cmd --zone=public --add-port=8000/tcp --permanent\n</code></pre> <p>Reiniciar el firewall per a aplicar els canvis:</p> <pre><code>sudo firewall-cmd --reload\n</code></pre>"},{"location":"intconfdis2/#pas-5-installar-veracrypt-en-windows","title":"Pas 5: Instal\u00b7lar VeraCrypt en Windows","text":"<p>Podeu obtenir-lo ac\u00ed.</p>"},{"location":"intconfdis2/#pas-6-muntar-el-volum-xifrat-en-windows","title":"Pas 6: Muntar el volum xifrat en Windows","text":"<p>Munteu el volum que heu xifrat  previament en Linux i comproveu que, efectivament, podeu accedir als arxius xifrats previament:</p> <ul> <li>Seleccioneu una unitat lliure</li> <li>Seleccioneu l'arxiu a muntar (el contenidor buit d'abans)</li> <li>Doneu-li a muntar (no oblideu marcar que fa falta PIM)</li> <li>Espereu una estona i haur\u00eda d'apareixer-vos com a una nova unitat del sistema</li> <li>Comproveu que podeu accedir a la informaci\u00f3 dins dels 3 arxius de text</li> </ul>"},{"location":"intconfdis2/#referencies","title":"Refer\u00e8ncies","text":""},{"location":"intconfdis3/","title":"Disponibilitat de serveis amb Nmap","text":""},{"location":"intconfdis3/#disponibilitat-de-serveis-amb-nmap","title":"Disponibilitat de serveis amb Nmap","text":"<p>Identificar i analitzar la disponibilitat de serveis o servidors, ports oberts i versions de sistemes operatius que els suporten, suposa la informaci\u00f3 base per a l\u2019estudi de les innumerables vulnerabilitats dels sistemes en xarxa. D\u2019aquest mode es podran prendre mesures front a aquests punts febles dels nostres sistemes.</p> <p>Nmap \u00e9s una ferramenta de codi obert per a l\u2019exploraci\u00f3 de xarxa i auditoria de seguretat. Utilitza paquets IP per a determinar quins equips es troben disponibles a la xarxa, quins serveis ofereixen i mitjan\u00e7ant quines aplicacions (nom i versi\u00f3 de l\u2019aplicaci\u00f3), quins sistemes operatius (i les seues versions) executen, quins tipus filtrat de paquets i tallafocs estan utilitzant, aix\u00ed com altres caracter\u00edstiques.</p> <p></p>"},{"location":"intconfdis3/#escaneig-de-ports-amb-nmap","title":"Escaneig de ports amb Nmap","text":"<ol> <li>Instal\u00b7la Nmap a Rocky Linux des dels repositoris</li> <li>Una vegada fet lo anterior, realitza un escaneig r\u00e0pid i sense opcions a <code>http://scanme.nmap.org</code></li> <li>Mostra els resultats i identifica a quin servei pertany cada port</li> <li>Fes un nou escaneig i utilitza les opcions necess\u00e0ries per tal d'identificar quin software es fa servir per al DNS i quin per al servidor Web. A m\u00e9s, identifica quina versi\u00f3 de eixe servidor web s'est\u00e0 utilitzant i sobre quin sistema operatiu. Adjunta una captura de pantalla a on senyales estos par\u00e0metres.</li> </ol>"},{"location":"iptables/","title":"Administraci\u00f3 senzilla de regles d'iptables fent servir Docker","text":""},{"location":"iptables/#introduccio","title":"Introducci\u00f3","text":"<p>Per a simplificar la infraestructra necess\u00e0ria per a esta pr\u00e0ctica, farem servir un framework anomenat Labtainer. Este framework es capa\u00e7 de crear diferents laboratoris o escenaris basats en contenidors de Docker. </p> <p>En concret, el nostre escenari ser\u00e0 tal que aix\u00ed:</p> <p></p>"},{"location":"iptables/#labtainer","title":"Labtainer","text":"<p>Descarregueu la imatge <code>.ova</code> del link que teniu a Aules i importeu-la en Virtualbox.</p> <p>Per tal d'iniciar el laboratori, no tanqueu el terminal s'obrir\u00e0 autom\u00e0ticament i introudiu:</p> <pre><code>labtainer iptables2\n</code></pre> <p>I comen\u00e7aran a desplegar-se els contenidors i se vos obrir\u00e0n dues pestanyes en el terminal del firewall. </p> <p>Nota</p> <p>Quan vos pregunte per l'email, deixeu-lo en blanc i dieu-li que esteu segurs de deixar-lo en blanc <code>(y)</code></p> <p>Per a accedir al terminal de qualsevol contenidor podeu fer servir:</p> <pre><code>docker exec -it &lt;nom_del_contenidor&gt; /bin/bash\n</code></pre>"},{"location":"iptables/#tasques","title":"Tasques","text":"<p>Des del client prova a fer un escaneig de ports al server i comenta el resultats:</p> <pre><code>nmap server\n</code></pre> <p>Prova a accedir per SSH:</p> <pre><code>ssh server\n</code></pre> <p>I confirma que s'oferix el servici de Telnet:</p> <pre><code>telnet server\n</code></pre> <p>Al contenidor firewall est\u00e0 instal\u00b7lat Iptables. Fes-lo servir per a permetre \u00fanicament la redirecci\u00f3 (forwarding) de tr\u00e0fic SSH i HTTP. Per tal d'ajudar-te, pots experimentar amb el script <code>example fw.sh</code>.</p> <p>Atenci\u00f3</p> <p>Considera posar les teues regles d'iptables en un script per tal de poder aplicar-les r\u00e0pidament sempre que ho necessites. </p> <p>Comprova els packets descartats (drop) mirant el logs i assenyalant clarament dins del log on es produeix el drop:</p> <pre><code>tail -f /var/log/iptables.log\n</code></pre> <p>El contenidor firewall tamb\u00e9 t\u00e9 instal\u00b7lada l'aplicaci\u00f3 wireshark, fes-la servir per a vore els drops tamb\u00e9:</p> <pre><code>wireshark &amp;\n</code></pre> <p>Una vegada has limitat el tr\u00e0fic amb iptables, torna a fer el escaneig de ports per a comprovar que la nova situaci\u00f3 \u00e9s correcta.</p>"},{"location":"iptables/#obrir-un-port-per-a-un-nou-servici","title":"Obrir un port per a un nou servici","text":"<p>El contenidor del client inclou un programa anomenat wizbang. Executa este script i comprova quin \u00e9s el port que est\u00e0 intentant utilitzar per a enviar el tr\u00e0fic. </p> <p>Una vegada comprovat, introdueix una regla que permeta este tr\u00e0fic i comprova que funciona correctament (de les dues formes comentades a clase). </p> <p>Fes tamb\u00e9 la comprovaci\u00f3 amb un nou escaneig de ports.</p> <p>Una vegada heu acabat, pareu el laboratori al terminal original amb:</p> <pre><code>stoplab\n</code></pre>"},{"location":"malware/","title":"Estudi del funcionament d'un ransomware en Linux i Windows amb comunicacions C2","text":""},{"location":"malware/#ransomware","title":"Ransomware","text":""},{"location":"malware/#una-visio-general","title":"Una Visi\u00f3 General","text":"<p>Ransomware \u00e9s un tipus de malware (software malici\u00f3s) dissenyat per bloquejar o restringir l'acc\u00e9s als arxius o sistemes d'un usuari, generalment mitjan\u00e7ant la xifrat de les dades, per despr\u00e9s exigir un pagament o rescat (ransom) a canvi de restaurar-ne l'acc\u00e9s. Aquest pagament sol sol\u00b7licitar-se en criptomonedes, com Bitcoin, per dificultar el rastreig.</p>"},{"location":"malware/#funcionament-del-ransomware","title":"Funcionament del Ransomware","text":"<p>El ransomware t\u00edpicament segueix un cicle d'atac que involucra diverses fases:</p> <ol> <li> <p>Infecci\u00f3 inicial: El ransomware ingressa al sistema, generalment a trav\u00e9s de vectors com phishing (correus electr\u00f2nics maliciosos amb enlla\u00e7os o arxius adjunts), desc\u00e0rregues no segures, vulnerabilitats en sistemes o xarxes, o mitjan\u00e7ant atacs enginyeria social.</p> </li> <li> <p>Xifratge de dades: Un cop dins del sistema, el ransomware xifra arxius importants al disc de l'usuari usant algoritmes de xifrat forts com AES o RSA. Aix\u00f2 impedeix que l'usuari accedeixi a les vostres dades, ja que nom\u00e9s l'atacant t\u00e9 la clau per desxifrar la informaci\u00f3.</p> </li> <li> <p>Missatge de rescat: Apareix una notificaci\u00f3 exigint un pagament a canvi de la clau de desxifrat. L'atacant sovint imposa un l\u00edmit de temps per generar una sensaci\u00f3 d'urg\u00e8ncia, amena\u00e7ant de destruir les dades si el pagament no es fa.</p> </li> <li> <p>Possible doble extorsi\u00f3: En atacs m\u00e9s recents, a m\u00e9s de xifrar les dades, els atacants tamb\u00e9 amenacen de publicar la informaci\u00f3 robada si no es paga el rescat, afegint-hi una segona capa d'extorsi\u00f3.</p> </li> </ol>"},{"location":"malware/#ransomware-i-c2-command-and-control","title":"Ransomware i C2 (Command and Control)","text":"<p>Els atacs de ransomware sovint depenen de servidors C2 (Command and Control), que s\u00f3n utilitzats pels atacants per controlar el malware remotament i rebre instruccions.</p>"},{"location":"malware/#c2-al-context-del-ransomware","title":"C2 al Context del Ransomware","text":"<ol> <li> <p>Comunicacions: El ransomware es pot connectar a un servidor C2 per rebre instruccions espec\u00edfiques, com ara el moment en qu\u00e8 s'ha d'activar, quins fitxers ha de xifrar, o quines criptomonedes enviar els pagaments.</p> </li> <li> <p>Distribuci\u00f3 de claus: En alguns casos, les claus de xifratge s\u00f3n generades al servidor C2, i el ransomware les sol\u00b7licita quan infecta un sistema. Aix\u00f2 assegura que nom\u00e9s el servidor C2 i els atacants tinguin la clau de desxifrat, fent impossible que la v\u00edctima desxifre els fitxers sense pagar.</p> </li> <li> <p>Exfiltraci\u00f3 de dades: Si el ransomware inclou la doble extorsi\u00f3 (robatori de dades a m\u00e9s de xifratge), el C2 tamb\u00e9 \u00e9s responsable de rebre les dades exfiltrades abans que el ransomware les xifre localment.</p> </li> <li> <p>Actualitzaci\u00f3 o control din\u00e0mic: Alguns ransomware poden estar programats per rebre actualitzacions des del servidor C2, cosa que permet als atacants modificar el comportament del malware segons sigui necessari (per exemple, per evitar detecci\u00f3).</p> </li> </ol>"},{"location":"malware/#corolari","title":"Corolari","text":"<p>El ransomware \u00e9s una de les amenaces m\u00e9s destructives dins de l'ecosistema del malware. La seva capacitat per inutilitzar dades cr\u00edtiques, combinada amb l'\u00fas de sistemes de C2** per al control remot, el fa molt efectiu i dif\u00edcil de combatre. Els atacants utilitzen t\u00e8cniques avan\u00e7ades de xifratge per segrestar informaci\u00f3 i utilitzen m\u00e8todes sofisticats de distribuci\u00f3 a trav\u00e9s de servidors C2, cosa que els permet mantenir el control i maximitzar l'impacte dels seus atacs.</p>"},{"location":"malware/#simulacio-dun-escenari-real-dun-atac-de-ransomware","title":"Simulaci\u00f3 d'un escenari real d'un atac de Ransomware","text":""},{"location":"malware/#objectiu","title":"Objectiu","text":"<p>Volem simular en primera persona un atac de ransomware a una empresa i observar el proc\u00e9s. Per a aquest com\u00e8s utilitzarem com a m\u00e0quina atacant Kali, que tamb\u00e9 far\u00e0 de servidor C2. </p> <p>Simularem un escenari amb una v\u00edctima Windows 10 i un altre amb una v\u00edctima Linux (Rocky). Utilitzarem un senzill software que xifrar\u00e0 tot el contingut d'un directori, deixant-lo il\u00b7legible. De la mateixa forma, enviar\u00e0 la clau per a desxifrar i els arxius sense xifrar al nostre server C2. </p> <p>Per a prevenir execucions d'aquesta eina per error, tamb\u00e9 es genera en la v\u00edctima un <code>readme.txt</code> que cont\u00e9 els logs de la execuci\u00f3 i la clau de desxiframent. Est\u00e0 clar que en un escenari real aix\u00f2 no pasar\u00eda mai sin\u00f2 que es demanar\u00eda un rescat.</p>"},{"location":"malware/#1-primer-escenari-atacant-kali-victima-windows-10","title":"1. Primer escenari: Atacant (Kali) + V\u00edctima (Windows 10)","text":"<p>La eina que utilitzarem est\u00e0 escrita en Powershell que, encara que \u00e9s multiplataforma, haurem d'instalar-lo en Kali:</p> <p><pre><code>sudo apt update &amp;&amp; sudo apt upgrade\n\n# Instal\u00b7lem depend\u00e8ncies\nsudo apt install -y wget apt-transport-https software-properties-common\n\n# Importem les claus de Microsoft\nwget -q \"https://packages.microsoft.com/keys/microsoft.asc\" -O- | sudo tee /etc/apt/trusted.gpg.d/microsoft.asc\n\n# Afegim el repository de powershell a Kali\nsudo sh -c 'echo \"deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-debian-buster-prod buster main\" &gt; /etc/apt/sources.list.d/microsoft.list'\n#Actualitzem i instal\u00b7lem powershell\nsudo apt update\n\nsudo apt install -y powershell\n</code></pre> Per a iniciar un terminal de Powershell no cal m\u00e9s que: <code>pwsh</code></p> <p>En la m\u00e0quina atacant clonem el repositori de l'eina que farem servir</p> <p><pre><code>git clone https://github.com/JoelGMSec/PSRansom\n</code></pre> El mateix repositori ho clonarem en la v\u00edctima Windows. Podeu fer-lo instal\u00b7lat Git en Windows o simplement descarregant un zip amb el contigut del repositori i descomprimint-lo en la m\u00e0quina.</p> <p>Atenci\u00f3</p> <p>\u00c9s m\u00e9s que probable que h\u00e0giu de desactivar la protecci\u00f3 antimalware de Windows per a fer servir els scripts de Powershell d'aquesta eina.</p> <p>Ara que ja teniu el setup comencem amb l'acci\u00f3:</p> <ul> <li> <p>En un terminal de Powershell en l'atacant, posa a l'escolta en el port 80 el servidor C2. Per a saber com fer-lo, utilitza l'ajuda de la eina: <code>./C2Server.ps1 -h</code></p> <p>Tip</p> <p>Utilitza permisos de <code>sudo</code>o no et deixar\u00e0</p> </li> <li> <p>En la m\u00e0quina v\u00edctima crea un directori que es cride SAD i fica una imatge, un arxiu de text amb contingut i qualsevol altre arxiu.</p> </li> <li> <p>En un terminal de Powershell (executant-se com Administrador), inicia el Ransomware. </p> <p>Haur\u00e0s d'indicar-li el directori, l'adre\u00e7a del servidor C2 i el port en el que est\u00e0 escoltant. A m\u00e9s, haur\u00e0s d'utilitzar la opci\u00f3 per a exfiltrar arxius, de tal forma que se transmetin a l'atacant i es guarden sense xifrar all\u00e0.</p> <p>Per a saber com fer-lo, utilitza l'ajuda de la eina: <code>./PSRansom.ps1 -h</code></p> <p>Failure</p> <p>Aquest pas et donar\u00e0 un error que t'informar\u00e0 de l'execuci\u00f3 de scripts est\u00e0 deshabilitada en el sistema.  PowerShell t\u00e9 diverses pol\u00edtiques d'execuci\u00f3, quatre de les m\u00e9s utilitzades s\u00f3n:</p> <ul> <li> <p>Restricted: cap script no ser\u00e0 executat. Com es comentava anteriorment, aquesta \u00e9s la configuraci\u00f3 predeterminada.</p> </li> <li> <p>RemoteSigned: permeten executar els scripts creats localment amb signatura remota. Els scripts que es van crear en una altra m\u00e0quina no s'executaran a no ser que estiguin signats per un editor de confian\u00e7a.</p> </li> <li> <p>AllSigned: els scripts nom\u00e9s s'executaran si est\u00e0 signat per un editor de confian\u00e7a. Aqu\u00ed tamb\u00e9 s'hi inclouen els scripts creats localment.</p> </li> <li> <p>Unrestricted: tots els scripts s'executaran, tant se val qui els hagi creat i si estan signats o no.</p> </li> </ul> <p>Decideix quina \u00e9s la pol\u00edtica adequada per al nostre cas i busca en Internet el comandament adequat de Powershell per a establir-la.</p> </li> <li> <p>Una vegada executat exitosament <code>PSRansom.ps1</code>, comen\u00e7ar\u00e0 la simulaci\u00f3 de la infecci\u00f3 i es conectar\u00e0 amb el C2, xifrar\u00e0 els arxius del directori i exfiltrar\u00e0 la informaci\u00f3.</p> </li> <li> <p>En la v\u00edctima s'informar\u00e0 de la conexi\u00f3, es rebr\u00e0 la clau de desxifrat i es rebran els arxius desxifrats per, a continuaci\u00f3, desxifrar-los i guardarlos. </p> </li> </ul> <p>Task</p> <ul> <li>Comprova que tots els arxius del directori han sigut xifrats. Tots tenen extensi\u00f3 <code>.psr</code> i no es poden obrir. </li> <li>Trobar\u00e0s un arxiu <code>readme.txt</code>informant-te de l'atac, amb els logs de qu\u00e8 ha sigut xifrat i amb la clau de desxifrat (per si ha sigut una simulaci\u00f3 accidental)</li> <li>Comprova quen el servidor C2 s'ha rebut la clau i els arxius.</li> <li>Utilitzant una altra vegada l'ajuda de la eina, desxifra els arxius xifrats en la m\u00e0quina v\u00edctima.</li> </ul>"},{"location":"malware/#2-segon-escenari-atacant-kali-victima-rocky","title":"2. Segon escenari: Atacant (Kali) + V\u00edctima (Rocky)","text":"<p>En aquest cas, haurem d'instal\u00b7lar Powershell en Rocky tamb\u00e9:</p> <pre><code>sudo dnf update\n\nsudo dnf install -y https://packages.microsoft.com/config/rhel/8/packages-microsoft-prod.rpm\n\nsudo dnf install -y powershell\n\npwsh\n</code></pre> <p>Y despr\u00e9s repeteix exactament el mateix proc\u00e9s que en el cas anterior.</p>"},{"location":"malware/#per-a-treure-nota","title":"Per a treure nota","text":"<p>Imagina en aquest \u00faltim cas que no contem amb la clau de desxifrat, lo qual s'apropa bastant a la realitat. En aquestos casos \u00e9s esencial una cosa que ja vam vore amb anterioritat; una bona pol\u00edtica de backups.</p> <p>Tasca</p> <p>Repeteix el segon escenari pero abans fes un backup del contingut del directori amb rsync a una altra m\u00e0quina qualsevol. Simula l'atac y restaura aquesta c\u00f2pia. D'aquesta forma simulem tant l'atac com la resposta mateixa.</p>"},{"location":"malware/#forma-de-lliurament","title":"Forma de lliurament","text":"<p>Haureu de lliurar els seg\u00fcents v\u00eddeos, un per a cada escenari:</p> <ul> <li> <p>Un v\u00eddeo a on s'observe tot el procediment del primer escenari </p> </li> <li> <p>Un v\u00eddeo a on s'observe tot el procediment del segon escenari</p> </li> <li> <p>Si feu la part Per a treure nota podeu incloure-la directament en el primer v\u00eddeo. Es a dir, en el primer v\u00eddeo haureu de restaurar el backup per\u00f2 tamb\u00e9 desxifrar els arxius xifrats.</p> </li> </ul>"},{"location":"nftables/","title":"Configuraci\u00f3n de nftables en un entorno de red en Docker","text":""},{"location":"nftables/#descripcion-del-escenario","title":"Descripci\u00f3n del escenario","text":"<p>Para esta pr\u00e1ctica vamos a suponer un escenario que bien podr\u00eda tratarse de un escenario real. La infraestructura de red que nos encontraremos es la siguiente:</p> <p></p> <ol> <li> <p>En la DMZ encontramos un servidor web y otro servidor DNS.</p> <ul> <li>El servidor web es para uso externo e interno, es decir, debe ser accesible tanto desde internet (WAN) como desde los usuarios internos de nuestra empresa. Se trata de un e-comerce en php que hace uso de una base de datos MYSQL, a partir de la cual muestra los productos en el portal. </li> <li>El servidor DNS es para uso exclusivamente interno, esto es, por parte de nuestros empleados. Se trata de un forwarder, esto quiere decir que su funci\u00f3n ser\u00e1 recibir las peticiones DNS y redirigirlas a otro servidor, por lo que debe tener salida al exterior.</li> </ul> </li> <li> <p>En la VLAN1 encontramos la base de datos MySQL de la que hace uso el servidor web. Est\u00e1 en otra subred por temas de seguridad.</p> </li> <li>La VLAN2 es la subred donde se hallan nuestros empleados de la empresa. Entre ellos tambi\u00e9n se sencuentra el administrador de sistemas.</li> <li>La WAN es la interfaz externa de nuestra empresa, o lo que es lo mismo, Internet. Hay ubicado un usuario client para realizar nuestras pruebas. Este usuario \u00fanicamente debe poder consultar el servidor web.</li> </ol>"},{"location":"nftables/#como-levantar-el-escenario","title":"C\u00f3mo levantar el escenario","text":"<p>Deb\u00e9is tener instaladas las \u00faltimas versiones tanto de Docker como de Docker Compose.</p> <p>Los pasos para ejecutar el escenario y comenzar a trabajar son:</p> <ol> <li>Clonar este repositorio.</li> <li> <p>Tenemos dos archivos docker-compose, uno se encarga de crear las redes necesarias y otro para crear los contenedores mismos. Tenemos dos opciones para ejecutar:</p> <ol> <li>Este comando:         <pre><code>docker-compose up -f docker-compose-networks.yml -f docker-compose.yml up -d\n</code></pre></li> <li>Para no tener que especificar los dos archivos siempre que queremos levantar el escenario, podemos utilizar una variable de entorno:         <pre><code>export COMPOSE_FILE=docker-compose-networks.yml:docker-compose.yml\n</code></pre>         Y despu\u00e9s ya ejecutar el comando de siempre:         <pre><code>docker-compose up -d\n</code></pre>         Y en breves instantes tendremos nuestros 7 contenedores y todas las redes creadas y a punto para empezar a trabajar. Pod\u00e9is comprobarlo con <code>docker ps</code>.</li> </ol> </li> <li> <p>Los contenedores contienen todas las herramientas necesarias para la pr\u00e1ctica.</p> </li> </ol>"},{"location":"nftables/#condiciones-que-se-deben-cumplir-en-el-escenario","title":"Condiciones que se deben cumplir en el escenario","text":"<ol> <li>S\u00f3lo el admin debe tener acceso por SSH al firewall</li> <li>Todos los usuarios de VLAN2 deben tener acceso al servidor web y al dns.</li> <li>S\u00f3lo el admin y el servidor web deben tener acceso a la base de datos por el puerto por defecto de MySQL.</li> <li>Los usuarios que entren por la interfaz WAN s\u00f3lo deben tener acceso al servidor web</li> <li>El servidor debe tener acceso al exterior para hacer forwarding de las peticiones</li> <li>Todos los usuarios de la VLAN2 deben poder hacer ping los servidores de la DMZ</li> <li>S\u00f3lo el admin debe poder hacer ping al servidor de base de datos</li> </ol>"},{"location":"nftables/#configuracion-de-nftables","title":"Configuraci\u00f3n de nftables","text":"<p>Para realizar la configuraci\u00f3n, nos crearemos un script en bash para ejecutarlo y que se cargue nuestra configuraci\u00f3n. Este script comenzar\u00e1 as\u00ed:</p> <p><pre><code>#!/usr/sbin/nft -f\nflush ruleset\n</code></pre> El shebang de la primera l\u00ednea indica que ser\u00e1 ejecutado por nftables y de esta forma cada l\u00ednea del script puede omitir el comienzo de la orden (nft). </p> <p>La segunda l\u00ednea borrar\u00e1 la configuraci\u00f3n actual de nftables antes de seguir ejecutando las \u00f3rdenes que hayamos configurado en el mismo.</p> <p>Despu\u00e9s continuaremos elaborando nuestro script por pasos:</p> <ol> <li>Crearemos dos tablas, una llamada filtrat y otra nat. Como es obvio, la primera se encargar\u00e1 del filtrado de paquetes y la segunda de realizar las traducciones nat.      Para esto os pod\u00e9is ayudar de los apuntes</li> <li>Crearemos tres cadenas para la tabla filtrat (input, output y forward) con pol\u00edtica por defecto drop y una cadena para la tabla nat (prerouting) sin indicarle pol\u00edtica por deffecto.     Para esto tambi\u00e9n os pod\u00e9is ayudar de los apuntes del punto anterior.</li> <li> <p>Debemos crear una regla que vigile el estado de las conexiones para permitir los paquetes que pasen a trav\u00e9s del firewall y que pertenezcan a una conexi\u00f3n previamente establecida o est\u00e9n relacionados con ella.     Consultad informaci\u00f3n sobre el seguimiento del estado de la conexi\u00f3n o connection tracking state en nftables.</p> <p>Pista</p> <p>Para las siguientes reglas, pod\u00e9is consultar su sintaxis en la wiki de nftables</p> </li> <li> <p>Crear una regla que permita los paquetes que pasen a trav\u00e9s del firewall, que entren desde la interfaz de la VLAN2, con direcci\u00f3n origen la de red de VLAN2, direcci\u00f3n destino la direcci\u00f3n de red de la DMZ, protocolo icmp (para el ping) y tipo de mensaje icmp <code>echo-request</code>y <code>echo-reply</code>.</p> </li> <li>Crear una regla que permita los paquetes que pasen a trav\u00e9s del firewall, que entren por la interfaz VLAN1, con ip destino la del servidor web, puerto destino el 80 TCP.</li> <li>Crear una regla que permita los paquetes que pasen a trav\u00e9s del firewall, que entren por la interfaz de la VLAN2, ip destino la del servidor DNS, puerto destino el 53 UDP.</li> <li>Crear una regla que permita los paquetes que pasen a trav\u00e9s del firewall, que entren por la interfaz de la DMZ, interfaz de salida la de la DMZ, ip origen la del servidor DNS, puerto destino el 53 UDP.</li> <li>Crear una regla que permita los paquetes que pasen a trav\u00e9s del firewall, con interfaz de entrada la DMZ, interfaz de salida la de VLAN1, ip origen del servidor web, ip destino la de la base de datos y puerto destino el 3306 TCP.</li> <li>Crear una regla que permita los paquetes que pasen a trav\u00e9s del firewall, con interfaz de entrada la VLAN2, interfaz de salida la de VLAN1, ip origen la del admin, ip destino la de la base de datos y puerto destino el 3306 TCP.</li> <li>Crear una regla que permita las conexiones de entrada al firewall en la interfaz de entrada de la VLAN2, con ip origen la del admin e ip destino la del firewall en esa interfaz, puerto destino el correspodiente a SSH y TCP.</li> <li>Crear una regla de salida del tipo connection tracking state para permitir la salida de paquetes de conexiones previamente establecidas o relacionadas.</li> <li>Por \u00faltimo, crear una regla de NAT, de tipo prerouting cuyo cometido ser\u00e1 realizar una traducci\u00f3n NAT de todo lo que entre por la interfaz WAN a la ip destino la del firewall, con puerto destino 8080, hacia la direcci\u00f3n del servidor web y puerto 80.</li> </ol> <p>Nota</p> <p>Todas las reglas deben configurarse con contadores.</p> <p>Estos contadores mostrar\u00e1n la cantidad de paquetes que han hecho match de cada regla cuando listemos la configuraci\u00f3n.</p> <p>Consejos</p> <ul> <li>Todas las IPs las ten\u00e9is en el archivo de variables de entorno para docker-compose.</li> <li>Para un mayor orden y facilidad a la hora de crear las reglas en el script os recomiendo despu\u00e9s del flush inicial definir variables para cada IP y nombre de interfaz que vay\u00e1is a utilizar.</li> <li>Para saber el nombre de qu\u00e9 interfaz del firewall est\u00e1 conectada a qu\u00e9 red, haced uso del comando <code>ip a</code>. Las interfaces tienen este formato <code>ethx@ifxx</code>. Para cualquer cosa para la que necesit\u00e9is el nombre de la interfaz, deb\u00e9is utilizar \u00fanicamente el <code>ethx</code>.</li> <li> <p>Puesto que configurar\u00e9is reglas que considerar\u00e9is infalibles y fallar\u00e1n, para saber exactamente que est\u00e1 pasando ser recomienda encarecidamente el uso de tcpdump:</p> <p><code>tcpdump -nvi &lt;nombre interfaz&gt;</code></p> </li> </ul> <p>Tarea</p> <p>Realiza las comprobaciones para comprobar que se cumplen las premisas que hemos establecido a la hora de configurar las reglas.</p> <p>Si las comprobaciones est\u00e1n bien, las conexiones necesarias se establecer\u00e1n sin problemas y las que no, se cortar\u00e1n. Muestra una captura donde se vean c\u00f3mo se produce la conexi\u00f3n o el drop. Tambi\u00e9n adjunta una captura del listado de las reglas donde se vea que todas tienen los contadores mayor que 0.</p>"},{"location":"normativa/","title":"Exercici sobre normativa GPDR, LOPDGDD i LSSI","text":""},{"location":"normativa/#exercici-practic-compliment-de-normatives-en-una-plataforma-web","title":"Exercici pr\u00e0ctic: Compliment de normatives en una plataforma web","text":""},{"location":"normativa/#context","title":"Context","text":"<p>L'empresa fict\u00edcia WebData, que ofereix serveis de venda de productes en l\u00ednia, emmagatzema dades personals dels seus clients (n\u00famero, email, adre\u00e7a d'enviament) i utilitza cookies per a an\u00e0lisi de tr\u00e0nsit i publicitat personalitzada.</p>"},{"location":"normativa/#objetivos","title":"Objetivos","text":"<ul> <li> <p>Identificar les dades personals i analitzar si WebData compleix les normatives de protecci\u00f3 de dades (RGPD i LOPDGDD).</p> </li> <li> <p>Verificar el compliment de les obligacions sobre l'\u00fas de cookies i pol\u00edtiques de privadesa segons la LSSI.</p> </li> </ul>"},{"location":"normativa/#tasques","title":"Tasques","text":""},{"location":"normativa/#1-identificacio-i-classificacio-de-dades-personals","title":"1. Identificaci\u00f3 i classificaci\u00f3 de dades personals","text":"<p>Pregunta</p> <p>Quins tipus de dades personals recull WebData? S\u00f3n necess\u00e0ries totes aquestes dades?</p> <p>Pista</p> <ul> <li>Recorda les categor\u00edes de les dades contemplades en el RGPD</li> <li>Recorda els principals aspectes del reglament (RGPD) que hem vist en teor\u00eda i raona quin d'ells aplica ac\u00ed</li> </ul>"},{"location":"normativa/#2-avaluacio-de-la-politica-de-privadesa","title":"2. Avaluaci\u00f3 de la Pol\u00edtica de Privadesa","text":"<p>Pregunta</p> <p>Qu\u00e8 ha d'incloure una pol\u00edtica de privadesa perqu\u00e8 compleixi les normatives vigents (RGPD i LOPDGDD)?</p> <p>Pista</p> <p>Ajuda't d'una b\u00fasqueda en Internet i identifica els aspectes b\u00e0sics que ha de tindre la pol\u00edtica de privadesa </p>"},{"location":"normativa/#3-us-de-cookies-i-gestio-del-consentiment","title":"3. \u00das de cookies i gesti\u00f3 del consentiment","text":"<p>Pregunta</p> <p>Quins passos ha de seguir WebData per complir la LSSI quant a l'\u00fas de cookies? \u00c9s necessari obtenir consentiment per a totes les cookies?</p> <p>Pista</p> <p>Ajuda't d'una b\u00fasqueda en Internet per tal de nombrar els aspectes m\u00e9s b\u00e0sics i importants relacionats amb els tipus de cookies, transpar\u00e8ncia, pol\u00edtica o consentiment, entre altres.</p>"},{"location":"normativa/#4-avaluacio-de-drets-dels-usuaris","title":"4. Avaluaci\u00f3 de drets dels usuaris","text":"<p>Pregunta</p> <p>Quins drets tenen els usuaris segons el RGPD i la LOPDGDD respecte a les vostres dades personals? Com pot WebData garantir que els usuaris puguin exercir aquests drets?</p> <p>Pista</p> <p>Una vegada m\u00e9s, busca en Internet quin son eixos drets i de quina forma s'ha de facilitar com exercir-los.</p>"},{"location":"normativa/#referencies","title":"Refer\u00e8ncies","text":"<p>Informe pol\u00edticas de privacidad</p> <p>Gu\u00eda cookies</p> <p>LOPDGDD</p>"},{"location":"normativa_solucion/","title":"Normativa solucion","text":""},{"location":"normativa_solucion/#ejercicio-practico-simplificado-cumplimiento-de-normativas-en-una-plataforma-web","title":"Ejercicio Pr\u00e1ctico Simplificado: Cumplimiento de Normativas en una Plataforma Web","text":""},{"location":"normativa_solucion/#contexto","title":"Contexto","text":"<p>La empresa ficticia WebData, que ofrece servicios de venta de productos en l\u00ednea, almacena datos personales de sus clientes (nombre, email, direcci\u00f3n de env\u00edo) y utiliza cookies para an\u00e1lisis de tr\u00e1fico y publicidad personalizada. Objetivos</p> <pre><code>Identificar los datos personales que WebData trata y analizar si cumple con las normativas de protecci\u00f3n de datos (RGPD y LOPDGDD).\nEvaluar el cumplimiento de la normativa sobre el uso de cookies y pol\u00edticas de privacidad seg\u00fan la LSSI.\n</code></pre> <p>Actividades</p> <pre><code>Identificaci\u00f3n y clasificaci\u00f3n de datos personales\n    Pregunta: \u00bfQu\u00e9 tipos de datos personales recoge WebData? \u00bfSon necesarios todos estos datos? \u00bfCumplen con las normativas aplicables?\n\nEvaluaci\u00f3n de la Pol\u00edtica de Privacidad\n    Pregunta: \u00bfQu\u00e9 debe incluir una pol\u00edtica de privacidad para que cumpla con las normativas vigentes (RGPD?\n\nUso de cookies y gesti\u00f3n del consentimiento\n    Pregunta: \u00bfQu\u00e9 pasos debe seguir WebData para cumplir con la LSSI en cuanto al uso de cookies? \u00bfEs necesario obtener consentimiento para todas las cookies?\n\nEvaluaci\u00f3n de derechos de los usuarios\n    Pregunta: \u00bfQu\u00e9 derechos tienen los usuarios seg\u00fan el RGPD y la LOPDGDD respecto a sus datos personales? \u00bfC\u00f3mo puede WebData garantizar que los usuarios puedan ejercer estos derechos?\n</code></pre>"},{"location":"normativa_solucion/#solucion-del-ejercicio-practico-simplificado-cumplimiento-de-normativas-en-una-plataforma-web","title":"Soluci\u00f3n del Ejercicio Pr\u00e1ctico Simplificado: Cumplimiento de Normativas en una Plataforma Web","text":"<ol> <li> <p>Identificaci\u00f3n y clasificaci\u00f3n de datos personales</p> <p>Tipos de datos personales recogidos:     Datos b\u00e1sicos: nombre, email, direcci\u00f3n de env\u00edo.     Posible clasificaci\u00f3n: estos son datos de car\u00e1cter personal pero no sensibles (no se recogen datos como salud, ideolog\u00eda, etc.). \u00bfSon necesarios estos datos?     Respuesta esperada: S\u00ed, los datos recogidos son necesarios para la prestaci\u00f3n del servicio de venta en l\u00ednea. Seg\u00fan el RGPD, la empresa puede tratar los datos bajo la base jur\u00eddica de la ejecuci\u00f3n de un contrato (entrega de productos al cliente). Cumplimiento del principio de minimizaci\u00f3n:     Los estudiantes deben identificar si se recogen \u00fanicamente los datos imprescindibles. Si se recogen datos innecesarios, podr\u00eda haber un incumplimiento del RGPD.     Soluci\u00f3n: Los datos recogidos parecen ajustarse a lo necesario para cumplir el servicio ofrecido.</p> </li> <li> <p>Evaluaci\u00f3n de la Pol\u00edtica de Privacidad</p> <p>Elementos que debe incluir la Pol\u00edtica de Privacidad para cumplir con el RGPD:     Finalidad del tratamiento de datos: Explicar de forma clara para qu\u00e9 se usan los datos (por ejemplo, para la entrega de productos, la facturaci\u00f3n, o comunicaciones comerciales con consentimiento).     Base legal: Mencionar la base jur\u00eddica para el tratamiento (ejecuci\u00f3n de un contrato, consentimiento, etc.).     Derechos de los usuarios: Incluir un apartado donde se expliquen los derechos de los usuarios seg\u00fan el RGPD:         Derecho de acceso: Los usuarios pueden solicitar qu\u00e9 datos tiene WebData sobre ellos.         Derecho de rectificaci\u00f3n: Corregir datos inexactos.         Derecho de supresi\u00f3n: Solicitar la eliminaci\u00f3n de sus datos (derecho al olvido).         Derecho a la portabilidad de los datos.     Transferencia de datos a terceros: Incluir si se comparten datos con terceros (por ejemplo, empresas de log\u00edstica o marketing).     Duraci\u00f3n del almacenamiento: Explicar cu\u00e1nto tiempo se guardar\u00e1n los datos personales.     Contacto: Proporcionar un medio para que los usuarios puedan ejercer sus derechos (correo electr\u00f3nico, formulario, etc.).</p> <p>Cumplimiento: Los estudiantes deben asegurarse de que la pol\u00edtica de privacidad est\u00e9 f\u00e1cilmente accesible y escrita en un lenguaje claro, sin tecnicismos.</p> </li> <li> <p>Uso de cookies y gesti\u00f3n del consentimiento</p> <p>Pasos para cumplir con la LSSI:     Informaci\u00f3n clara sobre las cookies: WebData debe informar a los usuarios sobre qu\u00e9 cookies utiliza (anal\u00edticas, publicitarias, esenciales, etc.).     Consentimiento informado: Antes de instalar cualquier cookie no esencial (como cookies publicitarias o de an\u00e1lisis), la empresa debe obtener el consentimiento del usuario. El banner debe permitir aceptar o rechazar las cookies no esenciales.     Opciones de personalizaci\u00f3n: Se debe permitir que los usuarios seleccionen qu\u00e9 tipo de cookies desean aceptar (por ejemplo, solo cookies esenciales o todas).     Pol\u00edtica de cookies: Debe incluirse un enlace a una pol\u00edtica de cookies m\u00e1s detallada, explicando qu\u00e9 cookies se usan, para qu\u00e9 y durante cu\u00e1nto tiempo se almacenan.</p> <p>Cumplimiento: Si no se obtiene el consentimiento previo para las cookies no esenciales, WebData estar\u00eda incumpliendo tanto la LSSI como el RGPD.</p> </li> <li> <p>Evaluaci\u00f3n de derechos de los usuarios</p> <p>Derechos que deben garantizarse seg\u00fan el RGPD y la LOPDGDD:     Derecho de acceso: Los usuarios pueden pedir informaci\u00f3n sobre los datos que WebData almacena sobre ellos. Esto debe ser proporcionado de manera gratuita.     Derecho de rectificaci\u00f3n: Si los datos personales est\u00e1n desactualizados o son incorrectos, el usuario puede solicitar su correcci\u00f3n.     Derecho de supresi\u00f3n (\"derecho al olvido\"): Los usuarios pueden solicitar que se eliminen sus datos personales, especialmente si ya no son necesarios para los fines originales.     Derecho a la limitaci\u00f3n del tratamiento: Los usuarios pueden solicitar que se limite el tratamiento de sus datos bajo ciertas condiciones.     Derecho a la portabilidad: Los usuarios pueden solicitar que se les entregue una copia de sus datos en un formato estructurado y legible, o que se transfieran a otro responsable de tratamiento.     Derecho de oposici\u00f3n: Los usuarios pueden oponerse al tratamiento de sus datos para fines espec\u00edficos, como el marketing directo.</p> <p>C\u00f3mo puede WebData garantizar estos derechos:     Proporcionando un medio de contacto claro, como un formulario web o una direcci\u00f3n de correo electr\u00f3nico en su Pol\u00edtica de Privacidad.     Tener un proceso establecido para gestionar y responder a las solicitudes en un plazo m\u00e1ximo de 30 d\u00edas, como exige el RGPD.</p> </li> </ol> <p>Resumen de Puntos Clave para la Correcci\u00f3n</p> <pre><code>Identificaci\u00f3n y clasificaci\u00f3n de datos personales:\n    Los estudiantes deben ser capaces de identificar los datos personales recogidos y justificar su necesidad seg\u00fan el principio de minimizaci\u00f3n del RGPD.\n\nPol\u00edtica de privacidad:\n    Los alumnos deben identificar los elementos clave que una pol\u00edtica de privacidad debe incluir para cumplir con el RGPD, con especial \u00e9nfasis en la transparencia y los derechos de los usuarios.\n\nGesti\u00f3n de cookies:\n    Deben verificar si la empresa informa correctamente sobre el uso de cookies y obtiene el consentimiento expl\u00edcito para aquellas que no sean esenciales.\n\nDerechos de los usuarios:\n    Los estudiantes deben identificar correctamente los derechos que tienen los usuarios bajo el RGPD y proponer mecanismos para que la empresa garantice estos derechos de forma adecuada.\n</code></pre> <p>https://www.aepd.es/guias/informe-politicas-de-privacidad-adaptacion-rgpd.pdf https://www.aepd.es/guias/guia-cookies.pdf https://ayudaleyprotecciondatos.es/lopdgdd/</p>"},{"location":"outdated/","title":"Comprovaci\u00f3 dels perills de tindre sistemes desactualitzats","text":""},{"location":"outdated/#que-es-shellshock","title":"Qu\u00e8 \u00e9s Shellshock?","text":"<p>Shellshock \u00e9s una vulnerabilitat de seguretat que afecta Bash, un int\u00e8rpret de comandes molt utilitzat en sistemes Unix i Linux, encara que tamb\u00e9 en alguns sistemes macOS. Aquesta vulnerabilitat, descoberta el 2014, permet que un atacant executi ordres no autoritzades en un sistema afectat, comprometent-ne la seguretat. Com funciona Shellshock?</p> <p>La vulnerabilitat de Shellshock permet a un atacant injectar codi malici\u00f3s a variables d'entorn. Bash, quan trobeu una variable d'entorn que cont\u00e9 codi, podeu executar aquest codi, la qual cosa obre una porta perqu\u00e8 un atacant controli remotament el sistema. Aquesta execuci\u00f3 remota d'ordres passa quan el sistema utilitza Bash per interpretar variables d'entorn, com ara aplicacions web, scripts CGI o qualsevol altre sistema que passi informaci\u00f3 a trav\u00e9s de variables.</p>"},{"location":"outdated/#impacte-i-abast-de-shellshock","title":"Impacte i abast de Shellshock","text":"<p>Shellshock \u00e9s una vulnerabilitat cr\u00edtica perqu\u00e8:</p> <ul> <li>\u00c9s f\u00e0cil d'explotar: Amb unes quantes ordres, un atacant pot executar codi malici\u00f3s.</li> <li>\u00c9s dif\u00edcil de detectar: Molts sistemes antics o mal mantinguts encara utilitzen versions de Bash vulnerables, per la qual cosa \u00e9s un blanc f\u00e0cil per a atacs. Podeu atorgar acc\u00e9s complet: Un atacant podria comprometre servidors complets, accedir a bases de dades, robar informaci\u00f3 o instal\u00b7lar codi malici\u00f3s.</li> </ul>"},{"location":"outdated/#com-es-va-mitigar-shellshock","title":"Com es va mitigar Shellshock","text":"<p>Quan Shellshock va ser descobert, els desenvolupadors i administradors de sistemes van treballar per actualitzar Bash, i la comunitat de seguretat va emetre pegats per tancar aquesta vulnerabilitat. Aplicar aquests pegats i actualitzar a versions de Bash corregides \u00e9s fonamental per prevenir atacs que aprofitin aquesta vulnerabilitat.</p>"},{"location":"outdated/#realitzacio-de-la-practica","title":"Realitzaci\u00f3 de la pr\u00e0ctica","text":"<p>Per a aquesta pr\u00e0ctica farem servir una imatge Docker d'una versi\u00f3 antiga d'Ubuntu, on instal\u00b7larem una versi\u00f3 vulnerable de Bash. Aix\u00f2 simular\u00e0 d'alguna manera un cas real d'una empresa on encara es conservin sistemes antics desactualitzats i ens far\u00e0 prendre consci\u00e8ncia del perill.</p> <p>El primer que necessitem sens dubte \u00e9s tenir Docker instal\u00b7lat al nostre sistema Rocky. Per aix\u00f2 podem seguir qualsevol guia, com ara la documentaci\u00f3 oficial de Rocky. </p> <p>Atenci\u00f3</p> <p>Assegureu-vos, seguint la gu\u00eda d'instal\u00b7laci\u00f3, de que podeu executar Docker sense <code>sudo</code>.</p> <p>Haureu de crear un directori i dins d'ell, els dos arxius que es detallen a continuaci\u00f3. El Dockerfile a partir del qual es crear\u00e0 la imatge \u00e9s el seg\u00fcent:</p> Dockerfile<pre><code># Versi\u00f3 desactualitzada d'Ubuntu\nFROM ubuntu:14.04\n# Instal\u00b7lar depend\u00e8ncies per instal\u00b7lar despr\u00e9s una versi\u00f3 vulnerable de Bash\nRUN apt-get update &amp;&amp; \\\napt-get clean &amp;&amp;\\\napt-get install -y build-essential wget\n\nRUN wget https://snapshot.debian.org/archive/debian/20140304T040604Z/pool/main/b/bash/bash_4.1-3_amd64.deb\nRUN dpkg -i bash_4.1-3_amd64.deb\n\n# Copiem un petit script al directori adequat perqu\u00e8 sigui servit per Apache\nRUN mkdir -p /usr/lib/cgi-bin\nCOPY prova_shellshock.sh /usr/lib/cgi-bin/prova_shellshock.sh\nRUN chmod +x /usr/lib/cgi-bin/prova_shellshock.sh\n\n# Instal\u00b7lem Apache i el m\u00f2dul adequat per a scripts CGI\nRUN apt-get install -y apache2 &amp;&amp; \\\na2enmod cgi &amp;&amp; \\\nservice apache2 restart\n\n# Iniciem Apache\nCMD [\"apachectl\", \"-D\", \"FOREGROUND\"]\n</code></pre> <p>El contingun de l'script que servir\u00e0 Apache \u00e9s:</p> prova_shellshock.sh<pre><code>#!/bin/bash\necho \"Content-type: text/html\"\necho \"\"\necho \"Shellshock Script de prova\"\necho \"&lt;pre&gt;\"\necho \"Data: $(date)\"\necho \"Temps en funcionament: $(uptime)\"\necho \"&lt;/pre&gt;\"\n</code></pre> <p>Constru\u00efm la imatge Docker a partir del Dockerfile situant-nos en el directori a on est\u00e0 ubicat el fitxer:</p> <p><pre><code>docker build -t prova_shellshock .\n</code></pre> I si tot ha anat b\u00e9, apareixer\u00e0 llistada:</p> <pre><code>docker images\n</code></pre> <p>Ara pasem a executar el contenidor a partir de la imatge:</p> <pre><code>docker run -d -p 8080:80 --name practica_desactualitzat_shellshock prova_shellshock\n</code></pre> <p>I es quedar\u00e0 executant-se en background, podeu comprovar-lo amb:</p> <pre><code>docker ps\n</code></pre> <p>Ara si en el vostre navegador accediu a <code>http://IP-Rocky:8080/cgi-bin/prova_shellshock.sh</code>hauria d'executar-se l'script i vore algo com:</p> <p></p> <p>I ja tindr\u00edem el nostre escenari preparat. Ara es el vostre torn:</p> <ol> <li>Investiga com pots comprovar que el sistema es vulnerable a Shellshock:<ol> <li>Fes-lo primer amb el comandament <code>curl</code></li> <li>Fes-lo despr\u00e9s amb <code>nmap</code>i l'script <code>.nse</code>adequat</li> </ol> </li> <li>Quan ja hem certificat per duplicat que el sistema \u00e9s vulnerable, investiga com aplicar el parxe al sistema</li> <li>Torna a comprovar si el sistema \u00e9s vulnerable i certifica l'\u00e9xit del parxe</li> </ol> <p>Ajuda</p> <p>Per poder ficar-nos dins del contenidor Ubuntu que hem creat i utilitzar la seua l\u00ednia de comandaments, podem fer servir el comandament:</p> <pre><code>docker exec -it practica_desactualitzat_shellshock /bin/bash\n</code></pre>"},{"location":"perimetral/","title":"Disseny del per\u00edmetre","text":""},{"location":"perimetral/#disseny-dun-perimetre-segur-per-a-una-petita-empresa","title":"Disseny d'un per\u00edmetre segur per a una petita empresa","text":""},{"location":"perimetral/#objectiu","title":"Objectiu","text":"<p>Haureu de dissenyar un per\u00edmetre de xarxa segur per a una petita empresa, tenint en compte les possibles amenaces, les necessitats de l'empresa i la ubicaci\u00f3 dels dispositius.</p>"},{"location":"perimetral/#escenari","title":"Escenari","text":"<p>Una petita empresa vos ha contractat per millorar la seguretat de la seva xarxa. L'empresa t\u00e9:</p> <ul> <li>50 empleats.</li> <li>Un servidor web p\u00fablic.</li> <li>Una VPN per a treballadors remots.</li> <li>Un servidor de fitxers intern amb dades confidencials dels clients.</li> <li>Un pressupost modest per a dispositius de seguretat.</li> </ul> <p>L'empresa ha experimentat incidents menors, com intents de phising i acc\u00e9s no autoritzat al servidor web. La vostra tasca \u00e9s dissenyar un per\u00edmetre segur i recomanar dispositius per protegir la xarxa.</p>"},{"location":"perimetral/#pas-1-investigar-i-planificar","title":"Pas 1: Investigar i planificar","text":"<p>Amenaces a tenir en compte:</p> <ul> <li>Atacs externs (p. ex., DDoS, escaneig de ports i intents d'explotaci\u00f3).</li> <li>Amenaces internes.</li> <li>Malware/ransomware que ingressa a trav\u00e9s del correu electr\u00f2nic o el tr\u00e0nsit web.</li> <li>Acc\u00e9s remot no segur.</li> </ul> <p>Dispositius/tecnologies a utilitzar:</p> <ul> <li>Tallafocs (amb estat, reconeixement d'aplicacions, etc.).</li> <li>Sistemes de detecci\u00f3 i prevenci\u00f3 d'intrusions (IDS/IPS).</li> <li>Tallafocs d'aplicacions web (WAF).</li> <li>Porta d'enlla\u00e7 VPN.</li> <li>Eines de protecci\u00f3 i monitoritzaci\u00f3 de punts finals.</li> <li>Zona desmilitaritzada (DMZ) per a serveis p\u00fablics.</li> </ul>"},{"location":"perimetral/#pas-2-tasques","title":"Pas 2: Tasques","text":"<ol> <li> <p>Dibuixar l'arquitectura del per\u00edmetre:</p> <ul> <li>Haureu de crear un diagrama de xarxa amb zones clarament diferenciades: p\u00fablica, DMZ i xarxes internes.</li> <li>Incloure la ubicaci\u00f3 dels dispositius, com firewalls, IDS/IPS i balancejadors de c\u00e0rrega.</li> </ul> </li> <li> <p>Elegir i justificar els dispositius:</p> <ul> <li>Els estudiants han de seleccionar almenys tres dispositius de seguretat per incloure al disseny. Exemples:<ul> <li>Un tallafocs d'\u00faltima generaci\u00f3 (p. ex., Palo Alto, Fortinet).</li> <li>Un WAF per al servidor web (p. ex., ModSecurity, AWS WAF).</li> <li>Un IDS/IPS (p. ex., Suricata, Snort).</li> <li>Una soluci\u00f3 VPN per a acc\u00e9s remot segur (p. ex., OpenVPN, Cisco AnyConnect).</li> <li>Han d'explicar per qu\u00e8 es van triar aquests dispositius i com mitiguen amenaces espec\u00edfiques.</li> </ul> </li> </ul> </li> <li> <p>Abordar les limitacions pressupost\u00e0ries:</p> <ul> <li>L'empresa vos a posat com a l\u00edmi pressupostari total uns 20.000\u20ac. Aix\u00ed les coses, potser haureu de considerar software de codi obert o basat en el n\u00favol, entre altres solucions.</li> </ul> </li> </ol>"},{"location":"perimetral/#entregables","title":"Entregables","text":"<ol> <li> <p>Diagrama de xarxa:     Una representaci\u00f3 visual del per\u00edmetre de la xarxa, que mostra les zones i la ubicaci\u00f3 dels dispositius.</p> </li> <li> <p>Recomanacions de dispositius:     Una llista de dispositius o eines recomanats amb justificaci\u00f3 per a cada opci\u00f3, aix\u00ed com el preu.</p> </li> <li> <p>Pla de mitigaci\u00f3 de riscos:     Una breu explicaci\u00f3 de com el disseny proposat aborda les amenaces identificades.</p> </li> </ol>"},{"location":"perimetral/#repte-addicional-i-dampliacio-opcional","title":"Repte addicional i d'ampliaci\u00f3 (opcional)","text":"<p>En un segon escenari, l'empresa s'expandeix per incloure una sucursal. Haureu d'ajustar el disseny del seu per\u00edmetre per incorporar una connexi\u00f3 segura de site-to-site.</p> <p>Aquest exercici emfatitza la planificaci\u00f3 i el pensament cr\u00edtic, que s\u00f3n habilitats essencials per dissenyar per\u00edmetres segurs. </p>"},{"location":"proxy-caddy/","title":"Configuraci\u00f3n de Caddy como proxy inverso para contenedores Docker","text":""},{"location":"proxy-caddy/#que-es-caddy","title":"\u00bfQu\u00e9 es Caddy?","text":"<p>Caddy 2 es un potente servidor web de c\u00f3digo abierto desarrollado haciendo uso del lenguaje de programaci\u00f3n Go.</p> <p>Simplifica la infraestructura a montar y se encarga de forma autom\u00e1tica de las renovaciones de certificados SSL para los sitios web. Aunque comunmente se usa como servidor web o proxy, tambi\u00e9n se podr\u00eda utilizar para otras funciones:</p> <ul> <li>Proxy sidecar</li> <li>Balanceador de carga</li> <li>Puerta de enlace API</li> <li>Control de ingreso </li> </ul> <p></p> <p>Es una aplicaci\u00f3n con un enfoque m\u00e1s cl\u00e1sico que Traefik y s\u00ed tiene ficheros de configuraci\u00f3n. Pero al mismo tiempo est\u00e1 pensado para ser muy simple, y gestionar autom\u00e1ticamente y por defecto cosas que en otro servidores web habr\u00eda que hacer de forma expl\u00edcita.</p>"},{"location":"proxy-caddy/#como-funciona-caddy","title":"\u00bfC\u00f3mo funciona Caddy?","text":"<p>Un proxy inverso es un intermediario entre los dispositivos cliente y los servidores web, administrando las peticiones y respuestas con el fin de mejorar la seguridad, el rendimiento y la flexibilidad.</p> <p> </p> <p>Caddy permite:</p> <ul> <li> <p>Configuraci\u00f3n SSL/TLS autom\u00e1tica: Caddy se integra sin problemas con Let's Encrypt de tal forma que es capaz de obtener y renovar de forma autom\u00e1tica los certificados SSL/TLS para HTTPS, asegurando siempre una comunicaci\u00f3n segura.     Tambi\u00e9n incluye y configura autom\u00e1ticamente unos certificados autofirmados para entornos locales o de desarrollo.</p> </li> <li> <p>Configuraci\u00f3n mediante un archivo llamado Caddyfile, haci\u00e9ndolo muy simple.</p> </li> <li>Soporte para los nuevos protocolos HTTP/2 y QUIC </li> <li>Monitorizaci\u00f3n y m\u00e9tricas en tiempo real, compatibles con sistemas de monitorizaci\u00f3n como Prometheus.</li> <li>Middleware y extensiones: Caddy permite, haciendo uso de plugins, a\u00f1adir funcionalidades interesantes a la aplicaci\u00f3n</li> </ul>"},{"location":"proxy-caddy/#objetivo-de-la-practica","title":"Objetivo de la pr\u00e1ctica","text":"<p>El objetivo de esta pr\u00e1ctica ser\u00e1 configurar un contenedor Docker de Caddy como proxy inverso para apliciaciones web, tambi\u00e9n desplegadas en contenedores Docker. Adem\u00e1s, Caddy utilizar\u00e1 certificados autofirmados para que el acceso a las aplicaciones web se efect\u00fae de forma segura mediante HTTPS.</p>"},{"location":"proxy-caddy/#realizacion","title":"Realizaci\u00f3n","text":"<p>Dado el siguiente archivo donde se despliegan los elementos necesarios:</p> compose.yaml<pre><code>#-----------------------------------------------------------------------------------------------\n# ! Este archivo docker compose es apto para entornos locales o de desarrollo, no de producci\u00f3n. \n#-----------------------------------------------------------------------------------------------\n# Nombre del proyecto\nname: docker-reverse-proxy\n# Servicios Docker.\nservices:\n# Contenedor de Caddy\ncaddy:\n# https://hub.docker.com/_/caddy\nimage: caddy:alpine\ncontainer_name: ${CONTAINER_NAME:-reverse_proxy}\nrestart: unless-stopped\nnetworks:\n- reverse_proxy\n# Mapea los puertos expuestos en las aplicaciones a los puertos del host o m\u00e1quina anfitri\u00f3n\nports:\n- 80:80\n- 443:443\n- ${ADMIN_API_PORT:-2019}:2019\nvolumes:\n- caddy_data:/data\n- caddy_config:/config\n# Archivo de configuraci\u00f3n de Caddy\n- $PWD/config/Caddyfile:/etc/caddy/Caddyfile\n# Autoridad de certificaci\u00f3n (CA) de Caddy\n- $PWD/certificate-authority:/data/caddy/pki/authorities/local\n# Aplicaci\u00f3n web de prueba con nginx\nwebsite:\nimage: \"nginxdemos/hello\"\ncontainer_name: app_demo\n# Correspondencia entre puerto utilizado por el contenedor y el accesible desde el anfitri\u00f3n\nports:\n- 8080:80\nnetworks:\n- reverse_proxy\n# Redes de Docker\nnetworks:\nreverse_proxy:\nexternal: true\n# Vol\u00famenes de Docker\nvolumes:\ncaddy_data:\ndriver: \"local\"\nname: \"${CONTAINER_VOLUME_DATA_NAME:-reverse_proxy_data}\"\ncaddy_config:\ndriver: \"local\"\nname: \"${CONTAINER_VOLUME_CONFIG_NAME:-reverse_proxy_config}\"\n</code></pre> <p>Se requiere modificar el archivo de configuraci\u00f3n Caddyfile:</p> <pre><code>#--------------------------------------------------------------------------\n# Caddy configuration\n# https://caddyserver.com/docs/caddyfile/options\n#--------------------------------------------------------------------------\n\n{\n  debug\n  local_certs\n  auto_https disable_redirects\n  admin 0.0.0.0:2019\n}\n\n#--------------------------------------------------------------------------\n# Reverse proxy\n# https://caddyserver.com/docs/caddyfile/directives/reverse_proxy\n#--------------------------------------------------------------------------\n\n# Aqu\u00ed se configura el acceso HTTP al contenedor de la aplicaci\u00f3n web\n# Tambi\u00e9n se debe configurar para que el acceso http sea redirigido autom\u00e1ticamente al bloque de https\n\n# Bloque HTTP\n\n________:____ {\n  redir ___________\n}\n\n# Bloque HTTPS\n\n________:_____ {\n  tls internal\n  reverse_proxy _____\n\n}\n</code></pre> <p>Para que:</p> <ul> <li>En el primer bloque, se tenga acceso HTTP a la aplicaci\u00f3n<ul> <li>Pero se haga una redirecci\u00f3n al bloque de HTTPS</li> </ul> </li> <li>En el segundo bloque est\u00e9 configurado el acceso HTTPS<ul> <li>Realizando las labores de proxy inverso, se redirija la petici\u00f3n a la aplicaci\u00f3n en cuesti\u00f3n</li> </ul> </li> </ul> <p>Atenci\u00f3n</p> <p>Caddy tiene utiliza un DNS interno que es capaz de resolver los nombres de los contenedores, por lo que, aunque se podr\u00eda, no hace falta utilizar IPs para nada en la configuraci\u00f3n.</p> <p>Tarea</p> <ul> <li>Investiga el funcioamiento de este archivo de configuraci\u00f3n y compl\u00e9talo tal y como se solicita par hacerlo funcionar</li> <li>Comprueba con tu navegador que funciona correctamente:<ul> <li>Al acceder por http se te redirige a https</li> <li>La primera vez que accedas dar\u00e1 una alerta de seguridad al ser un certificado autofirmado, dadle a aceptar el riesgo </li> </ul> </li> </ul>"},{"location":"proxy-caddy/#redireccion-automatica-de-http-a-https","title":"Redirecci\u00f3n autom\u00e1tica de HTTP a HTTPS","text":"<p>De alguna forma, en el apartado anterior hemos realizado esta redirecci\u00f3n a una comunicaci\u00f3n segura de forma manual. No obstante, la sencillez de Caddy hace que el mismo proxy realice esta redirecci\u00f3n de forma autom\u00e1tica, si nuestra intervenci\u00f3n, a menos que nosotros le digamos lo contrario.</p> <p>Tarea</p> <ul> <li>Elimina el bloque completo de HTTP del archivo Caddyfile, dejando \u00fanicamente el de HTTPS</li> <li>Investiga que opci\u00f3n de configuraci\u00f3n del archivo Caddyfile debemos eliminar para que se realice la redirecci\u00f3n autom\u00e1ticamente</li> <li>Comprueba que funciona correctamente</li> </ul> <p>Tarea</p> <ul> <li>En el <code>compose.yaml</code> a\u00f1ade una nueva aplicaci\u00f3n, como por ejemplo esta y config\u00farala de la misma forma que la anterior.</li> </ul>"},{"location":"proxy-caddy/#para-nota","title":"Para nota","text":"<p>Caddy puede funcionar tambi\u00e9n de la misma forma que lo hace Traefik, usando etiquetas (labels) en el <code>compose.yml</code>. Para ello utiliza un plugin que se denomina <code>caddy-docker-proxy</code>.</p> <p>Tarea</p> <p>Investiga esta opci\u00f3n y realiza de nuevo la pr\u00e1ctica anterior mediante labels en lugar de utilizar el archivo de configuraci\u00f3n Caddyfile</p>"},{"location":"proxy-caddy/#referencias","title":"Referencias","text":"<p>Proxy Inverso con Caddy</p> <p>De Apache a Caddy</p> <p>Create and build simple reverse proxy with Caddy1</p> <p>Caddy como proxy inverso pero muy f\u00e1cil</p>"},{"location":"proxy-traefik/","title":"Configuraci\u00f3n de Traefik como proxy inverso para contenedores Docker","text":""},{"location":"proxy-traefik/#que-es-traefik","title":"\u00bfQu\u00e9 es Traefik?","text":"<p>Respuesta r\u00e1pida: Traefik es un proxy inverso y balanceador de carga que se integra nativamente con Docker.</p> <p>De forma un poco m\u00e1s completa, Traefik act\u00faa como router, interceptando y enrutando todas las solicitudes entrantes a los servicios del backend qu\u00e9 corresponda en cada caso. Esto es especialmente en entornos muy grandes con gran n\u00famero de servicios o microservicios.</p> <p>Una potente funcionalidad de Traefik es el hecho de realizar un descubrimiento din\u00e1mico de los servicios que debe enrutar. Si a\u00f1adimos un nuevo servicio, s\u00f3lo debemos a\u00f1adir el endpoint adecuado para que Traefik se encargue de todo lo dem\u00e1s y lo deje funcionando correctamente.</p> <p></p> <p>Aunque existen otras alternativas bastate potentes, \u00fatiles y conocidas, en este caso trataremos con una de las m\u00e1s populares para tener un ligero conocimiento de la misma.</p>"},{"location":"proxy-traefik/#como-funciona-traefik","title":"\u00bfC\u00f3mo funciona Traefik?","text":"<p>En esta imagen vemos meridianamente claro el funcionamiento de este edge router o router de frontera1, como es Traefik.</p> <p>De acuerdo con la documentaci\u00f3n oficial de Traefik:</p> <ul> <li> <p>Puntos de entrada: Los EntryPoints son los puntos de entrada de la red a Traefik. Definen el puerto que recibir\u00e1 los paquetes y si escuchar\u00e1 TCP o UDP.</p> </li> <li> <p>Enrutadores: Un router se encarga de conectar las peticiones entrantes con los servicios que pueden gestionarlas.</p> </li> <li> <p>Middlewares: Adjuntos a los routers, los middlewares pueden modificar las peticiones o respuestas antes de que sean enviadas a su servicio</p> </li> <li> <p>Servicios: Los servicios se encargan de configurar c\u00f3mo llegar a los servicios reales que finalmente gestionar\u00e1n las peticiones entrantes.</p> </li> </ul>"},{"location":"proxy-traefik/#objetivo-de-la-practica","title":"Objetivo de la pr\u00e1ctica","text":"<p>En esta pr\u00e1ctica tendremos dos servicios, uno al que se acceder\u00e1 mediante la url <code>http://localhost</code>y otro mediante la url <code>http://localhost/whoami2</code>. Ser\u00e1 Traefik el encargado de decidir hacia qu\u00e9 servicio o contenedor dirigir\u00e1 la petici\u00f3n en base a esta url 2.</p> <p></p> <p>Adem\u00e1s, cada uno de los dos servicios estar\u00e1n formados por m\u00e1s de una instancia o contenedor, por lo que el proxy inverso adem\u00e1s de enrutar tambi\u00e9n realizar\u00e1 un balanceo de carga.</p> <p>Una vez tengamos funcionando el escenario, utilizaremos otras funcionalidades del proxy.</p>"},{"location":"proxy-traefik/#realizacion","title":"Realizaci\u00f3n","text":""},{"location":"proxy-traefik/#configuracion-de-traefik","title":"Configuraci\u00f3n de Traefik","text":"<p>Vamos a utilizar el siguiente archivo:</p> docker-compose.yml<pre><code>networks:\nred_traefik:\ndriver: bridge\nipam:\nconfig:\n- subnet: 172.24.0.0/24 #(5)\nservices:\ntraefik:\nimage: \"traefik:v2.6\"\ncommand:\n#- \"--log.level=DEBUG\"\n- \"--api.insecure=__________\" #(1)\n- \"--providers.docker=______\" #(2)\n- \"--providers.docker.exposedbydefault=_______\" #(3)\n- --providers.file.directory=/certificados\n- --providers.file.watch=true\n- \"--entrypoints.____.address=____\" #(4)\nports:\n- \"80:80\"\n- \"8080:8080\"\nvolumes:\n- \"/var/run/docker.sock:/var/run/docker.sock:ro\"\n- \"./certificados:/certificados\"\nnetworks:\n- red_traefik\n</code></pre> <ol> <li>Permite el acceso al panel de control web de Traefik. S\u00f3lo para escenarios de pruebas, debe deshabilitarse en producci\u00f3n.</li> <li>Habilita el descubrimiento autom\u00e1tico de configuraciones Docker</li> <li>No exponer los servicios de Docker por defecto</li> <li>Crea un entrypoint llamado web y que escucha en el puerto 80</li> <li>Direcci\u00f3n de subred en la que ubicaremos a nuestros contenedores/servicios</li> </ol> <p>En la secci\u00f3n ports exponemos el puerto 80 para permitirel acceso al entrypoint web y el puerto 8080 es el puerto por defecto del panel de control web de Traefik.</p> <p>Adem\u00e1s, se necesita crear un volumen y conectarlo con docker.sock para que Traefik pueda comunicarse con el demonio de Docker y consultarle informaci\u00f3n acerca de los contenedores que est\u00e9n corriendo en ese momento.</p>"},{"location":"proxy-traefik/#configuracion-de-un-servicio","title":"Configuraci\u00f3n de un servicio","text":"<p>Al anterior archivo <code>docker-compose.yaml</code> le a\u00f1adiremos el siguiente servicio:</p> docker-compose.yml<pre><code> whoami:\nimage: \"traefik/whoami\"\ndeploy:\nreplicas: 3 # (4)\nlabels:\n- \"traefik.enable=_______\" #(1)\n- \"traefik.http.routers.whoami.rule=Host(`_______`)\" #(2)\n- \"traefik.http.routers.whoami.entrypoints=_______\" #(3)\nnetworks:\n- red_traefik #(5)\n</code></pre> <ol> <li>Le decimos a Traefik que hay un servicio que queremos exponer</li> <li>Aqu\u00ed especificamos la regla que se debe cumplir para relacionar una petici\u00f3n concreta con este servicio (recuerda cu\u00e1l es nuestro nombre de \"dominio\")</li> <li>Aqu\u00ed le decimos cu\u00e1l de los entrypoint previamente configurados se debe usar para acceder a este servicio </li> <li>Desplegamos 3 instancias del servicio, para poder probar el balanceo de carga</li> <li>Subred a la que pertenecer\u00e1 el contenedor</li> </ol>"},{"location":"proxy-traefik/#configuracion-multiservicio-y-con-coincidencia-de-ruta-patch-matching","title":"Configuraci\u00f3n multiservicio y con coincidencia de ruta (patch matching)","text":"<p>A\u00f1adimos, a continuaci\u00f3n de los anteriores, un nuevo servicio en el fichero <code>yaml</code>:</p> docker-compose.yml<pre><code>  whoami2: #(2)\nimage: \"nginxdemos/hello\" #(1)\ndeploy:\nreplicas: 4 #(3)\nlabels:\n- \"traefik.enable=true\"\n- \"traefik.http.routers.whoami2.rule=Host(`_______`) &amp;&amp; Path(`______`)\" #(4)\n- \"traefik.http.routers.whoami2.entrypoints=web\"\nnetworks:\n- red_traefik #(5)\n</code></pre> <ol> <li>Utilizamos otra imagen de Docker, basada en Nginx que nos mostrar\u00e1 la IP del servidor al que se accede, adem\u00e1s de permitir la recarga autom\u00e1tica. Esto nos facilitar\u00e1 la comprobaci\u00f3n del balanceo de carga.</li> <li>Nombre de este nuevo servicio</li> <li>N\u00famero de instancias a desplegar</li> <li>Queremos que Traefik redirija nuestras peticiones a este servicio cuando accedamos a <code>http://localhost/whoami2</code></li> <li>Subred a la que pertenecer\u00e1 el contenedor</li> </ol> <p>Tarea</p> <p>Comprueba el correcto funcionamiento del escenario:</p> <ol> <li>Accede en tu navegador a <code>http://localhost</code><ul> <li>Recarga varias veces la p\u00e1gina para comprobar que cambia la IP del contenedor y se est\u00e1 produciendo el balanceo de carga.</li> </ul> </li> <li>Accede ahora a <code>http://localhost/whoami2</code>, comprueba que funciona y marca la opci\u00f3n de recargar autom\u00e1ticamente. Comprueba que las peticiones se van repartiendo entre distintos contenedores.</li> </ol> <p>Documenta detalladamente el proceso, indicando exactamente lo que est\u00e1s comprobando.</p>"},{"location":"proxy-traefik/#middleware","title":"Middleware","text":"<p>Tarea</p> <p>Investiga y explica brevemente con tus palabras cu\u00e1l es la funci\u00f3n concreta del middleware en Traefik y lista algunas de sus funciones.</p>"},{"location":"proxy-traefik/#lista-blanca-de-ips","title":"Lista blanca de IPs","text":"<p>En esta parte de la pr\u00e1ctica vamos a hacer uso de esta funci\u00f3n de middleware de Traefik. Fltraremos las IPs de origen que tendr\u00e1n acceso a los servicios de tal forma qu\u00e9:</p> <p></p> <p>Busca informaci\u00f3n sobre c\u00f3mo aplicar el filtrado de IP mediante las listas blancas en Traefik y completa el <code>docker-compose.yml</code> que ya ten\u00edamos con las l\u00edneas resaltadas, as\u00ed como completa los huecos que hagan falta.</p> docker-compose.yml<pre><code> whoami:\nimage: \"traefik/whoami\"\ndeploy:\nreplicas: 3 labels:\n- \"traefik.enable=_______\" - \"traefik.http.routers.whoami.rule=Host(`_______`)\" - \"traefik.http.routers.whoami.entrypoints=_______\" - \"traefik.http.middlewares.whoami-filter-ip.ipwhitelist.__________=___________/24\"\n- \"traefik.http.routers.whoami.middlewares=______________\"\nnetworks:\n- red_traefik\n</code></pre> <p>Tarea</p> <ul> <li>Coloca una lista blanca en el servicio <code>whoami</code> para una direcci\u00f3n de subred diferente a la que estamos utilizando. Comprueba que al intentar acceder, obtienes el <code>403 forbidden</code> que se detalla en el esqumema de la imagen de arriba.</li> <li>De la misma forma, coloca una lista blanca para el servicio <code>whoami2</code> que permite el acceso a la direcci\u00f3n de subred correcta y comprueba que puedes seguir accediendo sin problemas.</li> </ul> <p>Documenta y explica detalladamente el proceso que has seguido para completar el archivo <code>yaml</code>. </p>"},{"location":"proxy-traefik/#autenticacion-basica","title":"Autenticaci\u00f3n b\u00e1sica","text":"<p>Traefik tambi\u00e9n nos ofrece la posibilidad de a\u00f1adir una autenticaci\u00f3n b\u00e1sica al acceso de los distintos servicios.</p> <p>En este caso lo que vamos a hacer es suprimir del primer servicio, de <code>whoami</code> las l\u00edneas que hacen referencia a la lista blanca de IPs y a\u00f1adiremos unas l\u00edneas que proporcionen una autenticaci\u00f3n b\u00e1sica al servicio (la autenticaci\u00f3n):</p> docker-compose.yml<pre><code> whoami:\nimage: \"traefik/whoami\"\nlabels:\n- \"traefik.enable=true\"\n- \"traefik.http.routers.whoami.rule=Host(`__________`)\"\n- \"traefik.http.routers.whoami.entrypoints=_________\"\n- \"traefik.http.middlewares.whoami-auth._____________=raul:$$apr1$$CHKKEQyv$$/Fktitry1Az6rZNYADnDo.\" #(1)\n- \"traefik.http.routers.whoami.middlewares=____________\"\nnetworks:\n- red_traefik\n</code></pre> <ol> <li>Aqu\u00ed debe ir vuestro usuario con vuestra contrase\u00f1a generada, no pong\u00e1is el m\u00edo.</li> </ol> <p>Para generar la contrase\u00f1a, en el terminal pod\u00e9is hacer:</p> <pre><code>echo $(htpasswd -nb vuestro_usuario vuestra_contrase\u00f1a) | sed -e s/\\\\$/\\\\$\\\\$/g\n</code></pre> <p>Para ejecutar este comando en terminal os har\u00e1 falta el paquete apache2-utils, si no lo ten\u00e9is instalado pod\u00e9is hacerlo as\u00ed:</p> <pre><code>sudo apt uptdate &amp;&amp; sudo apt install apache2-utils\n</code></pre> <p>O similar, dependiendo del gestor de paquetes que us\u00e9is.</p> <p>Tarea</p> <ul> <li>Modifica el <code>docker-compose.yml</code> tal y como se indica, rellenando los nuevos huecos de las l\u00edneas resaltadas (los otros dos ya deber\u00edais tenerlos completados de antes). </li> <li>Comprueba que se te solicita autenticaci\u00f3n y que s\u00f3lo eres capaz de acceder con la correcta</li> </ul> <p>Documenta y explica detalladamente el proceso que has seguido para completar el archivo <code>yaml</code>. </p> <p>Tarea</p> <p>Accede al dashboard de Traefik en <code>http://localhost:8080</code> e investiga la informaci\u00f3n mostrada en las distintas secciones. Explica qu\u00e9 significa lo que ves.</p>"},{"location":"proxy-traefik/#para-nota","title":"Para nota","text":"<p>Otra funci\u00f3n que puede realizar nuestro proxy inverso es la de asumir la responsabilidad de los certificados para https de nuestros servicios web, liberando as\u00ed de esa carga a los propios servicios y unificando su administraci\u00f3n en un \u00fanico punto.</p> <p>Tarea para nota</p> <p>Busca informaci\u00f3n sobre c\u00f3mo utilizar certificados autofirmados en Traefik y configuralos para ambos servicios web.</p> <p>Pista</p> <p>Deber\u00e1s generar unos certificados y crear un archivo de configuraci\u00f3n <code>.yml</code> para que Traefik sepa que debe utilizarlos.</p> <p>La primera vez que accedas a ambos servicios por https te saldr\u00e1 un aviso de certificado no confiable, lo cual es normal al estar autofirmado, s\u00f3lo debes aceptar el riesgo.</p> <p>Pregunta</p> <p>\u00bfPor qu\u00e9 si cada vez accedo a un contenedor diferente para cada servicio (recuerda el balanceo de carga) no me vuelve a pedir que acepte el riesgo del certificado cuando accedo a otro nuevo por primera vez?</p>"},{"location":"proxy-traefik/#referencias","title":"Referencias","text":"<p>Documentaci\u00f3n oficial de Traefik</p> <p>El proxy inverso Traefik, caracter\u00edsticas y funcionalidades que ofrece</p> <p>Docker reverse proxy using Traefik</p> <ol> <li> <p>Estos routers son dispositivos situados entre la red interna de y las redes de otros proveedores que intercambian el tr\u00e1fico con nosotros y que se encargan de dirigir el tr\u00e1fico de datos de una lado a otro.\u00a0\u21a9</p> </li> <li> <p>En un escenario real emplearemos nuestro propio dominio, como por ejemplo <code>http://este-es-mi-dominio.es</code>. Sin embargo, puesto que no tenemos ning\u00fan dominio registrado, utilizamos la direcci\u00f3n de nuestro equipo local.\u00a0\u21a9</p> </li> </ol>"},{"location":"proxy/","title":"Configuraci\u00f3 de proxy Squid amb servidor d'autenticaci\u00f3 freeradius en Docker","text":""},{"location":"proxy/#tasques-a-realitzar-i-detalls-de-la-practica","title":"Tasques a realitzar i detalls de la pr\u00e1ctica","text":"<ol> <li>El shared secret \u00e9s una clau compartida entre els clients i el servidor Radius. S'utilitza per a limitar l'\u00fas no autoriztat del servidor d'autenticaci\u00f3. El secret compartit d'esta pr\u00e0ctica \u00e9s invent.</li> <li>Com a contrasenya de root de la BBDD MySQL podeu posar la que m\u00e9s vos agrade.</li> <li>Heu d'omplir els ports a utilitzar per cada servici en el <code>docker-compose.yml</code>(son els ports per defecte del servicis).</li> <li> <p>L'arxiu clients.conf identifica quins dispositius poden comunicarse amb el servidor Radius amb intencions d'autenticar-se, per\u00f2 no realitza l'autenticaci\u00f3. Eixa tasca pertany a l'arxiu users o, en el nostre cas, authorize. </p> <p>Has de crear un usuari en el arxiu clients.conf de Freeradius (el nomb \u00e9s indiferent, nomb\u00e9s serveix per a identificar al client). Mira el diagrama anterior atentament i tingues clar qui demanar\u00e0 l'autoritzaci\u00f3 a Radius</p> </li> <li> <p>A l'inici del fitxer authorize crear un usuari amb autenticaci\u00f3 en text pl\u00e0 (la credencial ser\u00e0 el vostre nom i de contrasenya el cognom). Este arxiu s\u00ed serveix per a l'autenticaci\u00f3</p> </li> <li>Heu d'omplir l'arxiu radius_config de Squid.</li> <li>Afegir una ACL (llista d'acc\u00e9s) que es cride <code>SSL_Ports</code> i que incloga el port 443.</li> <li>Firefox enviar\u00e0 tot el seu tr\u00e0fic (http i https) al port configurat per a Squid. Configurar Firefox per a utilitzar el proxy, tant http, com https (mateix port d'Squid).</li> <li>Quan tot estiga funcionant, baixe-vos e instal\u00b7leu el certificat autogenerat per a que el tr\u00e0fic HTTPS siga completament confiable i no done problemes.</li> <li> <p>Insertar un usuari en la BBDD <code>radius</code> des del contenidor de freeradius, en la taula <code>radcheck</code>. Els valors:</p> <pre><code>username --&gt; Omplir\nattribute --&gt; \"Cleartext-Password\"\nop --&gt; \":=\"\nvalue --&gt; Omplir\n</code></pre> </li> <li> <p>Totes les comprovacions s'han de fer mostrant els logs, tant d'Squid a on es puga veure tots els accesos a Internet que realitzeu, com de Freeradius i a on es mostren ambd\u00f2s autenticacions.</p> </li> </ol> <p>Atenci\u00f3<p>Haur\u00e1s de modificar el <code>radius.conf</code> del contenidor radius per a loguear els intents d'autenticaci\u00f3, tant si s'utilitza un password correcte, com si \u00e9s incorrecte. Donat que no teniu editor de texts en el contenidor, podeu trobar utilitat en aquest comand:</p> <pre><code>sed -i 's/Terme a sustituir/Terme nou/g' arxiu\n</code></pre> </p>"},{"location":"proxy/#contingut-extra-per-a-la-recuperacio-de-la-practica","title":"Contingut extra per a la recuperaci\u00f3 de la pr\u00e0ctica","text":"<p>Per tal de completar la recuperaci\u00f3 d'aquesta pr\u00e0ctica es demana, a m\u00e9s de tot lo anterior:</p> <ol> <li> <p>Configurar Squid per a que bloquegi totes les descarregues majors de 10MB. Podeu comprovar si funciona intentant baixar qualsevol distribuci\u00f3 de Linux.</p> <ul> <li>S'ha de mostrar comprovacions tant del navegador com dels logs.</li> </ul> </li> <li> <p>Configurar Squid per a que bloquegi tot acc\u00e9s a Internet a la IP del client.</p> <ul> <li> <p>S'ha de mostrar comprovacions tant del navegador com dels logs.</p> <p>Consell</p> <p>Configurar el bloqueig abans de que arrive a saltar l'autenticaci\u00f3 del proxy.</p> </li> </ul> </li> </ol>"},{"location":"proxy/#referencies","title":"Refer\u00e8ncies","text":"<p> Configuring a Squid Server to authenticate from RADIUS</p>"},{"location":"vpn/","title":"Servidor de VPN amb wireguard en un escenari muntat amb Docker","text":""},{"location":"vpn/#introduccio","title":"Introducci\u00f3","text":"<p>En aquesta pr\u00e0ctica configurarem un escenari simil\u00b7lar a una infraestructura empresarial real. Tenim un parell d'empleats que treballen a dist\u00e0ncia i necesiten fer \u00fas d'una VPN. Hem evaluat les opcions i, encara que en principi hav\u00edem pensat utilitzar OpenVPN, finalment ens hem decidit per Wireguard amb la possibilitat de, si en un futur tenim m\u00e9s teletreballadors, canviar a OpenVPN.</p> <p>Simularem la nostra infraestructura \u00edntegrament amb contenidors Docker i ser\u00e0 tal que aix\u00ed:</p> <p></p> <p>Els clients establiran un t\u00fanel xifrat amb el servidor de VPN a la DMZ a trav\u00e9s del firewall i aquest servidor, redirigir\u00e0 el tr\u00e0fic ja descifrat a la LAN. El tr\u00e0fic de tornada seguir\u00e0 el cam\u00ed invers.</p> <p>El t\u00fanel s'establir\u00e0 mitjan\u00e7ant UDP i utilitzant el port 51820 entre cada client i el servidor de VPN.</p>"},{"location":"vpn/#tasques-a-realitzar","title":"Tasques a realitzar","text":"<ol> <li>Configurar la VPN per a que els dos clients puguen fer \u00fas d'ella</li> <li>Configurar el servidor VPN per a que assigne IPs d'una subxarxa concreta</li> <li>Comprovar que una vegada establerta la VPN, el tr\u00e0fic viatja xifrat a trav\u00e9s de la WAN i sense xifrar cap a la LAN.</li> <li>Configurar el firewall (iptables) per a permetre les conexions al servidor web i al servidor SSH.</li> </ol>"},{"location":"vpn/#arxiu-docker-composeyml","title":"Arxiu docker-compose.yml","text":"<pre><code>version: '3'\n# Definim les xarxes que tindrem \nnetworks:\nwan:\ndriver: bridge\nipam:\nconfig:\n- subnet: ${WAN}\nlan:\ndriver: bridge\nipam:\nconfig:\n- subnet: ${LAN}\ndmz:\ndriver: bridge\nipam:\nconfig:\n- subnet: ${DMZ}\n# Definim tots els endpoints que formaran part de l'escenari\nservices:\nclient_1:\nbuild:\ncontext: ./dockerfiles\ndockerfile: Dockerfile\ncontainer_name: client1\nhostname: client1\nextra_hosts:\n- \"webserver: ${IP_WEBSERVER}\"\n- \"wireguard: ${IP_WIREGUARD}\"\n- \"sshserver: ${IP_SSHSERVER}\"\nnetworks:\nwan:\nipv4_address: ${IP_CLIENT_1}\ncap_add:\n- NET_ADMIN\nvolumes:\n- ./wireguard:/etc/wireguard\nprivileged: true\ncommand: /bin/bash -c \"echo '1' &gt; /proc/sys/net/ipv4/ip_forward &amp;&amp; ip route del default &amp;&amp; ip route add default via ${IP_FIREWALL_WAN} &amp;&amp; exec sleep infinity\"\nclient_2:\nbuild:\ncontext: ./dockerfiles\ndockerfile: Dockerfile\ncontainer_name: client2\nhostname: client2\nextra_hosts:\n- \"webserver: ${IP_WEBSERVER}\"\n- \"wireguard: ${IP_WIREGUARD}\"\n- \"sshserver: ${IP_SSHSERVER}\"\nnetworks:\nwan:\nipv4_address: ${IP_CLIENT_2}\ncap_add:\n- NET_ADMIN\nprivileged: true\ncommand: /bin/bash -c \"echo '1' &gt; /proc/sys/net/ipv4/ip_forward &amp;&amp; ip route del default &amp;&amp; ip route add default via ${IP_FIREWALL_WAN} &amp;&amp; exec sleep infinity\"\nfirewall:\nbuild:\ncontext: ./dockerfiles\ndockerfile: Dockerfile.firewall\ncontainer_name: firewall\nhostname: firewall\nworking_dir: /usr/local/bin\nextra_hosts:\n- \"client_1: ${IP_CLIENT_1}\"\n- \"client_2: ${IP_CLIENT_2}\"\n- \"webserver: ${IP_WEBSERVER}\"\n- \"sshserver: ${IP_SSHSERVER}\"\n- \"wireguard: ${IP_WIREGUARD}\"   networks:\nwan:\nipv4_address: ${IP_FIREWALL_WAN}\nlan:\nipv4_address: ${IP_FIREWALL_LAN}\ndmz:\nipv4_address: ${IP_FIREWALL_DMZ}\nprivileged: true\ncap_add:\n- NET_ADMIN\nvolumes:\n- ./iptables:/usr/local/bin\ncommand: /bin/bash -c \"echo '1' &gt; /proc/sys/net/ipv4/ip_forward &amp;&amp; ip route del default &amp;&amp; iptables-rules.sh &amp;&amp; exec sleep infinity\"\nwebserver:\nbuild:\ncontext: ./dockerfiles\ndockerfile: Dockerfile.server\ncontainer_name: webserver\nhostname: servidorweb\nextra_hosts:\n- \"client_1: ${IP_CLIENT_1}\"\n- \"client_2: ${IP_CLIENT_2}\"\n- \"sshserver: ${IP_SSHSERVER}\"\n- \"wireguard: ${IP_WIREGUARD}\"   networks:\nlan:\nipv4_address: ${IP_WEBSERVER}\ncap_add:\n- NET_ADMIN\ncommand: /bin/bash -c \"ip route del default &amp;&amp; ip route add default via ${IP_FIREWALL_LAN} &amp;&amp; service nginx start &amp;&amp; exec sleep infinity\"\nssh_server:\nbuild:\ncontext: ./dockerfiles\ndockerfile: Dockerfile.ssh\ncontainer_name: ssh_server\nhostname: ssh_server\nextra_hosts:\n- \"client_1: ${IP_CLIENT_1}\"\n- \"wireguard: ${IP_WIREGUARD}\"\nnetworks:\nlan:\nipv4_address: ${IP_SSHSERVER}\ncap_add:\n- NET_ADMIN\ncommand: /bin/bash -c \"ip route del default &amp;&amp; ip route add default via ${IP_FIREWALL_LAN} &amp;&amp; service ssh start &amp;&amp; exec sleep infinity\"\nrestart: unless-stopped\nwireguard:\nimage: lscr.io/linuxserver/wireguard:latest\ncontainer_name: wireguard\nhostname: wireguard\nextra_hosts:\n- \"client_1: ${IP_CLIENT_1}\"\n- \"server: ${IP_WEBSERVER}\"\nnetworks:\ndmz:\nipv4_address: ${IP_WIREGUARD}\ncap_add:\n- NET_ADMIN\n- SYS_MODULE\ncommand: /bin/bash -c \"apk add tcpdump &amp;&amp; ip route del default &amp;&amp; ip route add default via ${IP_FIREWALL_DMZ} &amp;&amp; exec sleep infinity\"\nenvironment:\n- PUID=1000\n- PGID=1000\n- TZ=Europe/Madrid\n- SERVERURL=\n- SERVERPORT=\n- PEERS=\n- INTERNAL_SUBNET=\n- ALLOWEDIPS=\n- LOG_CONFS=false # No guardar conf en logs\nvolumes:\n- ./volumes/wireguard:/config\n- /lib/modules:/lib/modules\nports:\n- 51820:51820/udp\nsysctls:\n- net.ipv4.conf.all.src_valid_mark=1\n- net.ipv4.conf.all.forwarding=1\nrestart: unless-stopped\n</code></pre> <p>La vostra tasca ser\u00e0 completar les variables d'entorn de les l\u00ednies resaltades del docker-compose.</p> <p>Quan s'inicie l'escenari correctamente, podreu trobar les configuracions de la VPN autogenerades a partir de les variables d'ambient d'aquest docker-compose.yaml en el contenidor de wireguard, en el directori <code>/config</code>. </p> <p>La configuraci\u00f3 del servidor est\u00e0 dins del directori <code>/config/wg_confs</code> i la dels clients dins de <code>/config/peerX</code>, on la <code>X</code> \u00e9s el n\u00famero de client. Esta configuraci\u00f3 haureu de copiar-la als respectius clients, dins del directori <code>/etc/wireguard</code> amb el nom de <code>wg0.conf</code>.</p> <p>Enlla\u00e7 al repositori</p> <p>Trobareu tot el necessari per a construir l'escenari ac\u00ed: https://github.com/raul-profesor/practica-wireguard-vpn</p> <p>Vos cloneu el repositori amb <code>git clone https://github.com/raul-profesor/practica-wireguard-vpn</code> i podeu comen\u00e7ar a treballar.</p> <p>Podeu consultar el significat de cada variable que heu d'omplir a la p\u00e0gina del contenidor de wireguard o qualsevol altre enlla\u00e7 de les refer\u00e8ncios o Internet.</p> <p>Nota</p> <p>En l'arxiu <code>.env</code> es troben guardades les variables que s'han utilitzat al docker-compose.yml. Podeu ficar les dades que falten al docker-compose de dues formes:   + Posant directament el seu valor on pertoque   + Assignar-li el valor a una variable en l'arxiu <code>.env</code> i posant despr\u00e9s la variable al docker-compose</p>"},{"location":"vpn/#detalls-de-la-vpn","title":"Detalls de la VPN","text":"<p>La informaci\u00f3 relativa a la configuraci\u00f3 de la VPN \u00e9s:</p> <ol> <li>Els clients establiran el t\u00fanel xifrat amb la VPN del servidor</li> <li>El port que faran servir \u00e9s el 51820 UDP</li> <li>Hi hauran dos clients</li> <li>La subxarxa de la VPN ser\u00e0 la <code>192.168.10.0/24</code></li> <li>Les xarxes que s'han d'enrutar seran tant la LAN com la de la VPN</li> </ol> <p>La VPN tindr\u00e1 una subxarxa independent de les altres tres. No obstant, per a que siga funcional, farem que es puga comunicar amb la LAN.</p> <p>A m\u00e9s, existeix un altre concepte que hem de con\u00e8ixer, l'split tunnelling</p> <p>Mentre estigam connectats a la VPN potser que no ens interese que tot el tr\u00e0fic siga encaminat per la VPN, per unes o altres raons. Un cas molt t\u00edpic es quan a trav\u00e9s de la VPN nom\u00e9s es vol donar acc\u00e9s al treballador a recursos interns per\u00f2 no a Internet, per tal de redu\u00efr el consum d'ample de banda de la xarxa de la empresa. \u00c9s a dir, que l'empleat puga accedir a recursos compartits en la xarxa de la empresa amb la VPN per\u00f2 que navegue per Internet amb la seua pr\u00f2pia l\u00ednea d'internet.</p> <p>Un altre cas t\u00edpic:</p> <p></p> <p>Aleshores, en les l\u00ednees del <code>docker-compose.yml</code> que heu d'emplenar, haureu d'indicar-le a la VPN que voleu encaminar pel t\u00fanel xifrat la pr\u00f2pia subsarxa de la VPN i tamb\u00e9 la LAN, per a que puguen comunicar-se entre elles. </p> <p>\u00c9s molt important, principalment per a configurar les regles del firewall, que tingau en compte que el tr\u00e0fic de la VPN segueix el seguent itinerari: client --&gt; t\u00fanel xifrat des dels clients fins al servidor VPN --&gt; servidor VPN fins al dest\u00ed en la LAN. I la tornada del tr\u00e0fic fa exactament el cam\u00ed invers.</p>"},{"location":"vpn/#realitzacio-de-la-practica","title":"Realitzaci\u00f3 de la pr\u00e0ctica","text":"<p>Aix\u00ed les coses, recordem les tasques a realitzar:</p> <p>Tasca 1</p> <p>Fer les configuracions pertinents amb les variables d'entorn del <code>docker-compose.yml</code> per tal d'establir la conexi\u00f3 VPN. </p> <p>Una vegada tingau les configuracions, per a establir el t\u00fanel, dins del contenidor dels clients podem fer en el terminal:</p> <pre><code>wg-quick up wg0\n</code></pre> <p>I comproveu que es crea una interfaz anomenada <code>wg0</code> i que t\u00e9 assignada la IP que l'heu configurat.</p> <p>Tip</p> <p>Fixeu-vos que els contenidors del firewall, wireguard i clients tenen configurat uns volums. Aix\u00f2 vol dir que les modificacions que fem en els arxius del directori local, es voran reflectides en els dels contenidors.</p> <p>Tasca 2</p> <p>Tots els contenidors tenen instal\u00b7lat tcpdump i ho podeu fer servir per a les tasques de troubleshooting.</p> <ul> <li>El que tamb\u00e9 heu de comprovar amb aquesta eina \u00e9s que al accedir al servidor web amb <code>curl http://webserver</code> i al servidor SSH amb <code>ssh sad@sshserver</code> (contrasenya seguretat), amb la VPN sense conectar el tr\u00e0fic viatja utilitzant el protocol TCP i/o sense xifrar.</li> <li>Que quan repetiu l'operaci\u00f3 amb la VPN establerta, el tr\u00e0fic viatja per UDP y xifrat.</li> </ul> <p>Adjunta captura de pantalles \u00f3n es vega clarament la comprovaci\u00f3.</p> <p>Tasca 3</p> <p>Una vegada estiga funcionant perfectament la VPN \u00e9s el torn de configurar el firewall. </p> <ul> <li>Fiqueu un arxiu anomenat <code>iptables-rules.sh</code> en el volum del contenidor del firewall. Aquest arxiu contendr\u00e1, per ordre d'aparici\u00f3:<ul> <li>Neteja de totes les posibles regles que puguen estar configurades previament</li> <li>Escriviu les regles adequades per a que la pol\u00edtica per defecta siga denegar tot el tr\u00e0fic.</li> <li>Afegiu regles per a permetre el tr\u00e1fic pel t\u00fanel VPN cap a la subxarxa LAN i als ports necessaris per als servidors HTTP i SSH.</li> </ul> </li> </ul> <p>Atenci\u00f3</p> <p>Per una questi\u00f3 de seguretat, configureu les regles d'iptables especificant els noms de les interfaces d'entrada, d'eixida i subsarxa dest\u00ed la LAN.</p> <p>Comproveu, adjuntant captures de pantalla, que les regles funcionen perfectament accedint a tots dos servidors i que els contadors de tr\u00e0fic de les regles aumenten quan les mostreu.</p> <p>Tasca 4</p> <p>Una vegada fet tot, prova de llevar de les xarxes que s'enruten per la VPN, la xarxa de la LAN i prova de conectar amb el servidor web i amb el servidor SSH. Qu\u00e8 observes i per qu\u00e8?</p> <p>Tasca 5</p> <p>Com a tasca adicional, intenta configurar l'escenari per a poder accedir pel t\u00fanel VPN (interfaz wg0) al servidor Web per\u00f2 no al servidor SSH. A la mateixa vegada, s'ha de poder accedir per SSH des de l'interfaz WAN al servidor SSH per\u00f2 no al servidor web.</p>"},{"location":"vpn/#contingut-extra-per-a-la-recuperacio-de-la-practica","title":"Contingut extra per a la recuperaci\u00f3 de la pr\u00e0ctica","text":"<p>Per tal de completar la recuperaci\u00f3 d'aquesta pr\u00e0ctica es demana, a m\u00e9s de tot lo anterior configurar un contenidor docker amb la imatge <code>kylemanna/openvpn</code>:</p> <ol> <li>Utilitzeu una m\u00e0quina Linux</li> <li>Com a m\u00e9tode d'autenticaci\u00f3 s'utilitzaran certificats (podeu posar-le contrasenya o no)</li> <li>El Common Name pel certificat ser\u00e0 SAD</li> <li>La IP del servidor a la que ens conectarem ser\u00e0 la de la m\u00e0quina </li> </ol> <p>Atenci\u00f3</p> <ul> <li>S'ha d'explicar i documentar detalladament cada pas que doneu.</li> <li>S'ha de fer la comprovaci\u00f3 de que la VPN funciona:<ul> <li>Conectant des d'un client</li> <li>Mostrant la interfaz creada per a la VPN</li> </ul> </li> <li>\u00bfTens acc\u00e9s a Internet des del client? Independenment de la teua resposta, justifica-la</li> </ul>"},{"location":"vpn/#referencies","title":"Refer\u00e8ncies","text":"<p>Com saber les IP dels contenidors</p> <p>Wireguard docs</p> <p>Wireguard docker documentaci\u00f3</p> <p>How to get started with WireGuard VPN</p> <p>WireGuard Remote Access to Docker Containers</p> <p>Restricciones de puertos e IP\u2019s usando Wireguard</p>"},{"location":"yara/","title":"Regles Yara","text":"<p>Les regles YARA s\u00f3n un conjunt de patrons utilitzats per identificar i classificar arxius maliciosos, codi malici\u00f3s o comportaments sospitosos en sistemes inform\u00e0tics. Van ser desenvolupades per V\u00edctor \u00c1lvarez, un investigador de seguretat, amb l'objectiu de facilitar la identificaci\u00f3 de codi malici\u00f3s en investigacions de seguretat i an\u00e0lisi forense.</p> <p></p> <p>YARA (Yet Another Ridiculous Acronym) permet definir regles que descriuen les caracter\u00edstiques de fitxers o processos sospitosos mitjan\u00e7ant patrons de text o seq\u00fc\u00e8ncies de bytes. Aquestes regles s\u00f3n especialment \u00fatils en la recerca de codi malici\u00f3s, ja que ajuden a detectar fam\u00edlies de codi malici\u00f3s basades en similituds, fins i tot si el codi malici\u00f3s ha estat modificat lleugerament per evitar ser detectat per m\u00e8todes tradicionals.</p> <p></p> <p>\u00c9s un est\u00e0ndard de factor \u00e0mpliament utilitzat a la comunitat de la ciberseguretat i de gran implementaci\u00f3 i integraci\u00f3 amb altres eines.</p>"},{"location":"yara/#estructura-basica-duna-regla-yara","title":"Estructura b\u00e0sica d'una regla YARA","text":"<p>Cada regla YARA t\u00e9 tres seccions principals:</p> <ol> <li>Identificador (nom de la regla): El nom de la regla que s'utilitzar\u00e0 per referir-s'hi.</li> <li>Metadades (opcional): Informaci\u00f3 addicional com a descripcions, autor, data, etc.</li> <li>Condicions: Defineixen quines caracter\u00edstiques o patrons ha de complir un fitxer per ser considerat com una coincid\u00e8ncia.</li> </ol>"},{"location":"yara/#exemple-duna-regla-yara","title":"Exemple d'una regla YARA:","text":"<pre><code>rule DetectaMalwareExemmple\n{\nmeta:\n        author = \"Investigador\"\ndescription = \"Regla per a detectar malware\"\ndate = \"2024-10-24\"\nstrings:\n        $cadena1 = \"malware\"\n$cadena2 = {6A 40 68 00 30 00 00 6A 14 8D 91}\ncondition:\n        $cadena1 or $cadena2\n}\n</code></pre>"},{"location":"yara/#explicacio-de-lexemple","title":"Explicaci\u00f3 de l'exemple:","text":"<ul> <li>meta: Cont\u00e9 informaci\u00f3 addicional sobre la regla, com l'autor i una descripci\u00f3.</li> <li>strings: Cont\u00e9 els patrons que es buscaran, com ara cadenes de text o seq\u00fc\u00e8ncies hexadecimals.</li> <li>condition: \u00c9s la part que especifica quan s'activar\u00e0 la regla. En aquest cas, la regla s'activar\u00e0 si es troba \"malware\" o la seq\u00fc\u00e8ncia de bytes hexadecimal.</li> </ul>"},{"location":"yara/#caracteristiques-principals","title":"Caracter\u00edstiques principals:","text":"<ul> <li>Simplicitat: El llenguatge YARA \u00e9s senzill d'aprendre i entendre, per\u00f2 \u00e9s extremadament potent per detectar patrons complexos.</li> <li>Efici\u00e8ncia: YARA pot analitzar grans volums de dades de manera eficient, cosa que \u00e9s essencial en an\u00e0lisi forense o detecci\u00f3 d'amenaces en temps real.</li> <li>Extensibilitat: Permet afegir m\u00faltiples patrons (cadenes de text, expressions regulars, seq\u00fc\u00e8ncies de bytes) i condicions l\u00f2giques.</li> </ul>"},{"location":"yara/#casos-dus","title":"Casos d'\u00fas:","text":"<ul> <li>Detecci\u00f3 de codi malici\u00f3s: Identificaci\u00f3 de variants de codi malici\u00f3s basades en patrons coneguts.</li> <li>An\u00e0lisi forense: Durant una investigaci\u00f3 de ciberseguretat, es poden fer servir les regles YARA per escanejar sistemes i arxius a la recerca d'indicadors de comprom\u00eds (IoC).</li> <li>Protecci\u00f3 proactiva: Algunes solucions de seguretat integren regles YARA per detectar amenaces emergents de manera proactiva.</li> </ul> <p>En resum, les regles YARA s\u00f3n una eina fonamental en la ciberseguretat per a la identificaci\u00f3 i l'an\u00e0lisi d'amenaces, gr\u00e0cies a la seva flexibilitat i pot\u00e8ncia per detectar patrons en fitxers o en la mem\u00f2ria del sistema.</p>"},{"location":"yara/#tasca","title":"Tasca","text":"<p>En el nostre cas tindrem una presa de contacte amb les regles Yara d'una manera for\u00e7a senzilla. Ens crearem una regla que pugui detectar un malware real, en aquest cas el conegut com a Vidar.</p> <p>Puja primer la mostra a Virustotal i comprova com efectivament multitud de motors d'antivirus la detecten com a codi malici\u00f3s (malware).</p> <p>Per continuar, l'estructura de la regla ser\u00e0 la que es mostra m\u00e9s amunt, feu una cerca a Internet si aix\u00ed ho necessiteu per al vostre cas concret. Es pret\u00e9n que la regla Yara elaborada inclogui:</p> <ul> <li>Metadades</li> <li>Com a autor el vostre nom i cognom</li> <li>Com a descripci\u00f3 el vostre curs i l'any acad\u00e8mic (ex. 4C - 98/99)</li> <li>Data</li> <li>Que es detectin dues cadenes</li> <li>Sobre la mostra de malware proporcionada i fent \u00fas de l'ordre <code>strings</code>, intenteu localitzar dues cadenes que semblin \u00faniques i relatives a aquest malware (IPs, comunicacions mitjan\u00e7ant canals de Telegram, dominis, ubicacions de disc...)</li> <li>Utilitzeu dues d'aquestes informacions com les cadenes a detectar</li> <li>La condici\u00f3 \u00e9s que s'hagin de complir ambdues cadenes obligat\u00f2riament</li> </ul>"},{"location":"yara/#installacio-de-yara","title":"Instal\u00b7laci\u00f3 de Yara","text":"<p>Per instal\u00b7lar Yara a Rocky no teniu m\u00e9s que:</p> <pre><code>sudo dnf install yara\n</code></pre> <p>i arreglat. Per provar la regla contra la mostra de codi malici\u00f3s la sintaxi ser\u00e0:</p> <p><pre><code>yara ruta/a/la/regla_yara.yara ruta/a/la/mostra_malware\n</code></pre> Si la detecci\u00f3 \u00e9s exitosa, veureu que se us repeteix el nom de la regla per pantalla, en cas contrari no obtindrem cap sortida.</p>"}]}